{% load static %}
<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sabaq Saqshy</title>
    
    <!-- Font Awesome –∏–∫–æ–Ω–∞–ª–∞—Ä—ã–Ω “õ–æ—Å—É -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <!-- –ë–ê–†–õ–´“ö –°–¢–ò–õ–¨–î–ï–†–î–Ü –û–°–´ –ñ–ï–†–ì–ï “ö–û–°–£ -->
    <link rel="stylesheet" href="{% static 'bilimClassApp/css/base.css' %}">
    <link rel="stylesheet" href="{% static 'bilimClassApp/css/admin_panel.css' %}">
    <link rel="stylesheet" href="{% static 'bilimClassApp/css/school_structure.css' %}">
    <style>
    /* –ë–µ–ª—Å–µ–Ω–¥—ñ –µ–º–µ—Å –±–µ—Ç—Ç–µ—Ä –º–µ–Ω “õ–æ–π—ã–Ω–¥—ã–ª–∞—Ä–¥—ã –∂–∞—Å—ã—Ä—É —Å—Ç–∏–ª—ñ–Ω “õ–æ—Å—É */
        .page-content, .content-tab-pane {
            display: none;
        }
        .page-content.active, .content-tab-pane.active {
            display: block;
        }

        .td-user-section { display: flex; align-items: center; gap: 16px; }
        .td-user-info { text-align: right; } .td-user-info h3 { font-weight: 600; }
        .td-user-info p { font-size: 14px; color: var(--text-secondary); }
        .td-user-link { text-decoration: none; color: inherit; }
        .td-user-avatar { width: 40px; height: 40px; border-radius: 10px; background-color: #D8B4FE; color: #581C87; display: grid; place-items: center; font-weight: 600; }
   
.custom-select {
    position: relative;
    display: inline-block;
    width: 100%; /* –ó–∞—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–Ω–∏–º–∞—Ç—å –≤—Å—é —à–∏—Ä–∏–Ω—É —Ä–æ–¥–∏—Ç–µ–ª—è */
}



/* –°–∫—Ä—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π select, –Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ–º –µ–≥–æ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º—ã */
.custom-select select {
    display: none;
}

.custom-select-trigger {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 12px;
    background: #FFFFFF;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px; /* –£–≤–µ–ª–∏—á–∏–º —à—Ä–∏—Ñ—Ç –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø–æ–ª—è–º –≤–≤–æ–¥–∞ */
    font-family: 'Inter', sans-serif;
    text-align: left;
    margin: 10px 0; /* –î–æ–±–∞–≤–∏–º –æ—Ç—Å—Ç—É–ø –∫–∞–∫ —É –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã */
    transition: border-color 0.2s, box-shadow 0.2s;
}

.custom-select-trigger:hover {
    border-color: #A5B4FC;
}

.custom-select-trigger:after {
    content: '\f078'; /* –ò–∫–æ–Ω–∫–∞ —à–µ–≤—Ä–æ–Ω–∞ –≤–Ω–∏–∑ –∏–∑ Font Awesome */
    font-family: 'Font Awesome 5 Free';
    font-weight: 900;
    margin-left: 8px;
    color: var(--text-secondary);
    transition: transform 0.2s ease;
}

.custom-options.open + .custom-select-trigger:after {
    transform: rotate(180deg);
}

.custom-options {
    position: absolute;
    max-height: 150px;
    top: calc(100% + 2px); /* –†–∞—Å–ø–æ–ª–∞–≥–∞–µ–º —á—É—Ç—å –Ω–∏–∂–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞ */
    left: 0;
    right: 0;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 8px 24px rgba(16, 24, 40, 0.1);
    list-style: none;
    padding: 8px 6px;
    margin: 0;
    max-height: 220px;
    overflow-y: scroll;
    display: none;
    z-index: 1200;
}



.custom-options.open {
    display: block;
    max-height: 150px;
}

#user-modal-overlay .custom-options.open {
    max-height: 100px;
}

.custom-option {
    padding: 12px 14px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    font-family: 'Inter', sans-serif;
    transition: background-color 0.2s, color 0.2s;
}

.custom-option:hover {
    background-color: #F3F4F6;
}

.custom-option.selected {
    background: #EEF2FF;
    color: var(--accent-primary);
    font-weight: 600;
}
/* =================================================================
   –°–¢–ò–õ–ò –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–û–ô –ê–î–ê–ü–¢–ê–¶–ò–ò (ADMIN_PANEL)
   –í–µ—Ä—Å–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º CSS ::before –¥–ª—è –ø–æ–¥–ø–∏—Å–µ–π
================================================================= */

    /* –ú–æ–±–∏–ª—å–¥—ñ –Ω–∞–≤–∏–≥–∞—Ü–∏—è–Ω—ã ”ô–¥–µ–ø–∫—ñ –±–æ–π—ã–Ω—à–∞ –∂–∞—Å—ã—Ä—É */
.td-mobile-nav,
.mobile-menu-header {
    display: none;
}

@media (max-width: 1024px) {

    /* --- 1. –ñ–ê–õ–ü–´ –ë–ê–ì–ê–ù–ê–õ–ê–†–î–´“¢ ”®–ó–ì–ï–†–Ü–°–¢–ï–†–Ü --- */
    .container {
        padding: 16px;
    }

    .site-header {
        width: 90%;
        margin-left: 5%;
    }

    .page-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
    }
    .page-header .btn-primary {
        width: 100%;
    }
    .page-title h2 {
        font-size: 20px;
    }
    .content-card {
        padding: 16px;
    }

    /* --- 2. –ú–û–ë–ò–õ–î–Ü –ù–ê–í–ò–ì–ê–¶–ò–Ø (–°–ê–ô–î–ë–ê–†) --- */
    .td-user-info { display: none; }
    .td-mobile-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        background-color: var(--bg-widget);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        margin-bottom: 20px;
    }
    #mobile-nav-title { font-size: 18px; font-weight: 600; }
    #mobile-menu-btn {
        background: transparent;
        border: none;
        font-size: 20px;
        cursor: pointer;
        padding: 8px;
        width: 40px;
        height: 40px;
        border-radius: 8px;
    }
    .main-nav {
        position: fixed;
        top: 0; right: 0;
        width: 300px;
        max-width: 90%;
        height: 100%;
        background-color: var(--bg-widget);
        box-shadow: -4px 0 25px rgba(0, 0, 0, 0.1);
        transform: translateX(100%);
        transition: transform 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        z-index: 2000;
        padding: 0;
        margin: 0;
        border-radius: 0;
        display: flex;
        flex-direction: column;
    }
    .main-nav.is-open { transform: translateX(0); }
    .mobile-menu-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 24px;
        border-bottom: 1px solid var(--border-color);
    }
    #mobile-menu-close-btn {
        background: transparent;
        border: none;
        font-size: 22px;
        cursor: pointer;
        padding: 8px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        color: var(--text-secondary);
    }
    .main-nav ul {
        flex-direction: column;
        gap: 8px;
        padding: 16px;
    }
    .main-nav a { padding: 14px 20px; font-size: 16px; font-weight: 500; }
    .main-nav a.active { background-color: var(--accent-primary); color: #fff; }
    body.menu-open::after {
        content: '';
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background-color: rgba(17, 24, 39, 0.6);
        z-index: 1999;
    }

    /* --- 3. –ö–ï–°–¢–ï–õ–ï–†–î–Ü“¢ –ê–î–ê–ü–¢–ê–¶–ò–Ø–°–´ (–ñ–ê“¢–ê –ë–õ–û–ö) --- */

    /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü */
    .users-table thead,
    .data-table thead {
        display: none;
    }
    .users-table tr,
    .data-table tr {
        display: block;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        margin-bottom: 16px;
        background-color: #fff;
    }
    .users-table td,
    .data-table td {
        display: flex;
        justify-content: space-between;
        align-items: center;
        text-align: right;
        padding: 12px;
        border-bottom: 1px solid #f0f0f0;
    }
    .users-table tr td:last-child,
    .data-table tr td:last-child {
        border-bottom: none;
    }
    .users-table td::before,
    .data-table td::before {
        font-weight: 500;
        color: var(--text-secondary);
        text-align: left;
        margin-right: 16px;
    }

    /* –ë—ñ—Ä—ñ–Ω—à—ñ “±—è—à—ã“õ—Ç—ã –∫–∞—Ä—Ç–æ—á–∫–∞–Ω—ã“£ "—Ç–∞“õ—ã—Ä—ã–±—ã" –µ—Ç—ñ–ø –∂–∞—Å–∞—É */
    .users-table td:first-child,
    .data-table td:first-child {
        font-weight: 600;
        font-size: 16px;
        padding-top: 14px;
        padding-bottom: 14px;
    }
    .users-table td:first-child::before,
    .data-table td:first-child::before {
        content: "" !important; /* –£–±–∏—Ä–∞–µ–º –ø–æ–¥–ø–∏—Å—å —É –ø–µ—Ä–≤–æ–π —è—á–µ–π–∫–∏ */
    }

    #create-user-btn {
        width: 90%;
        margin-left: 5%;
    }

    .page-title {
        width: 90%;
        margin-left: 5%;
    }

    /* .td-mobile-nav {
        width: 90%;
        margin-left: 5%;
    } */

    .logo-text span {
        display: none;
    }

    /* --- –ü–ê–ô–î–ê–õ–ê–ù–£–®–´–õ–ê–† –ö–ï–°–¢–ï–°–Ü–ù–ï –ñ–ê–ó–ë–ê–õ–ê–† --- */
    #page-users .users-table td:nth-of-type(2)::before { content: 'Email'; }
    #page-users .users-table td:nth-of-type(3)::before { content: '–¢–µ–ª–µ—Ñ–æ–Ω'; }
    #page-users .users-table td:nth-of-type(4)::before { content: '–†”©–ª—ñ'; }
    #page-users .users-table td:nth-of-type(5)::before { content: '–ö“Ø–π—ñ'; }
    #page-users .users-table td:nth-of-type(6)::before { content: '–°–æ“£“ì—ã –∫—ñ—Ä–≥–µ–Ω—ñ'; }
    #page-users .users-table td:nth-of-type(7)::before { content: '”ò—Ä–µ–∫–µ—Ç—Ç–µ—Ä'; }
    
    /* --- –°–´–ù–´–ü–¢–ê–† –ö–ï–°–¢–ï–°–Ü–ù–ï –ñ–ê–ó–ë–ê–õ–ê–† --- */
    #tab-classes .data-table td:nth-of-type(2)::before { content: '–û“õ—É—à—ã–ª–∞—Ä'; }
    #tab-classes .data-table td:nth-of-type(3)::before { content: '–ñ–µ—Ç–µ–∫—à—ñ'; }
    #tab-classes .data-table td:nth-of-type(4)::before { content: '”ò—Ä–µ–∫–µ—Ç—Ç–µ—Ä:'; }

    /* --- –ü”ò–ù–î–ï–† –ö–ï–°–¢–ï–°–Ü–ù–ï –ñ–ê–ó–ë–ê–õ–ê–† --- */
    #tab-subjects .data-table td:nth-of-type(2)::before { content: '”ò—Ä–µ–∫–µ—Ç—Ç–µ—Ä:'; }

    #tab-subjects .data-table td {
        gap: 20px;
    }

    #page-assignments i {
        display: none;
    }


    /* --- –¢–ê“ö–ê–ô–´–ù–î–ê–£–õ–ê–† –ö–ï–°–¢–ï–°–Ü–ù–ï –ñ–ê–ó–ë–ê–õ–ê–† --- */
    #page-assignments .data-table td:nth-of-type(2)::before { content: '–°—ã–Ω—ã–ø'; }
    #page-assignments .data-table td:nth-of-type(3)::before { content: '–ü”ô–Ω'; }
    #page-assignments .data-table td:nth-of-type(4)::before { content: '–ê–ø—Ç–∞–ª—ã“õ —Å–∞“ì–∞—Ç—Ç–∞—Ä'; }
    #page-assignments .data-table td:nth-of-type(5)::before { content: '”ò—Ä–µ–∫–µ—Ç—Ç–µ—Ä'; }
    
    /* --- –î–ï–ú–ê–õ–´–° –ö“Æ–ù–î–ï–†–Ü –ö–ï–°–¢–ï–°–Ü–ù–ï –ñ–ê–ó–ë–ê–õ–ê–† --- */
    #page-settings .data-table td:nth-of-type(2)::before { content: '–°–µ–±–µ–ø'; }
    /* #page-settings .data-table td:nth-of-type(3)::before { content: '”ò—Ä–µ–∫–µ—Ç—Ç–µ—Ä'; } */
    


    /* --- 4. –ê–î–ê–ü–¢–ê–¶–ò–Ø –§–ò–õ–¨–¢–†–û–í (–°–¢–†–ê–ù–ò–¶–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô) --- */
    .filters-toolbar {
        flex-direction: column;
        gap: 12px;
    }
    .filters-toolbar .search-group,
    .filters-toolbar .filter-select,
    .filters-toolbar .btn-primary,
    .filters-toolbar .btn-secondary {
        width: 100%;
    }

    /* --- 5. –ê–î–ê–ü–¢–ê–¶–ò–Ø –í–ö–õ–ê–î–û–ö (–°–¢–†–ê–ù–ò–¶–ê –°–¢–†–£–ö–¢–£–†–´) --- */
    #structure-card-header { flex-direction: column; gap: 16px; }
    #structure-tabs-nav {
        display: grid;
        grid-template-columns: 1fr 1fr;
        width: 100%;
        gap: 8px;
    }
    #structure-tabs-nav a { justify-content: center; }
    #structure-action-buttons { width: 100%; }
    #structure-action-buttons .btn-success,
    #structure-action-buttons .btn-info {
        width: 100%;
        justify-content: center;
    }
}
      
    </style>
</head>
<body class="td-body">
    
    <div class="container">
        <!-- ===================================================================== -->
        <!-- === –û–ë–©–ê–Ø –®–ê–ü–ö–ê (–≤–∏–¥–Ω–∞ –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö) === -->
        <!-- ===================================================================== -->
        <header class="site-header">
            <div class="logo-section">
                <div class="logo-icon">üéì</div>
                <div class="logo-text">
                    <h1>Sabaq Saqshy</h1>
                    <span>–û“õ—É –ø—Ä–æ—Ü–µ—Å—ñ–Ω –±–∞—Å“õ–∞—Ä—É –∂“Ø–π–µ—Å—ñ</span>
                </div>
            </div>
            <div class="td-user-section">
                <div class="td-user-info">
                    <a href="{% url 'profile' %}" class="td-user-link">
                        <h3>{{ user.get_full_name }}</h3>
                    </a>
                    <a href="{% url 'logout' %}" class="logout-link" style="font-size: 14px; color: #6B7280;" title="–®—ã“ì—É">
                        –®—ã“ì—É
                    </a>
                </div>
                <a href="{% url 'profile' %}" class="td-user-link">
                    <div class="td-user-avatar">{{ user.first_name|first }}{{ user.last_name|first }}</div>
                </a>
            </div>
        </header>

        <div class="td-mobile-nav">
            <h2 id="mobile-nav-title">–ë–∞—Å—Ç—ã –±–µ—Ç</h2>
            <button id="mobile-menu-btn" aria-label="–ú”ô–∑—ñ—Ä–¥—ñ –∞—à—É">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <!-- ===================================================================== -->
        <!-- === –û–ë–©–ê–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø (–≤–∏–¥–Ω–∞ –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö) === -->
        <!-- ===================================================================== -->
        <nav class="main-nav">
            <div class="mobile-menu-header">
                <h3>–ú”ô–∑—ñ—Ä</h3>
                <button id="mobile-menu-close-btn" aria-label="–ú”ô–∑—ñ—Ä–¥—ñ –∂–∞–±—É">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <ul>
                <!-- data-target –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è JS –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
                <li><a href="#" data-target="users" class="active"><i class="fa-solid fa-users"></i> –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–ª–∞—Ä</a></li>
                <li><a href="#" data-target="structure"><i class="fa-solid fa-sitemap"></i> –ú–µ–∫—Ç–µ–ø “õ“±—Ä—ã–ª—ã–º—ã</a></li>
                <li><a href="#" data-target="assignments"><i class="fa-solid fa-user-tag"></i> –¢–∞“ì–∞–π—ã–Ω–¥–∞—É–ª–∞—Ä</a></li>
                <li><a href="#" data-target="settings"><i class="fa-solid fa-gear"></i> –ü–∞—Ä–∞–º–µ—Ç—Ä–ª–µ—Ä</a></li>
            </ul>
        </nav>

        <!-- ===================================================================== -->
        <!-- === –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –î–ò–ù–ê–ú–ò–ß–ï–°–ö–û–ì–û –ö–û–ù–¢–ï–ù–¢–ê === -->
        <!-- ===================================================================== -->
        <main id="app-content">
            
            <!-- –°–¢–†–ê–ù–ò–¶–ê "–£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø–ú–ò" -->
            <div id="page-users" class="page-content active">
                <div class="page-header">
                    <div class="page-title">
                        <h2>–ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–ª–∞—Ä–¥—ã –±–∞—Å“õ–∞—Ä—É</h2>
                        <p>–¢—ñ—Ä–∫–µ–ª–≥—ñ–ª–µ—Ä–¥—ñ “õ“±—Ä—É, ”©“£–¥–µ—É –∂”ô–Ω–µ –±–∞—Å“õ–∞—Ä—É</p>
                    </div>
                    <button class="btn-primary" id="create-user-btn">
                        <i class="fa-solid fa-plus"></i>
                        –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã “õ“±—Ä—É
                    </button>
                </div>
        
                <div class="content-card">
                    <form method="GET" action="{% url 'admin_panel' %}" class="filters-toolbar">
                        <!-- JS “Ø—à—ñ–Ω —Ç–æ–∫–µ–Ω –∞–ª—É “Ø—à—ñ–Ω “õ–æ—Å—ã–ª“ì–∞–Ω -->
                        {% csrf_token %}
                        <div class="search-group">
                            <i class="fa-solid fa-search"></i>
                            <input type="text" name="q" placeholder="–ê—Ç—ã –Ω–µ–º–µ—Å–µ email –±–æ–π—ã–Ω—à–∞ —ñ–∑–¥–µ—É..." value="{{ search_query }}">
                        </div>
                        <select name="role" class="filter-select">
                            <option value="">–ë–∞—Ä–ª—ã“õ —Ä”©–ª–¥–µ—Ä</option>
                            {% for value, display_name in role_choices %}
                                <option value="{{ value }}" {% if role_filter == value %}selected{% endif %}>
                                    {{ display_name }}
                                </option>
                            {% endfor %}
                        </select>
                        <select name="status" class="filter-select">
                            <option value="">–ë–∞—Ä–ª—ã“õ —Å—Ç–∞—Ç—É—Å—Ç–∞—Ä</option>
                            <option value="active" {% if status_filter == 'active' %}selected{% endif %}>–ê–∫—Ç–∏–≤—Ç—ñ</option>
                            <option value="inactive" {% if status_filter == 'inactive' %}selected{% endif %}>–ë–ª–æ–∫—Ç–∞–ª“ì–∞–Ω</option>
                        </select>
                        <button type="submit" class="btn-primary">“ö–æ–ª–¥–∞–Ω—É</button>
                        <a href="{% url 'admin_panel' %}" class="btn-secondary">“ö–∞–ª–ø—ã–Ω–∞ –∫–µ–ª—Ç—ñ—Ä—É</a>
                    </form>
        
                    <nav class="content-tabs">
                        <ul>
                            <li>
                                <a href="#" class="active">
                                    –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–ª–∞—Ä
                                    <span class="count-badge">{{ users.count }}</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
        
                    <div class="table-wrapper">
                        <table class="users-table">
                            <thead>
                                <tr>
                                    <th>–¢–æ–ª—ã“õ –∞—Ç—ã-–∂”©–Ω—ñ</th>
                                    <th>Email</th>
                                    <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                    <th>–†”©–ª—ñ</th>
                                    <th>–ö“Ø–π—ñ</th>
                                    <th>–°–æ“£“ì—ã –∫—ñ—Ä—É</th>
                                    <th>”ò—Ä–µ–∫–µ—Ç—Ç–µ—Ä</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user_obj in users %}
                                <!-- ”®–ó–ì–ï–†–Ü–°: –ñ–æ–ª–¥—ã –æ“£–∞–π —Ç–∞–±—É “Ø—à—ñ–Ω data-–∞—Ç—Ä–∏–±—É—Ç “õ–æ—Å—ã–ª–¥—ã -->
                                <tr data-user-row-id="{{ user_obj.id }}">
                                    <td>{{ user_obj.get_full_name|default:user_obj.username }}</td>
                                    <td class="user-name-cell">
                                        <span>{{ user_obj.email|default:"-" }}</span>
                                        {% if user_obj.email %}<i class="fa-regular fa-envelope"></i>{% endif %}
                                    </td>
                                    <td>
                                        {{ user_obj.profile.phone_number|default:"-" }}
                                    </td>
                                    <td>
                                        {% if user_obj.profile and user_obj.profile.role %}
                                            {% if user_obj.profile.role == 'teacher' %}
                                                <span class="role-badge role-teacher">{{ user_obj.profile.get_role_display }}</span>
                                            {% elif user_obj.profile.role == 'student' %}
                                                <span class="role-badge role-student">{{ user_obj.profile.get_role_display }}</span>
                                            {% elif user_obj.profile.role == 'headteacher' %}
                                                <span class="role-badge role-headteacher">{{ user_obj.profile.get_role_display }}</span>
                                            {% else %}
                                                <span>{{ user_obj.profile.get_role_display }}</span>
                                            {% endif %}
                                        {% else %}
                                            <span>-</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if user_obj.is_active %}
                                            <span class="status-badge status-active">–ê–∫—Ç–∏–≤—Ç—ñ</span>
                                        {% else %}
                                            <span class="status-badge status-blocked">–ë–ª–æ–∫—Ç–∞–ª“ì–∞–Ω</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ user_obj.last_login|date:"Y-m-d H:i"|default:"–ï—à“õ–∞—à–∞–Ω" }}</td>
                                    <td class="action-icons">
                                        <!-- ”®–ó–ì–ï–†–Ü–°: –ë–∞—Ä–ª—ã“õ –∏–∫–æ–Ω–∫–∞–ª–∞—Ä–¥—ã <a> —Ç–µ–≥—Ç–µ—Ä—ñ–º–µ–Ω –æ—Ä–∞–ø, –∫–ª–∞—Å—Ç–∞—Ä/–∞—Ç—Ä–∏–±—É—Ç—Ç–∞—Ä “õ–æ—Å—ã–ª–¥—ã -->
                                        <a href="#" class="edit-btn" data-user-id="{{ user_obj.id }}" title="”®“£–¥–µ—É"><i class="fa-solid fa-pencil"></i></a>
                                        <a href="#" class="block-user-btn" data-user-id="{{ user_obj.id }}" title="{% if user_obj.is_active %}–ë–ª–æ–∫—Ç–∞—É{% else %}–ë–ª–æ–∫—Ç–∞–Ω —à—ã“ì–∞—Ä—É{% endif %}">
                                            <i class="fa-solid fa-lock{% if not user_obj.is_active %}-open{% endif %}"></i>
                                        </a>
                                        <a href="#" class="delete-user-btn" data-user-id="{{ user_obj.id }}" title="–ñ–æ—é"><i class="fa-solid fa-trash-can"></i></a>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 24px;">–ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–ª–∞—Ä —Ç–∞–±—ã–ª–º–∞–¥—ã.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –°–¢–†–ê–ù–ò–¶–ê "–ú–ï–ö–¢–ï–ü “ö“∞–†–´–õ–´–ú–´" -->
            <div id="page-structure" class="page-content">
                <div class="page-header">
                    <h2><i class="fa-solid fa-graduation-cap"></i> –ú–µ–∫—Ç–µ–ø “õ“±—Ä—ã–ª—ã–º—ã–Ω –±–∞—Å“õ–∞—Ä—É</h2>
                    <p>–°—ã–Ω—ã–ø—Ç–∞—Ä –º–µ–Ω –ø”ô–Ω–¥–µ—Ä–¥—ñ “õ“±—Ä—É –∂”ô–Ω–µ ”©“£–¥–µ—É</p>
                </div>
        
                <div class="content-card">
                    <div class="card-header" id="structure-card-header">
                        <nav class="content-tabs" id="structure-tabs-nav">
                            <!-- ”®–ó–ì–ï–†–Ü–°: JS “Ø—à—ñ–Ω data-–∞—Ç—Ä–∏–±—É—Ç—Ç–∞—Ä “õ–æ—Å—ã–ª–¥—ã -->
                            <a href="#" data-tab="classes" class="active"><i class="fa-solid fa-people-roof"></i> –°—ã–Ω—ã–ø—Ç–∞—Ä <span class="count-badge">{{ structure_school_classes.count }}</span></a>
                            <a href="#" data-tab="subjects"><i class="fa-solid fa-book"></i> –ü”ô–Ω–¥–µ—Ä <span class="count-badge">{{ subjects.count }}</span></a>
                        </nav>
                        <!-- ”®–ó–ì–ï–†–Ü–°: “ö“±—Ä—É –±–∞—Ç—ã—Ä–º–∞–ª–∞—Ä—ã —ã“£“ì–∞–π–ª—ã –∞—É—ã—Å—ã–º “Ø—à—ñ–Ω –±”©–ª–µ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–≥–µ —à—ã“ì–∞—Ä—ã–ª–¥—ã -->
                        <div id="structure-action-buttons">
                            <button class="btn-success" id="create-class-btn" style="display: flex;"><i class="fa-solid fa-plus"></i> –°—ã–Ω—ã–ø “õ“±—Ä—É</button>
                            <button class="btn-info btn-primary" id="create-subject-btn" style="display: none;"><i class="fa-solid fa-plus"></i> –ü”ô–Ω “õ“±—Ä—É</button>
                        </div>
                    </div>
                    
                    <!-- ”®–ó–ì–ï–†–Ü–°: “ö–æ–π—ã–Ω–¥—ã–ª–∞—Ä–¥—ã“£ –∫–æ–Ω—Ç–µ–Ω—Ç—ñ –±”©–ª–µ–∫ div-—Ç–µ—Ä–≥–µ –æ—Ä–∞–ª“ì–∞–Ω -->
                    <div id="tab-classes" class="content-tab-pane active">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>–°—ã–Ω—ã–ø</th>
                                    <th>–û“õ—É—à—ã–ª–∞—Ä —Å–∞–Ω—ã</th>
                                    <th>–°—ã–Ω—ã–ø –∂–µ—Ç–µ–∫—à—ñ—Å—ñ</th>
                                    <th style="text-align: end;">”ò—Ä–µ–∫–µ—Ç—Ç–µ—Ä</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for s_class in structure_school_classes %}
                                <tr data-class-row-id="{{ s_class.id }}">
                                    <td><strong>{{ s_class.name }}</strong></td>
                                    <td class="student-count-cell"><i class="fa-solid fa-user-group"></i> {{ s_class.student_count }}</td>
                                    <td>{{ s_class.class_teacher.user.get_full_name|default:"–¢–∞“ì–∞–π—ã–Ω–¥–∞–ª–º–∞“ì–∞–Ω" }}</td>
                                    <td class="action-icons" style="justify-content: end; gap:40px;">
                                        <a href="#" class="edit-class-btn" data-class-id="{{ s_class.id }}"><i class="fa-solid fa-pencil"></i></a>
                                        <a href="#" class="delete-class-btn" data-class-id="{{ s_class.id }}"><i class="fa-solid fa-trash-can"></i></a>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr><td colspan="4" style="text-align: center; padding: 24px;">–°—ã–Ω—ã–ø—Ç–∞—Ä ”ô–ª—ñ “õ“±—Ä—ã–ª“ì–∞–Ω –∂–æ“õ.</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <div id="tab-subjects" class="content-tab-pane">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>–ü”ô–Ω –∞—Ç–∞—É—ã</th>
                                    <th style="text-align: end;">”ò—Ä–µ–∫–µ—Ç—Ç–µ—Ä</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for subject in subjects %}
                                <tr data-subject-row-id="{{ subject.id }}">
                                    <td><strong>{{ subject.name }}</strong></td>
                                    <td class="action-icons" style="justify-content: end; gap:40px;">
                                        <a href="#" class="edit-subject-btn" data-subject-id="{{ subject.id }}"><i class="fa-solid fa-pencil"></i></a>
                                        <a href="#" class="delete-subject-btn" data-subject-id="{{ subject.id }}"><i class="fa-solid fa-trash-can"></i></a>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr><td colspan="2" style="text-align: center; padding: 24px;">–ü”ô–Ω–¥–µ—Ä ”ô–ª—ñ “õ“±—Ä—ã–ª“ì–∞–Ω –∂–æ“õ.</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                </div>
            </div>
            
            <!-- ========================================================== -->
            <!-- === –ñ–ê“¢–ê –ë–ï–¢ "–¢–ê“ö–ê–ô–´–ù–î–ê–£–õ–ê–†" === -->
            <!-- ========================================================== -->
            <div id="page-assignments" class="page-content">
                <div class="page-header">
                    <div>
                        <h2><i class="fa-solid fa-user-tag"></i> –ú“±“ì–∞–ª—ñ–º–¥–µ—Ä–¥—ñ —Ç–∞“ì–∞–π—ã–Ω–¥–∞—É</h2>
                        <p>–ú“±“ì–∞–ª—ñ–º–¥–µ—Ä–¥—ñ —Å—ã–Ω—ã–ø—Ç–∞—Ä –º–µ–Ω –ø”ô–Ω–¥–µ—Ä –±–æ–π—ã–Ω—à–∞ –±”©–ª—É</p>
                    </div>
                    <button class="btn-primary" id="create-assignment-btn">
                        <i class="fa-solid fa-plus"></i>
                        –¢–∞“ì–∞–π—ã–Ω–¥–∞—É–¥—ã “õ“±—Ä—É
                    </button>
                </div>
                <div class="content-card">
                    <div class="card-header">
                        <nav class="content-tabs">
                            <a href="#" class="active">–í—Å–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</a>
                        </nav>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                    <th>–ú“±“ì–∞–ª—ñ–º</th>
                                    <th>–°—ã–Ω—ã–ø</th>
                                    <th>–ü”ô–Ω</th>
                                    <th>–ê–ø—Ç–∞–ª—ã“õ —Å–∞“ì–∞—Ç—Ç–∞—Ä</th>
                                    <th style="text-align: end;">”ò—Ä–µ–∫–µ—Ç—Ç–µ—Ä</th>
                                </tr>
                        </thead>
                        <tbody>
                            {% for assignment in all_assignments %}
                            <tr data-assignment-row-id="{{ assignment.id }}">
                                <td><strong>{{ assignment.teacher.user.get_full_name }}</strong></td>
                                <td><i class="fa-solid fa-user-group"></i> {{ assignment.school_class.name }}</td>
                                <td><i class="fa-solid fa-book"></i> {{ assignment.subject.name }}</td>
                                <td>{{ assignment.hours_per_week|default:"-" }}</td>
                                    <td class="action-icons" style="justify-content: end;">
                                    <a href="#" class="delete-assignment-btn" data-assignment-id="{{ assignment.id }}" title="–¢–∞“ì–∞–π—ã–Ω–¥–∞—É–¥—ã –∂–æ—é"><i class="fa-solid fa-trash-can"></i></a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="5" style="text-align: center; padding: 24px;">–¢–∞“ì–∞–π—ã–Ω–¥–∞—É–ª–∞—Ä ”ô–ª—ñ “õ“±—Ä—ã–ª“ì–∞–Ω –∂–æ“õ.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- ========================================================== -->
            <!-- === –ñ–ê“¢–ê –ë–ï–¢ "–ü–ê–†–ê–ú–ï–¢–†–õ–ï–†" === -->
            <!-- ========================================================== -->
            <div id="page-settings" class="page-content">
                <div class="page-header">
                    <div>
                        <h2><i class="fa-solid fa-calendar-days"></i> –î–µ–º–∞–ª—ã—Å –∫“Ø–Ω–¥–µ—Ä—ñ–Ω –±–∞—Å“õ–∞—Ä—É</h2>
                        <p>–ö–∞–ª–µ–Ω–¥–∞—Ä“ì–∞ –º–µ—Ä–µ–∫–µ–ª—ñ–∫ –Ω–µ–º–µ—Å–µ –∂“±–º—ã—Å—Å—ã–∑ –∫“Ø–Ω–¥–µ—Ä–¥—ñ “õ–æ—Å—ã“£—ã–∑</p>
                    </div>
                    <button class="btn-primary" id="create-holiday-btn">
                        <i class="fa-solid fa-plus"></i>
                        –ö“Ø–Ω “õ–æ—Å—É
                    </button>
                </div>
                <div class="content-card">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–ê—Ç–∞—É—ã / –°–µ–±–µ–±—ñ</th>
                                <th style="text-align: end;">”ò—Ä–µ–∫–µ—Ç—Ç–µ—Ä</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for holiday in all_holidays %}
                            <tr data-holiday-row-id="{{ holiday.id }}">
                                <td><strong>{{ holiday.date|date:"d.m.Y" }}</strong></td>
                                <td>{{ holiday.name }}</td>
                                <td class="action-icons" style="justify-content: end; gap:40px;">
                                    <a href="#" class="edit-holiday-btn" data-holiday-id="{{ holiday.id }}" title="”®“£–¥–µ—É"><i class="fa-solid fa-pencil"></i></a>
                                    <a href="#" class="delete-holiday-btn" data-holiday-id="{{ holiday.id }}" title="–ñ–æ—é"><i class="fa-solid fa-trash-can"></i></a>
                                </td>
                            </tr>
                            {% empty %}
                                <tr><td colspan="3" style="text-align: center; padding: 24px;">–î–µ–º–∞–ª—ã—Å –∫“Ø–Ω–¥–µ—Ä—ñ ”ô–ª—ñ “õ–æ—Å—ã–ª–º–∞“ì–∞–Ω.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- –î—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–∑–∞–≥–ª—É—à–∫–∏) -->
          <div id="page-home" class="page-content">
              <div class="content-card"><h2>–ë–∞—Å—Ç—ã –±–µ—Ç</h2><p>–ë“±–ª –∫–æ–Ω—Ç–µ–Ω—Ç ”ô–∑—ñ—Ä–ª–µ–Ω—É–¥–µ.</p></div>
          </div>

        </main>
    </div>

    <!-- ===================================================================== -->
    <!-- === –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô === -->
    <!-- ===================================================================== -->
    <div class="modal-overlay" id="user-modal-overlay">
        <div class="modal-container">
            <button class="close-btn" id="close-modal-btn">&times;</button>
            <div class="modal-header">
                <h2 id="modal-title">–ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã “õ“±—Ä—É</h2>
                <p>–ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã —Ç—É—Ä–∞–ª—ã –∞“õ–ø–∞—Ä–∞—Ç—Ç—ã —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑</p>
            </div>
            
            <form id="user-form" novalidate>
                {% csrf_token %}
                <input type="hidden" name="user_id" id="id_user_id">
                
                <div class="form-group">
                    <label for="id_full_name">–¢–æ–ª—ã“õ –∞—Ç—ã-–∂”©–Ω—ñ</label>
                    <input type="text" name="full_name" id="id_full_name" required>
                </div>

                <div class="form-group">
                    <label for="id_username">–ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã –∞—Ç—ã (Username)</label>
                    <input type="text" name="username" id="id_username" required>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label for="id_email">Email</label>
                        <input type="email" name="email" id="id_email" required>
                    </div>
                    <div class="form-group">
                        <label for="id_phone_number">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" name="phone_number" id="id_phone_number">
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label for="id_role">–†”©–ª—ñ</label>
                        <select name="role" id="id_role" required>
                            {% for value, display_name in role_choices %}
                                <option value="{{ value }}">{{ display_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="id_is_active">–ö“Ø–π—ñ</label>
                        <select name="is_active" id="id_is_active" required>
                            <option value="True">–ê–∫—Ç–∏–≤—Ç—ñ</option>
                            <option value="False">–ë–ª–æ–∫—Ç–∞–ª“ì–∞–Ω</option>
                        </select>
                    </div>
                </div>

                <div class="form-group" id="class-field-wrapper" style="display: none;">
                    <label for="id_school_class">–°—ã–Ω—ã–ø</label>
                    <select name="school_class" id="id_school_class">
                        <option value="">–°—ã–Ω—ã–ø—Ç—ã —Ç–∞“£–¥–∞“£—ã–∑</option>
                        {% for class in school_classes %}
                            <option value="{{ class.id }}">{{ class.name }} ({{ class.school.name }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group" id="subject-field-wrapper" style="display: none;">
                    <label for="id_subjects">–ü”ô–Ω–¥–µ—Ä</label>
                    <select name="subjects" id="id_subjects" multiple>
                        {% for subject in subjects %}
                            <option value="{{ subject.id }}">{{ subject.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="cancel-btn">–ë–æ–ª–¥—ã—Ä–º–∞—É</button>
                    <button type="submit" class="btn-submit" id="submit-btn">“ö“±—Ä—É</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- ===================================================================== -->
    <!-- === –°–´–ù–´–ü–¢–´ ”®“¢–î–ï–£ –ê–ë–ê–Ø–°–´ (–ú–û–î–ê–õ–¨–î–´“ö –¢–µ—Ä–µ–∑–µ) === -->
    <!-- ===================================================================== -->
    <div class="modal-overlay" id="class-modal-overlay">
        <div class="modal-container">
            <button class="close-btn" id="close-class-modal-btn">&times;</button>
            <div class="modal-header">
                <h2 id="class-modal-title">–°—ã–Ω—ã–ø—Ç—ã ”©“£–¥–µ—É</h2>
                <p>–°—ã–Ω—ã–ø —Ç—É—Ä–∞–ª—ã –∞“õ–ø–∞—Ä–∞—Ç—Ç—ã —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑</p>
            </div>
            
            <form id="class-form" novalidate>
                {% csrf_token %}
                <input type="hidden" name="class_id" id="id_class_id">
                
                <div class="form-group">
                    <label for="id_school_for_class">–ú–µ–∫—Ç–µ–ø</label>
                    <select name="school" id="id_school_for_class" required>
                        <option value="">-- –ú–µ–∫—Ç–µ–ø—Ç—ñ —Ç–∞“£–¥–∞“£—ã–∑ --</option>
                        {% for school in all_schools %}
                            <option value="{{ school.id }}">{{ school.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="id_class_name">–°—ã–Ω—ã–ø –∞—Ç–∞—É—ã</label>
                    <input type="text" name="name" id="id_class_name" placeholder="–ú—ã—Å–∞–ª—ã, 10–ë" required>
                </div>

                <div class="form-group">
                    <label for="id_class_teacher">–°—ã–Ω—ã–ø –∂–µ—Ç–µ–∫—à—ñ—Å—ñ</label>
                    <select name="class_teacher" id="id_class_teacher">
                        <option value="">–¢–∞“ì–∞–π—ã–Ω–¥–∞–ª–º–∞“ì–∞–Ω</option>
                        {% for teacher in all_teachers %}
                            <option value="{{ teacher.user.id }}">{{ teacher.user.get_full_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label>–û“õ—É—à—ã–ª–∞—Ä —Å–∞–Ω—ã</label>
                    <p id="student-count-display" style="font-weight: bold; margin-top: 8px;">-</p>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="cancel-class-btn">–ë–æ–ª–¥—ã—Ä–º–∞—É</button>
                    <button type="submit" class="btn-submit" id="submit-class-btn">–°–∞“õ—Ç–∞—É</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========================================================== -->
    <!-- === –ü”ò–ù–î–ï–† “Æ–®–Ü–ù –ñ–ê“¢–ê –ú–û–î–ê–õ–¨–î–´“ö –¢–ï–†–ï–ó–ï === -->
    <!-- ========================================================== -->
    <div class="modal-overlay" id="subject-modal-overlay">
        <div class="modal-container">
            <button class="close-btn" id="close-subject-modal-btn">&times;</button>
            <div class="modal-header">
                <h2 id="subject-modal-title">–ü”ô–Ω “õ“±—Ä—É</h2>
                <p>–ü”ô–Ω –∞—Ç–∞—É—ã–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑</p>
            </div>
            <form id="subject-form" novalidate>
                {% csrf_token %}
                <input type="hidden" name="subject_id" id="id_subject_id">
                <div class="form-group">
                    <label for="id_subject_name">–ü”ô–Ω –∞—Ç–∞—É—ã</label>
                    <input type="text" name="name" id="id_subject_name" placeholder="–ú—ã—Å–∞–ª—ã, –ê–ª–≥–µ–±—Ä–∞" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="cancel-subject-btn">–ë–æ–ª–¥—ã—Ä–º–∞—É</button>
                    <button type="submit" class="btn-submit" id="submit-subject-btn">“ö“±—Ä—É</button>
                </div>
            </form>
        </div>
    </div>


    <!-- ========================================================== -->
    <!-- === –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –ù–ê–ó–ù–ê–ß–ï–ù–ò–ô === -->
    <!-- ========================================================== -->
    <div class="modal-overlay" id="assignment-modal-overlay">
        <div class="modal-container">
            <button class="close-btn" id="close-assignment-modal-btn">&times;</button>
            <div class="modal-header">
                <h2 id="assignment-modal-title">–¢–∞“ì–∞–π—ã–Ω–¥–∞—É “õ“±—Ä—É</h2>
                <p>–ú“±“ì–∞–ª—ñ–º–¥—ñ —Å—ã–Ω—ã–ø –ø–µ–Ω –ø”ô–Ω–≥–µ —Ç–∞“ì–∞–π—ã–Ω–¥–∞“£—ã–∑</p>
            </div>
            <form id="assignment-form" novalidate>
                {% csrf_token %}
                <div class="form-group">
                    <label for="id_assignment_teacher">–ú“±“ì–∞–ª—ñ–º</label>
                    <select name="teacher" id="id_assignment_teacher" required>
                        <option value="">–ú“±“ì–∞–ª—ñ–º–¥—ñ —Ç–∞“£–¥–∞“£—ã–∑</option>
                        {% for teacher in all_teachers %}
                        <script>console.log("{{teacher.user.id}}")</script>
                        <option value="{{ teacher.user.id }}">{{ teacher.user.get_full_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="id_assignment_class">–°—ã–Ω—ã–ø</label>
                    <select name="school_class" id="id_assignment_class" required>
                        <option value="">–°—ã–Ω—ã–ø—Ç—ã —Ç–∞“£–¥–∞“£—ã–∑</option>
                        {% for s_class in school_classes %}
                        <option value="{{ s_class.id }}">{{ s_class.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="id_assignment_subject">–ü”ô–Ω</label>
                    <select name="subject" id="id_assignment_subject" required>
                        <option value="">–ü”ô–Ω–¥—ñ —Ç–∞“£–¥–∞“£—ã–∑</option>
                        {% for subject in subjects %}
                        <option value="{{ subject.id }}">{{ subject.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                 <div class="form-group">
                    <label for="id_assignment_hours">–ê–ø—Ç–∞—Å—ã–Ω–∞ —Å–∞“ì–∞—Ç—Ç–∞—Ä (–º—ñ–Ω–¥–µ—Ç—Ç—ñ –µ–º–µ—Å)</label>
                    <input type="number" name="hours_per_week" id="id_assignment_hours" min="1" placeholder="–ú—ã—Å–∞–ª—ã, 3">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="cancel-assignment-btn">–ë–æ–ª–¥—ã—Ä–º–∞—É</button>
                    <button type="submit" class="btn-submit" id="submit-assignment-btn">“ö“±—Ä—É</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========================================================== -->
    <!-- === –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –í–´–•–û–î–ù–´–• === -->
    <!-- ========================================================== -->
    <div class="modal-overlay" id="holiday-modal-overlay">
        <div class="modal-container">
            <button class="close-btn" id="close-holiday-modal-btn">&times;</button>
            <div class="modal-header">
                <h2 id="holiday-modal-title">–î–µ–º–∞–ª—ã—Å –∫“Ø–Ω—ñ–Ω “õ–æ—Å—É</h2>
                <p>–ö“Ø–Ω—ñ –º–µ–Ω —Å–µ–±–µ–±—ñ–Ω –∫”©—Ä—Å–µ—Ç—ñ“£—ñ–∑</p>
            </div>
            <form id="holiday-form" novalidate>
                {% csrf_token %}
                <input type="hidden" name="holiday_id" id="id_holiday_id">
                <div class="form-group">
                    <label for="id_holiday_date">–ö“Ø–Ω—ñ</label>
                    <input type="date" name="date" id="id_holiday_date" required>
                </div>
                <div class="form-group">
                    <label for="id_holiday_name">–ê—Ç–∞—É—ã / –°–µ–±–µ–±—ñ</label>
                    <input type="text" name="name" id="id_holiday_name" placeholder="–ú—ã—Å–∞–ª—ã, –ú“±“ì–∞–ª—ã–º–¥–∞—Ä –∫“Ø–Ω—ñ" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="cancel-holiday-btn">–ë–æ–ª–¥—ã—Ä–º–∞—É</button>
                    <button type="submit" class="btn-submit" id="submit-holiday-btn">“ö“±—Ä—É</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ===================================================================== -->
    <!-- === JAVASCRIPT === -->
    <!-- ===================================================================== -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        function initializeCustomSelects(container) {
        const selector = container ? container.querySelectorAll('select') : document.querySelectorAll('select');
        
        selector.forEach(selectElement => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª –ª–∏ —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
            if (selectElement.nextElementSibling && selectElement.nextElementSibling.classList.contains('custom-select-wrapper')) {
                return;
            }
            selectElement.style.display = 'none';

            const wrapper = document.createElement('div');
            wrapper.className = 'custom-select';
            
            const trigger = document.createElement('button');
            trigger.type = 'button';
            trigger.className = 'custom-select-trigger';
            
            const optionsList = document.createElement('ul');
            optionsList.className = 'custom-options';

            function syncUI() {
                const selectedOption = selectElement.options[selectElement.selectedIndex];
                trigger.textContent = selectedOption ? selectedOption.text : '...';
                
                Array.from(optionsList.children).forEach((li) => {
                    li.classList.toggle('selected', li.dataset.value === selectElement.value);
                });
            }

            Array.from(selectElement.options).forEach(option => {
                const li = document.createElement('li');
                li.className = 'custom-option';
                li.textContent = option.textContent;
                li.dataset.value = option.value;
                
                li.addEventListener('click', (e) => {
                    e.stopPropagation();
                    selectElement.value = option.value;
                    syncUI();
                    optionsList.classList.remove('open');
                    
                    const changeEvent = new Event('change', { bubbles: true });
                    selectElement.dispatchEvent(changeEvent);

                    // –ï—Å–ª–∏ —ç—Ç–æ —Ñ–æ—Ä–º–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –µ–µ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ
                    if (selectElement.closest('form')?.id === 'filter-form') {
                        selectElement.closest('form').submit();
                    }
                });
                optionsList.appendChild(li);
            });

            trigger.addEventListener('click', (e) => {
                e.stopPropagation();
                const wasOpen = optionsList.classList.contains('open');
                document.querySelectorAll('.custom-options.open').forEach(el => el.classList.remove('open'));
                if (!wasOpen) {
                    optionsList.classList.add('open');
                }
            });
            
            wrapper.appendChild(trigger);
            wrapper.appendChild(optionsList);
            selectElement.parentNode.insertBefore(wrapper, selectElement.nextSibling);

            syncUI();
        });
    }

    // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    initializeCustomSelects();

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å–ø–∏—Å–∫–æ–≤ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
    document.addEventListener('click', () => {
        document.querySelectorAll('.custom-options.open').forEach(el => el.classList.remove('open'));
    });
    })
    </script>


    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const navLinks = document.querySelectorAll('.main-nav a');
        const contentPages = document.querySelectorAll('.page-content');
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø–ú–ò (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
        const initUserManagementScripts = () => {
            const page = document.getElementById('page-users');
            if (!page) return;

            const modalOverlay = document.getElementById('user-modal-overlay');
            const form = document.getElementById('user-form');
            const modalTitle = document.getElementById('modal-title');
            const submitBtn = document.getElementById('submit-btn');
            const roleSelect = document.getElementById('id_role');
            const classField = document.getElementById('class-field-wrapper');
            const subjectField = document.getElementById('subject-field-wrapper');

            const openModal = () => modalOverlay.style.display = 'flex';
            const closeModal = () => modalOverlay.style.display = 'none';

            const toggleConditionalFields = () => {
                const role = roleSelect.value;
                classField.style.display = (role === 'student') ? 'block' : 'none';
                subjectField.style.display = (role === 'teacher') ? 'block' : 'none';
            };

            document.getElementById('create-user-btn').addEventListener('click', () => {
                form.reset();
                form.querySelector('#id_user_id').value = '';
                modalTitle.textContent = '–ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã “õ“±—Ä—É';
                submitBtn.textContent = '“ö“±—Ä—É';
                toggleConditionalFields();
                openModal();
            });

            document.getElementById('close-modal-btn').addEventListener('click', closeModal);
            document.getElementById('cancel-btn').addEventListener('click', closeModal);
            roleSelect.addEventListener('change', toggleConditionalFields);

            page.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', async e => {
                    e.preventDefault();
                    const userId = button.dataset.userId;
                    const response = await fetch(`/api/user/${userId}/details/`);
                    if (response.ok) {
                        const data = await response.json();
                        form.querySelector('#id_user_id').value = data.id;
                        form.querySelector('#id_full_name').value = data.full_name;
                        form.querySelector('#id_username').value = data.username;
                        form.querySelector('#id_email').value = data.email;
                        form.querySelector('#id_phone_number').value = data.phone_number || '';
                        form.querySelector('#id_role').value = data.role;
                        form.querySelector('#id_is_active').value = data.is_active ? 'True' : 'False';
                        if (data.school_class_id) form.querySelector('#id_school_class').value = data.school_class_id;
                        const subjectSelect = form.querySelector('#id_subjects');
                        Array.from(subjectSelect.options).forEach(opt => opt.selected = data.subject_ids.includes(parseInt(opt.value)));
                        modalTitle.textContent = '–ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã ”©“£–¥–µ—É';
                        submitBtn.textContent = '–°–∞“õ—Ç–∞—É';
                        toggleConditionalFields();
                        openModal();
                    }
                });
            });

            form.addEventListener('submit', async e => {
                e.preventDefault();
                const formData = new FormData(form);
                const subjectSelect = document.getElementById('id_subjects');
                if (subjectSelect.style.display !== 'none') {
                    formData.delete('subjects');
                    Array.from(subjectSelect.selectedOptions).forEach(opt => formData.append('subjects', opt.value));
                }
                const response = await fetch("{% url 'api_manage_user' %}", { method: 'POST', body: formData, headers: {'X-CSRFToken': csrfToken}});
                if (response.ok) location.reload();
                else alert('–§–æ—Ä–º–∞–¥–∞“ì—ã “õ–∞—Ç–µ');
            });

            page.querySelectorAll('.block-user-btn').forEach(button => {
                button.addEventListener('click', async e => {
                    e.preventDefault();
                    const userId = button.dataset.userId;
                    const response = await fetch(`/api/user/${userId}/toggle-status/`, { method: 'POST', headers: {'X-CSRFToken': csrfToken }});
                    if (response.ok) {
                        const result = await response.json();
                        const row = document.querySelector(`tr[data-user-row-id="${userId}"]`);
                        const statusBadge = row.querySelector('.status-badge');
                        const lockIcon = button.querySelector('i');
                        if (result.is_active) {
                            statusBadge.textContent = '–ê–∫—Ç–∏–≤—Ç—ñ';
                            statusBadge.className = 'status-badge status-active';
                            lockIcon.className = 'fa-solid fa-lock';
                            button.title = '–ë–ª–æ–∫—Ç–∞—É';
                        } else {
                            statusBadge.textContent = '–ë–ª–æ–∫—Ç–∞–ª“ì–∞–Ω';
                            statusBadge.className = 'status-badge status-blocked';
                            lockIcon.className = 'fa-solid fa-lock-open';
                            button.title = '–ë–ª–æ–∫—Ç–∞–Ω —à—ã“ì–∞—Ä—É';
                        }
                    }
                });
            });

            page.querySelectorAll('.delete-user-btn').forEach(button => {
                button.addEventListener('click', async e => {
                    e.preventDefault();
                    if (confirm('–û—Å—ã –ø–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã –∂–æ—é“ì–∞ —Å–µ–Ω—ñ–º–¥—ñ—Å—ñ–∑ –±–µ?')) {
                        const userId = button.dataset.userId;
                        const response = await fetch(`/api/user/${userId}/delete/`, { method: 'POST', headers: {'X-CSRFToken': csrfToken }});
                        if (response.ok) button.closest('tr').remove();
                        else alert('–ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã –∂–æ—é –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã.');
                    }
                });
            });
        };
        
        // --- –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –°–¢–†–£–ö–¢–£–†–´ –®–ö–û–õ–´ ---
        const initSchoolStructureScripts = () => {
            const page = document.getElementById('page-structure');
            if (!page) return;
        
            // --- –°—ã–Ω—ã–ø—Ç–∞—Ä–¥—ã –±–∞—Å“õ–∞—Ä—É“ì–∞ –∞—Ä–Ω–∞–ª“ì–∞–Ω –∞–π–Ω—ã–º–∞–ª—ã–ª–∞—Ä ---
            const classModalOverlay = document.getElementById('class-modal-overlay');
            const classForm = document.getElementById('class-form');
            const classModalTitle = document.getElementById('class-modal-title');
            const classSubmitBtn = document.getElementById('submit-class-btn');
            const studentCount = document.getElementById('student-count-display');
            const createClassBtn = document.getElementById('create-class-btn');
        
            // --- –ü”ò–ù–î–ï–†–î–Ü –ë–ê–°“ö–ê–†–£ “Æ–®–Ü–ù –ñ–ê“¢–ê –∞–π–Ω—ã–º–∞–ª—ã–ª–∞—Ä ---
            const subjectModalOverlay = document.getElementById('subject-modal-overlay');
            const subjectForm = document.getElementById('subject-form');
            const subjectModalTitle = document.getElementById('subject-modal-title');
            const subjectSubmitBtn = document.getElementById('submit-subject-btn');
            const createSubjectBtn = document.getElementById('create-subject-btn');
        
            // --- “ö–æ–π—ã–Ω–¥—ã–ª–∞—Ä –±–æ–π—ã–Ω—à–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏—è“ì–∞ –∞—Ä–Ω–∞–ª“ì–∞–Ω –∞–π–Ω—ã–º–∞–ª—ã–ª–∞—Ä ---
            const tabsNav = document.getElementById('structure-tabs-nav');
            const actionButtons = document.getElementById('structure-action-buttons');
            const tabPanes = page.querySelectorAll('.content-tab-pane');
        
            // --- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω ---
            const openClassModal = () => classModalOverlay.style.display = 'flex';
            const closeClassModal = () => classModalOverlay.style.display = 'none';
            const openSubjectModal = () => subjectModalOverlay.style.display = 'flex';
            const closeSubjectModal = () => subjectModalOverlay.style.display = 'none';
        
            // --- “ö–æ–π—ã–Ω–¥—ã–ª–∞—Ä–¥—ã –∞—É—ã—Å—Ç—ã—Ä—É –ª–æ–≥–∏–∫–∞—Å—ã ---
            tabsNav.querySelectorAll('a').forEach(tabLink => {
                tabLink.addEventListener('click', e => {
                    e.preventDefault();
                    const targetTab = tabLink.dataset.tab;
        
                    tabsNav.querySelectorAll('a').forEach(link => link.classList.remove('active'));
                    tabLink.classList.add('active');
        
                    tabPanes.forEach(pane => pane.classList.toggle('active', pane.id === `tab-${targetTab}`));
        
                    // --- ”®–ó–ì–ï–†–Ü–° ---
                    // "–°—ã–Ω—ã–ø “õ“±—Ä—É" –±–∞—Ç—ã—Ä–º–∞—Å—ã –µ–Ω–¥—ñ ”ô—Ä“õ–∞—à–∞–Ω –∫”©—Ä—ñ–Ω–µ–¥—ñ –∂”ô–Ω–µ ”©–∑–≥–µ—Ä–º–µ–π–¥—ñ.
                    // –¢–µ–∫ "–ü”ô–Ω “õ“±—Ä—É" –±–∞—Ç—ã—Ä–º–∞—Å—ã–Ω—ã“£ –∫”©—Ä—ñ–Ω—É—ñ–Ω –±–∞—Å“õ–∞—Ä–∞–º—ã–∑.
                    const createClassBtn = document.getElementById('create-class-btn');
                    const createSubjectBtn = document.getElementById('create-subject-btn');
                    createSubjectBtn.style.display = (targetTab === 'subjects') ? 'inline-flex' : 'none';

                    if (createSubjectBtn.style.display === 'inline-flex') {
                        createClassBtn.style.display = 'none';
                    } else {
                        createClassBtn.style.display = 'inline-flex';
                    }
                });
            });
        
                    // --- –°–´–ù–´–ü–¢–ê–† “Æ–®–Ü–ù –õ–û–ì–ò–ö–ê ---
            createClassBtn.addEventListener('click', () => {
                classForm.reset();
                classForm.querySelector('#id_class_id').value = '';
                classModalTitle.textContent = '–ñ–∞“£–∞ —Å—ã–Ω—ã–ø “õ“±—Ä—É';
                classSubmitBtn.textContent = '“ö“±—Ä—É';
                studentCount.textContent = '0';
                openClassModal();
            });
        
            document.getElementById('close-class-modal-btn').addEventListener('click', closeClassModal);
            document.getElementById('cancel-class-btn').addEventListener('click', closeClassModal);
        
            page.querySelectorAll('.edit-class-btn').forEach(button => {
                button.addEventListener('click', async e => {
                    e.preventDefault();
                    const classId = button.dataset.classId;
                    const response = await fetch(`/api/class/${classId}/details/`);
                    if (response.ok) {
                        const data = await response.json();
                        classForm.querySelector('#id_class_id').value = data.id;
                        classForm.querySelector('#id_class_name').value = data.name;
                        classForm.querySelector('#id_school_for_class').value = data.school_id;
                        classForm.querySelector('#id_class_teacher').value = data.class_teacher_id || '';
                        studentCount.textContent = data.student_count;
                        classModalTitle.textContent = '–°—ã–Ω—ã–ø—Ç—ã ”©“£–¥–µ—É';
                        classSubmitBtn.textContent = '–°–∞“õ—Ç–∞—É';
                        openClassModal();
                    } else {
                        alert("–°—ã–Ω—ã–ø –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ–Ω –∂“Ø–∫—Ç–µ—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã.");
                    }
                });
            });
        
            classForm.addEventListener('submit', async e => {
                e.preventDefault();
                const response = await fetch("{% url 'manage_class_api' %}", {
                    method: 'POST', body: new FormData(classForm), headers: {'X-CSRFToken': csrfToken}
                });
                if (response.ok) location.reload();
                else alert('–°—ã–Ω—ã–ø —Ñ–æ—Ä–º–∞—Å—ã–Ω—ã“£ —Ç–µ–∫—Å–µ—Ä—ñ—Å—ñ–Ω–¥–µ “õ–∞—Ç–µ.');
            });
        
            page.querySelectorAll('.delete-class-btn').forEach(button => {
                button.addEventListener('click', async e => {
                    e.preventDefault();
                    if (confirm('–û—Å—ã —Å—ã–Ω—ã–ø—Ç—ã –∂–æ—é“ì–∞ —Å–µ–Ω—ñ–º–¥—ñ—Å—ñ–∑ –±–µ?')) {
                        const classId = button.dataset.classId;
                        const response = await fetch(`/api/class/${classId}/delete/`, { method: 'POST', headers: {'X-CSRFToken': csrfToken}});
                    if (response.ok) {
                        button.closest('tr').remove();
                        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞, –Ω–æ –ø—Ä–æ—â–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
                        location.reload(); 
                    } else {
                        alert('–°—ã–Ω—ã–ø—Ç—ã –∂–æ—é –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã.');
                    }
                    }
                });
            });
        
            // === –ü”ò–ù–î–ï–† “Æ–®–Ü–ù –ñ–ê“¢–ê –õ–û–ì–ò–ö–ê ===
            createSubjectBtn.addEventListener('click', () => {
                subjectForm.reset();
                subjectForm.querySelector('#id_subject_id').value = '';
                subjectModalTitle.textContent = '–ü”ô–Ω “õ“±—Ä—É';
                subjectSubmitBtn.textContent = '“ö“±—Ä—É';
                openSubjectModal();
            });
        
            document.getElementById('close-subject-modal-btn').addEventListener('click', closeSubjectModal);
            document.getElementById('cancel-subject-btn').addEventListener('click', closeSubjectModal);
        
            subjectForm.addEventListener('submit', async e => {
                e.preventDefault();
                const response = await fetch("{% url 'api_manage_subject' %}", {
                    method: 'POST', body: new FormData(subjectForm), headers: {'X-CSRFToken': csrfToken}
                });
                if (response.ok) {
                    location.reload();
                } else {
                    alert('–¢–µ–∫—Å–µ—Ä—É “õ–∞—Ç–µ—Å—ñ. –ü”ô–Ω –∞—Ç–∞—É—ã –±—ñ—Ä–µ–≥–µ–π –µ–∫–µ–Ω—ñ–Ω–µ –∫”©–∑ –∂–µ—Ç–∫—ñ–∑—ñ“£—ñ–∑.');
                }
            });
        
            page.querySelectorAll('.edit-subject-btn').forEach(button => {
                button.addEventListener('click', async e => {
                    e.preventDefault();
                    const subjectId = button.dataset.subjectId;
                    const response = await fetch(`/api/subject/${subjectId}/details/`);
                    if (response.ok) {
                        const data = await response.json();
                        subjectForm.querySelector('#id_subject_id').value = data.id;
                        subjectForm.querySelector('#id_subject_name').value = data.name;
                        subjectModalTitle.textContent = '–ü”ô–Ω–¥—ñ ”©“£–¥–µ—É';
                        subjectSubmitBtn.textContent = '–°–∞“õ—Ç–∞—É';
                        openSubjectModal();
                    } else {
                        alert('–ü”ô–Ω –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ–Ω –∂“Ø–∫—Ç–µ—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã.');
                    }
                });
            });
        
            page.querySelectorAll('.delete-subject-btn').forEach(button => {
                button.addEventListener('click', async e => {
                    e.preventDefault();
                    if (confirm('–û—Å—ã –ø”ô–Ω–¥—ñ –∂–æ—é“ì–∞ —Å–µ–Ω—ñ–º–¥—ñ—Å—ñ–∑ –±–µ?')) {
                        const subjectId = button.dataset.subjectId;
                        const response = await fetch(`/api/subject/${subjectId}/delete/`, {
                            method: 'POST', headers: {'X-CSRFToken': csrfToken}
                        });
                        if (response.ok) {
                            button.closest('tr').remove();
                            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞, –Ω–æ –ø—Ä–æ—â–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
                            location.reload();
                        } else {
                            alert('–ü”ô–Ω–¥—ñ –∂–æ—é –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã. –û–ª –∫–µ—Å—Ç–µ–¥–µ –Ω–µ–º–µ—Å–µ —Ç–∞“ì–∞–π—ã–Ω–¥–∞—É–ª–∞—Ä–¥–∞ “õ–æ–ª–¥–∞–Ω—ã–ª—ã–ø —Ç“±—Ä –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω.');
                        }
                    }
                });
            });
        };

        // --- –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ù–ê–ó–ù–ê–ß–ï–ù–ò–Ø–ú–ò (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
        const initAssignmentsScripts = () => {
            const page = document.getElementById('page-assignments');
            if (!page) return;

            const modalOverlay = document.getElementById('assignment-modal-overlay');
            const form = document.getElementById('assignment-form');
            const createBtn = document.getElementById('create-assignment-btn');
            const closeModalBtn = document.getElementById('close-assignment-modal-btn');
            const cancelBtn = document.getElementById('cancel-assignment-btn');
            const deleteButtons = page.querySelectorAll('.delete-assignment-btn');

            const openModal = () => { modalOverlay.style.display = 'flex'; };
            const closeModal = () => { modalOverlay.style.display = 'none'; };

            createBtn.addEventListener('click', () => {
                form.reset();
                openModal();
            });
            closeModalBtn.addEventListener('click', closeModal);
            cancelBtn.addEventListener('click', closeModal);

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(form);
                const response = await fetch("{% url 'manage_assignment_api' %}", {
                    method: 'POST',
                    body: formData,
                    headers: {'X-CSRFToken': csrfToken}
                });
                if (response.ok) {
                    location.reload();
                } else {
                    const result = await response.json();
                    alert(`“ö–∞—Ç–µ: ${result.message || JSON.stringify(result)}`);
                }
            });

            deleteButtons.forEach(button => {
                button.addEventListener('click', async (e) => {
                    e.preventDefault();
                    if (confirm('–û—Å—ã —Ç–∞“ì–∞–π—ã–Ω–¥–∞—É–¥—ã –∂–æ—é“ì–∞ —Å–µ–Ω—ñ–º–¥—ñ—Å—ñ–∑ –±–µ?')) {
                        const assignmentId = button.dataset.assignmentId;
                        const response = await fetch(`/api/assignment/${assignmentId}/delete/`, {
                            method: 'POST',
                            headers: {'X-CSRFToken': csrfToken}
                        });
                        if (response.ok) {
                            button.closest('tr').remove();
                        } else {
                            alert('–¢–∞“ì–∞–π—ã–Ω–¥–∞—É–¥—ã –∂–æ—é –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã.');
                        }
                    }
                });
            });
        };

    // === –î–ï–ú–ê–õ–´–° –ö“Æ–ù–î–ï–†–Ü–ù –ë–ê–°“ö–ê–†–£ “Æ–®–Ü–ù –ñ–ê“¢–ê –§–£–ù–ö–¶–ò–Ø ===
        const initHolidayManagementScripts = () => {
            const page = document.getElementById('page-settings');
            if (!page) return;

            const modalOverlay = document.getElementById('holiday-modal-overlay');
            const form = document.getElementById('holiday-form');
            const modalTitle = document.getElementById('holiday-modal-title');
            const submitBtn = document.getElementById('submit-holiday-btn');

            const openModal = () => modalOverlay.style.display = 'flex';
            const closeModal = () => modalOverlay.style.display = 'none';

            document.getElementById('create-holiday-btn').addEventListener('click', () => {
                form.reset();
                form.querySelector('#id_holiday_id').value = '';
                modalTitle.textContent = '–î–µ–º–∞–ª—ã—Å –∫“Ø–Ω—ñ–Ω “õ–æ—Å—É';
                submitBtn.textContent = '“ö“±—Ä—É';
                openModal();
            });

            document.getElementById('close-holiday-modal-btn').addEventListener('click', closeModal);
            document.getElementById('cancel-holiday-btn').addEventListener('click', closeModal);

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const response = await fetch("{% url 'api_manage_holiday' %}", {
                    method: 'POST', body: new FormData(form), headers: {'X-CSRFToken': csrfToken}
                });
                if (response.ok) {
                    location.reload();
                } else {
                    alert('–¢–µ–∫—Å–µ—Ä—É “õ–∞—Ç–µ—Å—ñ. –ë–∞—Ä–ª—ã“õ ”©—Ä—ñ—Å—Ç–µ—Ä —Ç–æ–ª—Ç—ã—Ä—ã–ª“ì–∞–Ω—ã–Ω —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑.');
                }
            });

            page.querySelectorAll('.edit-holiday-btn').forEach(button => {
                button.addEventListener('click', async (e) => {
                    e.preventDefault();
                    const holidayId = button.dataset.holidayId;
                    const response = await fetch(`/api/holiday/${holidayId}/details/`);
                    if (response.ok) {
                        const data = await response.json();
                        form.querySelector('#id_holiday_id').value = data.id;
                        form.querySelector('#id_holiday_date').value = data.date;
                        form.querySelector('#id_holiday_name').value = data.name;
                        modalTitle.textContent = '–î–µ–º–∞–ª—ã—Å –∫“Ø–Ω—ñ–Ω ”©“£–¥–µ—É';
                        submitBtn.textContent = '–°–∞“õ—Ç–∞—É';
                        openModal();
                    }
                });
            });

            page.querySelectorAll('.delete-holiday-btn').forEach(button => {
                button.addEventListener('click', async (e) => {
                    e.preventDefault();
                    if (confirm('–û—Å—ã –∫“Ø–Ω–¥—ñ –∂–æ—é“ì–∞ —Å–µ–Ω—ñ–º–¥—ñ—Å—ñ–∑ –±–µ?')) {
                        const holidayId = button.dataset.holidayId;
                        const response = await fetch(`/api/holiday/${holidayId}/delete/`, {
                            method: 'POST', headers: {'X-CSRFToken': csrfToken}
                        });
                        if (response.ok) {
                            button.closest('tr').remove();
                        } else {
                            alert('–ñ–∞–∑–±–∞–Ω—ã –∂–æ—é –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã.');
                        }
                    }
                });
            });
        };

        // --- –û–ë–©–ê–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø –ò –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        const navigateTo = (pageId) => {
            contentPages.forEach(page => page.classList.remove('active'));
            const targetPage = document.getElementById(`page-${pageId}`);
            if (targetPage) targetPage.classList.add('active');
            navLinks.forEach(link => link.classList.toggle('active', link.dataset.target === pageId));
        };

        navLinks.forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                const pageId = e.currentTarget.dataset.target;
                navigateTo(pageId);
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É –≤ URL –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                window.history.pushState({page: pageId}, '', `?page=${pageId}`);
            });
        });

        // --- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ ---
        const urlParams = new URLSearchParams(window.location.search);
        const pageFromUrl = urlParams.get('page') || 'users'; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'users'
        navigateTo(pageFromUrl);
        
        // --- –í–´–ó–´–í–ê–ï–ú –í–°–ï –§–£–ù–ö–¶–ò–ò –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò ---
        initUserManagementScripts();
        initSchoolStructureScripts();
        initAssignmentsScripts();
        initHolidayManagementScripts(); // <-- –í–´–ó–û–í –ù–û–í–û–ô –§–£–ù–ö–¶–ò–ò
    });
    </script>
    <script>
    /* –ë“±–ª –∫–æ–¥—Ç—ã HTML —Å–æ“£—ã–Ω–¥–∞“ì—ã <script> —Ç–µ–≥—ñ–Ω–µ “õ–æ–π—ã“£—ã–∑ */
    /* –û–°–´ –°–ö–†–ò–ü–¢–¢–Ü “ö–û–õ–î–ê–ù–´“¢–´–ó */
    document.addEventListener('DOMContentLoaded', function() {
    // --- 2. –ú–û–ë–ò–õ–¨–î–Ü –ú–ï–ù–Æ –õ–û–ì–ò–ö–ê–°–´ ---
        const menuButton = document.getElementById('mobile-menu-btn');
        const closeButton = document.getElementById('mobile-menu-close-btn');
        const navMenu = document.querySelector('.main-nav');
        const mobileNavTitle = document.getElementById('mobile-nav-title');
        const navLinks = navMenu.querySelectorAll('a');

        if (menuButton) {
            // –ú”ô–∑—ñ—Ä–¥—ñ –∂–∞–±—É —Ñ—É–Ω–∫—Ü–∏—è—Å—ã
            const closeMenu = () => {
                navMenu.classList.remove('is-open');
                document.body.classList.remove('menu-open');
            };

            // –ë—É—Ä–≥–µ—Ä–≥–µ –±–∞—Å“õ–∞–Ω–¥–∞ –º”ô–∑—ñ—Ä –∞—à—É
            menuButton.addEventListener('click', function() {
                navMenu.classList.add('is-open');
                document.body.classList.add('menu-open');
            });

            // “ö–∞–π—Ç–∞—Ä—É –±–µ–ª–≥—ñ—Å—ñ–Ω–µ –±–∞—Å“õ–∞–Ω–¥–∞ –º”ô–∑—ñ—Ä–¥—ñ –∂–∞–±—É
            closeButton.addEventListener('click', closeMenu);

            // –ú–æ–±–∏–ª—å–¥—ñ –º”ô–∑—ñ—Ä–¥–µ–≥—ñ —Å—ñ–ª—Ç–µ–º–µ–≥–µ –±–∞—Å“õ–∞–Ω–¥–∞ —Ç–∞“õ—ã—Ä—ã–ø—Ç—ã –∂–∞“£–∞—Ä—Ç—ã–ø, –º”ô–∑—ñ—Ä–¥—ñ –∂–∞–±–∞–º—ã–∑
            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    mobileNavTitle.textContent = this.textContent.trim();
                    // –°–∞–º–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç—Å—è –≤ –±–ª–æ–∫–µ ‚Ññ1
                    closeMenu();
                });
            });
            
            // –ú”ô–∑—ñ—Ä–¥–µ–Ω —Ç—ã—Å –∂–µ—Ä–≥–µ –±–∞—Å“õ–∞–Ω–¥–∞ (–æ–≤–µ—Ä–ª–µ–π) –º”ô–∑—ñ—Ä–¥—ñ –∂–∞–±—É
            document.addEventListener('click', function(event) {
                if (navMenu.classList.contains('is-open') && !navMenu.contains(event.target) && !menuButton.contains(event.target)) {
                    closeMenu();
                }
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∞–≤–∏—à–µ Escape
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape' && navMenu.classList.contains('is-open')) {
                    closeMenu();
                }
            });
        }
    });
    </script>
</body>
</html>