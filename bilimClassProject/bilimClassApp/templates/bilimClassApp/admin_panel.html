{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sabaq Saqshy</title>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –∏–∫–æ–Ω–∫–∏ Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <!-- –ü–û–î–ö–õ–Æ–ß–ê–ï–ú –í–°–ï –°–¢–ò–õ–ò –ó–î–ï–°–¨ -->
    <link rel="stylesheet" href="{% static 'bilimClassApp/css/base.css' %}">
    <link rel="stylesheet" href="{% static 'bilimClassApp/css/admin_panel.css' %}">
    <link rel="stylesheet" href="{% static 'bilimClassApp/css/school_structure.css' %}">
    <style>
        /* –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª—å –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –∏ –≤–∫–ª–∞–¥–æ–∫ */
        .page-content, .content-tab-pane {
            display: none;
        }
        .page-content.active, .content-tab-pane.active {
            display: block;
        }

        .td-user-section { display: flex; align-items: center; gap: 16px; }
        .td-user-info { text-align: right; } .td-user-info h3 { font-weight: 600; }
        .td-user-info p { font-size: 14px; color: var(--text-secondary); }
        .td-user-link { text-decoration: none; color: inherit; }
        .td-user-avatar { width: 40px; height: 40px; border-radius: 10px; background-color: #D8B4FE; color: #581C87; display: grid; place-items: center; font-weight: 600; }
   
.custom-select {
    position: relative;
    display: inline-block;
    width: 100%; /* –ó–∞—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–Ω–∏–º–∞—Ç—å –≤—Å—é —à–∏—Ä–∏–Ω—É —Ä–æ–¥–∏—Ç–µ–ª—è */
}



/* –°–∫—Ä—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π select, –Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ–º –µ–≥–æ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º—ã */
.custom-select select {
    display: none;
}

.custom-select-trigger {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 12px;
    background: #FFFFFF;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px; /* –£–≤–µ–ª–∏—á–∏–º —à—Ä–∏—Ñ—Ç –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø–æ–ª—è–º –≤–≤–æ–¥–∞ */
    font-family: 'Inter', sans-serif;
    text-align: left;
    margin: 10px 0; /* –î–æ–±–∞–≤–∏–º –æ—Ç—Å—Ç—É–ø –∫–∞–∫ —É –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã */
    transition: border-color 0.2s, box-shadow 0.2s;
}

.custom-select-trigger:hover {
    border-color: #A5B4FC;
}

.custom-select-trigger:after {
    content: '\f078'; /* –ò–∫–æ–Ω–∫–∞ —à–µ–≤—Ä–æ–Ω–∞ –≤–Ω–∏–∑ –∏–∑ Font Awesome */
    font-family: 'Font Awesome 5 Free';
    font-weight: 900;
    margin-left: 8px;
    color: var(--text-secondary);
    transition: transform 0.2s ease;
}

.custom-options.open + .custom-select-trigger:after {
    transform: rotate(180deg);
}

.custom-options {
    position: absolute;
    top: calc(100% + 2px); /* –†–∞—Å–ø–æ–ª–∞–≥–∞–µ–º —á—É—Ç—å –Ω–∏–∂–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞ */
    left: 0;
    right: 0;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 8px 24px rgba(16, 24, 40, 0.1);
    list-style: none;
    padding: 8px 6px;
    margin: 0;
    max-height: 220px;
    overflow-y: auto;
    display: none;
    z-index: 1200;
}

.custom-options.open {
    display: block;
}

.custom-option {
    padding: 12px 14px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    font-family: 'Inter', sans-serif;
    transition: background-color 0.2s, color 0.2s;
}

.custom-option:hover {
    background-color: #F3F4F6;
}

.custom-option.selected {
    background: #EEF2FF;
    color: var(--accent-primary);
    font-weight: 600;
}
/* =================================================================
   –°–¢–ò–õ–ò –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–û–ô –ê–î–ê–ü–¢–ê–¶–ò–ò (ADMIN_PANEL)
   –í–µ—Ä—Å–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º CSS ::before –¥–ª—è –ø–æ–¥–ø–∏—Å–µ–π
================================================================= */

/* –°–∫—Ä—ã–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
.td-mobile-nav,
.mobile-menu-header {
    display: none;
}

@media (max-width: 1024px) {

    /* --- 1. –û–ë–©–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø –ú–ê–ö–ï–¢–ê --- */
    .container {
        padding: 16px;
    }

    .site-header {
        width: 90%;
        margin-left: 5%;
    }

    .page-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
    }
    .page-header .btn-primary {
        width: 100%;
    }
    .page-title h2 {
        font-size: 20px;
    }
    .content-card {
        padding: 16px;
    }

    /* --- 2. –ú–û–ë–ò–õ–¨–ù–ê–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø (–°–ê–ô–î–ë–ê–†) --- */
    .td-user-info { display: none; }
    .td-mobile-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        background-color: var(--bg-widget);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        margin-bottom: 20px;
    }
    #mobile-nav-title { font-size: 18px; font-weight: 600; }
    #mobile-menu-btn {
        background: transparent;
        border: none;
        font-size: 20px;
        cursor: pointer;
        padding: 8px;
        width: 40px;
        height: 40px;
        border-radius: 8px;
    }
    .main-nav {
        position: fixed;
        top: 0; right: 0;
        width: 300px;
        max-width: 90%;
        height: 100%;
        background-color: var(--bg-widget);
        box-shadow: -4px 0 25px rgba(0, 0, 0, 0.1);
        transform: translateX(100%);
        transition: transform 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        z-index: 2000;
        padding: 0;
        margin: 0;
        border-radius: 0;
        display: flex;
        flex-direction: column;
    }
    .main-nav.is-open { transform: translateX(0); }
    .mobile-menu-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 24px;
        border-bottom: 1px solid var(--border-color);
    }
    #mobile-menu-close-btn {
        background: transparent;
        border: none;
        font-size: 22px;
        cursor: pointer;
        padding: 8px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        color: var(--text-secondary);
    }
    .main-nav ul {
        flex-direction: column;
        gap: 8px;
        padding: 16px;
    }
    .main-nav a { padding: 14px 20px; font-size: 16px; font-weight: 500; }
    .main-nav a.active { background-color: var(--accent-primary); color: #fff; }
    body.menu-open::after {
        content: '';
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background-color: rgba(17, 24, 39, 0.6);
        z-index: 1999;
    }

    /* --- 3. –ê–î–ê–ü–¢–ê–¶–ò–Ø –¢–ê–ë–õ–ò–¶ (–ù–û–í–´–ô –ë–õ–û–ö) --- */

    /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü */
    .users-table thead,
    .data-table thead {
        display: none;
    }
    .users-table tr,
    .data-table tr {
        display: block;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        margin-bottom: 16px;
        background-color: #fff;
    }
    .users-table td,
    .data-table td {
        display: flex;
        justify-content: space-between;
        align-items: center;
        text-align: right;
        padding: 12px;
        border-bottom: 1px solid #f0f0f0;
    }
    .users-table tr td:last-child,
    .data-table tr td:last-child {
        border-bottom: none;
    }
    .users-table td::before,
    .data-table td::before {
        font-weight: 500;
        color: var(--text-secondary);
        text-align: left;
        margin-right: 16px;
    }

    /* –î–µ–ª–∞–µ–º –ø–µ—Ä–≤—É—é —è—á–µ–π–∫—É "–∑–∞–≥–æ–ª–æ–≤–∫–æ–º" –∫–∞—Ä—Ç–æ—á–∫–∏ */
    .users-table td:first-child,
    .data-table td:first-child {
        font-weight: 600;
        font-size: 16px;
        padding-top: 14px;
        padding-bottom: 14px;
    }
    .users-table td:first-child::before,
    .data-table td:first-child::before {
        content: "" !important; /* –£–±–∏—Ä–∞–µ–º –ø–æ–¥–ø–∏—Å—å —É –ø–µ—Ä–≤–æ–π —è—á–µ–π–∫–∏ */
    }

    #create-user-btn {
        width: 90%;
        margin-left: 5%;
    }

    .page-title {
        width: 90%;
        margin-left: 5%;
    }

    /* .td-mobile-nav {
        width: 90%;
        margin-left: 5%;
    } */

    .logo-text span {
        display: none;
    }

    /* --- –ü–æ–¥–ø–∏—Å–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô --- */
    #page-users .users-table td:nth-of-type(2)::before { content: 'Email'; }
    #page-users .users-table td:nth-of-type(3)::before { content: '–¢–µ–ª–µ—Ñ–æ–Ω'; }
    #page-users .users-table td:nth-of-type(4)::before { content: '–†–æ–ª—å'; }
    #page-users .users-table td:nth-of-type(5)::before { content: '–°—Ç–∞—Ç—É—Å'; }
    #page-users .users-table td:nth-of-type(6)::before { content: '–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥'; }
    #page-users .users-table td:nth-of-type(7)::before { content: '–î–µ–π—Å—Ç–≤–∏—è'; }
    
    /* --- –ü–æ–¥–ø–∏—Å–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –ö–õ–ê–°–°–û–í --- */
    #tab-classes .data-table td:nth-of-type(2)::before { content: '–£—á–µ–Ω–∏–∫–æ–≤'; }
    #tab-classes .data-table td:nth-of-type(3)::before { content: '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å'; }
    #tab-classes .data-table td:nth-of-type(4)::before { content: '–î–µ–π—Å—Ç–≤–∏—è:'; }

    /* --- –ü–æ–¥–ø–∏—Å–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –ü–†–ï–î–ú–ï–¢–û–í --- */
    #tab-subjects .data-table td:nth-of-type(2)::before { content: '–î–µ–π—Å—Ç–≤–∏—è:'; }

    #tab-subjects .data-table td {
        gap: 20px;
    }

    #page-assignments i {
        display: none;
    }


    /* --- –ü–æ–¥–ø–∏—Å–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –ù–ê–ó–ù–ê–ß–ï–ù–ò–ô --- */
    #page-assignments .data-table td:nth-of-type(2)::before { content: '–ö–ª–∞—Å—Å'; }
    #page-assignments .data-table td:nth-of-type(3)::before { content: '–ü—Ä–µ–¥–º–µ—Ç'; }
    #page-assignments .data-table td:nth-of-type(4)::before { content: '–ß–∞—Å—ã –≤ –Ω–µ–¥–µ–ª—é'; }
    #page-assignments .data-table td:nth-of-type(5)::before { content: '–î–µ–π—Å—Ç–≤–∏—è'; }
    
    /* --- –ü–æ–¥–ø–∏—Å–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –í–´–•–û–î–ù–´–• --- */
    #page-settings .data-table td:nth-of-type(2)::before { content: '–ü—Ä–∏—á–∏–Ω–∞'; }
    /* #page-settings .data-table td:nth-of-type(3)::before { content: '–î–µ–π—Å—Ç–≤–∏—è'; } */
    


    /* --- 4. –ê–î–ê–ü–¢–ê–¶–ò–Ø –§–ò–õ–¨–¢–†–û–í (–°–¢–†–ê–ù–ò–¶–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô) --- */
    .filters-toolbar {
        flex-direction: column;
        gap: 12px;
    }
    .filters-toolbar .search-group,
    .filters-toolbar .filter-select,
    .filters-toolbar .btn-primary,
    .filters-toolbar .btn-secondary {
        width: 100%;
    }

    /* --- 5. –ê–î–ê–ü–¢–ê–¶–ò–Ø –í–ö–õ–ê–î–û–ö (–°–¢–†–ê–ù–ò–¶–ê –°–¢–†–£–ö–¢–£–†–´) --- */
    #structure-card-header { flex-direction: column; gap: 16px; }
    #structure-tabs-nav {
        display: grid;
        grid-template-columns: 1fr 1fr;
        width: 100%;
        gap: 8px;
    }
    #structure-tabs-nav a { justify-content: center; }
    #structure-action-buttons { width: 100%; }
    #structure-action-buttons .btn-success,
    #structure-action-buttons .btn-info {
        width: 100%;
        justify-content: center;
    }
}
      
    </style>
</head>
<body class="td-body">
    
    <div class="container">
        <!-- ===================================================================== -->
        <!-- === –û–ë–©–ê–Ø –®–ê–ü–ö–ê (–≤–∏–¥–Ω–∞ –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö) === -->
        <!-- ===================================================================== -->
        <header class="site-header">
            <div class="logo-section">
                <div class="logo-icon">üéì</div>
                <div class="logo-text">
                    <h1>Sabaq Saqshy</h1>
                    <span>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–µ–±–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º</span>
                </div>
            </div>
            <div class="td-user-section">
                <div class="td-user-info">
                    <a href="{% url 'profile' %}" class="td-user-link">
                        <h3>{{ user.get_full_name }}</h3>
                    </a>
                    <a href="{% url 'logout' %}" class="logout-link" style="font-size: 14px; color: #6B7280;" title="–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞">
                        –í—ã–π—Ç–∏
                    </a>
                </div>
                <a href="{% url 'profile' %}" class="td-user-link">
                    <div class="td-user-avatar">{{ user.first_name|first }}{{ user.last_name|first }}</div>
                </a>
            </div>
        </header>

        <div class="td-mobile-nav">
            <h2 id="mobile-nav-title">–ì–ª–∞–≤–Ω–∞—è</h2>
            <button id="mobile-menu-btn" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <!-- ===================================================================== -->
        <!-- === –û–ë–©–ê–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø (–≤–∏–¥–Ω–∞ –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö) === -->
        <!-- ===================================================================== -->
        <nav class="main-nav">
            <div class="mobile-menu-header">
                <h3>–ú–µ–Ω—é</h3>
                <button id="mobile-menu-close-btn" aria-label="–ó–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <ul>
                <!-- data-target –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è JS –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
                <li><a href="#" data-target="users" class="active"><i class="fa-solid fa-users"></i> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a></li>
                <li><a href="#" data-target="structure"><i class="fa-solid fa-sitemap"></i> –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —à–∫–æ–ª—ã</a></li>
                <li><a href="#" data-target="assignments"><i class="fa-solid fa-user-tag"></i> –ù–∞–∑–Ω–∞—á–µ–Ω–∏—è</a></li>
                <li><a href="#" data-target="settings"><i class="fa-solid fa-gear"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
            </ul>
        </nav>

        <!-- ===================================================================== -->
        <!-- === –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –î–ò–ù–ê–ú–ò–ß–ï–°–ö–û–ì–û –ö–û–ù–¢–ï–ù–¢–ê === -->
        <!-- ===================================================================== -->
        <main id="app-content">
            
            <!-- –°–¢–†–ê–ù–ò–¶–ê "–£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø–ú–ò" -->
            <div id="page-users" class="page-content active">
                <div class="page-header">
                    <div class="page-title">
                        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
                        <p>–°–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–µ—Ç–Ω—ã–º–∏ –∑–∞–ø–∏—Å—è–º–∏</p>
                    </div>
                    <button class="btn-primary" id="create-user-btn">
                        <i class="fa-solid fa-plus"></i>
                        –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    </button>
                </div>
        
                <div class="content-card">
                    <form method="GET" action="{% url 'admin_panel' %}" class="filters-toolbar">
                        <!-- –î–æ–±–∞–≤–ª–µ–Ω –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –≤ JS -->
                        {% csrf_token %}
                        <div class="search-group">
                            <i class="fa-solid fa-search"></i>
                            <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ email..." value="{{ search_query }}">
                        </div>
                        <select name="role" class="filter-select">
                            <option value="">–í—Å–µ —Ä–æ–ª–∏</option>
                            {% for value, display_name in role_choices %}
                                <option value="{{ value }}" {% if role_filter == value %}selected{% endif %}>
                                    {{ display_name }}
                                </option>
                            {% endfor %}
                        </select>
                        <select name="status" class="filter-select">
                            <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                            <option value="active" {% if status_filter == 'active' %}selected{% endif %}>–ê–∫—Ç–∏–≤–µ–Ω</option>
                            <option value="inactive" {% if status_filter == 'inactive' %}selected{% endif %}>–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</option>
                        </select>
                        <button type="submit" class="btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                        <a href="{% url 'admin_panel' %}" class="btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
                    </form>
        
                    <nav class="content-tabs">
                        <ul>
                            <li>
                                <a href="#" class="active">
                                    –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                                    <span class="count-badge">{{ users.count }}</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
        
                    <div class="table-wrapper">
                        <table class="users-table">
                            <thead>
                                <tr>
                                    <th>–§–ò–û</th>
                                    <th>Email</th>
                                    <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                    <th>–†–æ–ª—å</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user_obj in users %}
                                <!-- –ò–ó–ú–ï–ù–ï–ù–ò–ï: –î–æ–±–∞–≤–ª–µ–Ω data-–∞—Ç—Ä–∏–±—É—Ç –¥–ª—è –ª–µ–≥–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Å—Ç—Ä–æ–∫–∏ -->
                                <tr data-user-row-id="{{ user_obj.id }}">
                                    <td>{{ user_obj.get_full_name|default:user_obj.username }}</td>
                                    <td class="user-name-cell">
                                        <span>{{ user_obj.email|default:"-" }}</span>
                                        {% if user_obj.email %}<i class="fa-regular fa-envelope"></i>{% endif %}
                                    </td>
                                    <td>
                                        {{ user_obj.profile.phone_number|default:"-" }}
                                    </td>
                                    <td>
                                        {% if user_obj.profile and user_obj.profile.role %}
                                            {% if user_obj.profile.role == 'teacher' %}
                                                <span class="role-badge role-teacher">{{ user_obj.profile.get_role_display }}</span>
                                            {% elif user_obj.profile.role == 'student' %}
                                                <span class="role-badge role-student">{{ user_obj.profile.get_role_display }}</span>
                                            {% elif user_obj.profile.role == 'headteacher' %}
                                                <span class="role-badge role-headteacher">{{ user_obj.profile.get_role_display }}</span>
                                            {% else %}
                                                <span>{{ user_obj.profile.get_role_display }}</span>
                                            {% endif %}
                                        {% else %}
                                            <span>-</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if user_obj.is_active %}
                                            <span class="status-badge status-active">–ê–∫—Ç–∏–≤–µ–Ω</span>
                                        {% else %}
                                            <span class="status-badge status-blocked">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ user_obj.last_login|date:"Y-m-d H:i"|default:"–ù–∏–∫–æ–≥–¥–∞" }}</td>
                                    <td class="action-icons">
                                        <!-- –ò–ó–ú–ï–ù–ï–ù–ò–ï: –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Å–µ –∏–∫–æ–Ω–∫–∏ –≤ —Ç–µ–≥–∏ <a> –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã/–∞—Ç—Ä–∏–±—É—Ç—ã -->
                                        <a href="#" class="edit-btn" data-user-id="{{ user_obj.id }}" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"><i class="fa-solid fa-pencil"></i></a>
                                        <a href="#" class="block-user-btn" data-user-id="{{ user_obj.id }}" title="{% if user_obj.is_active %}–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å{% else %}–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å{% endif %}">
                                            <i class="fa-solid fa-lock{% if not user_obj.is_active %}-open{% endif %}"></i>
                                        </a>
                                        <a href="#" class="delete-user-btn" data-user-id="{{ user_obj.id }}" title="–£–¥–∞–ª–∏—Ç—å"><i class="fa-solid fa-trash-can"></i></a>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 24px;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –°–¢–†–ê–ù–ò–¶–ê "–°–¢–†–£–ö–¢–£–†–ê –®–ö–û–õ–´" -->
            <div id="page-structure" class="page-content">
                <div class="page-header">
                    <h2><i class="fa-solid fa-graduation-cap"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π —à–∫–æ–ª—ã</h2>
                    <p>–°–æ–∑–¥–∞–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤ –∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</p>
                </div>
        
                <div class="content-card">
                    <div class="card-header" id="structure-card-header">
                        <nav class="content-tabs" id="structure-tabs-nav">
                            <!-- –ò–ó–ú–ï–ù–ï–ù–ò–ï: –î–æ–±–∞–≤–ª–µ–Ω—ã data-–∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è JS -->
                            <a href="#" data-tab="classes" class="active"><i class="fa-solid fa-people-roof"></i> –ö–ª–∞—Å—Å—ã <span class="count-badge">{{ structure_school_classes.count }}</span></a>
                            <a href="#" data-tab="subjects"><i class="fa-solid fa-book"></i> –ü—Ä–µ–¥–º–µ—Ç—ã <span class="count-badge">{{ subjects.count }}</span></a>
                        </nav>
                        <!-- –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ö–Ω–æ–ø–∫–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è -->
                        <div id="structure-action-buttons">
                            <button class="btn-success" id="create-class-btn" style="display: flex;"><i class="fa-solid fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å</button>
                            <button class="btn-info btn-primary" id="create-subject-btn" style="display: none;"><i class="fa-solid fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç</button>
                        </div>
                    </div>
                    
                    <!-- –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ –æ–±–µ—Ä–Ω—É—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ div -->
                    <div id="tab-classes" class="content-tab-pane active">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>–ö–ª–∞—Å—Å</th>
                                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–µ–Ω–∏–∫–æ–≤</th>
                                    <th>–ö–ª–∞—Å—Å–Ω—ã–π —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å</th>
                                    <th style="text-align: end;">–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for s_class in structure_school_classes %}
                                <tr data-class-row-id="{{ s_class.id }}">
                                    <td><strong>{{ s_class.name }}</strong></td>
                                    <td class="student-count-cell"><i class="fa-solid fa-user-group"></i> {{ s_class.student_count }}</td>
                                    <td>{{ s_class.class_teacher.user.get_full_name|default:"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω" }}</td>
                                    <td class="action-icons" style="justify-content: end; gap:40px;">
                                        <a href="#" class="edit-class-btn" data-class-id="{{ s_class.id }}"><i class="fa-solid fa-pencil"></i></a>
                                        <a href="#" class="delete-class-btn" data-class-id="{{ s_class.id }}"><i class="fa-solid fa-trash-can"></i></a>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr><td colspan="4" style="text-align: center; padding: 24px;">–ö–ª–∞—Å—Å—ã –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω—ã.</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <div id="tab-subjects" class="content-tab-pane">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞</th>
                                    <th style="text-align: end;">–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for subject in subjects %}
                                <tr data-subject-row-id="{{ subject.id }}">
                                    <td><strong>{{ subject.name }}</strong></td>
                                    <td class="action-icons" style="justify-content: end; gap:40px;">
                                        <a href="#" class="edit-subject-btn" data-subject-id="{{ subject.id }}"><i class="fa-solid fa-pencil"></i></a>
                                        <a href="#" class="delete-subject-btn" data-subject-id="{{ subject.id }}"><i class="fa-solid fa-trash-can"></i></a>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr><td colspan="2" style="text-align: center; padding: 24px;">–ü—Ä–µ–¥–º–µ—Ç—ã –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω—ã.</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                </div>
            </div>
            
            <!-- ========================================================== -->
            <!-- === –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –°–¢–†–ê–ù–ò–¶–ê "–ù–ê–ó–ù–ê–ß–ï–ù–ò–Ø" === -->
            <!-- ========================================================== -->
            <div id="page-assignments" class="page-content">
                <div class="page-header">
                    <div>
                        <h2><i class="fa-solid fa-user-tag"></i> –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —É—á–∏—Ç–µ–ª–µ–π</h2>
                        <p>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—á–∏—Ç–µ–ª–µ–π –ø–æ –∫–ª–∞—Å—Å–∞–º –∏ –ø—Ä–µ–¥–º–µ—Ç–∞–º</p>
                    </div>
                    <button class="btn-primary" id="create-assignment-btn">
                        <i class="fa-solid fa-plus"></i>
                        –°–æ–∑–¥–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
                    </button>
                </div>
                <div class="content-card">
                    <div class="card-header">
                        <nav class="content-tabs">
                            <a href="#" class="active">–í—Å–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</a>
                        </nav>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>–£—á–∏—Ç–µ–ª—å</th>
                                <th>–ö–ª–∞—Å—Å</th>
                                <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                                <th>–ß–∞—Å–æ–≤ –≤ –Ω–µ–¥–µ–ª—é</th>
                                <th style="text-align: end;">–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for assignment in all_assignments %}
                            <tr data-assignment-row-id="{{ assignment.id }}">
                                <td><strong>{{ assignment.teacher.user.get_full_name }}</strong></td>
                                <td><i class="fa-solid fa-user-group"></i> {{ assignment.school_class.name }}</td>
                                <td><i class="fa-solid fa-book"></i> {{ assignment.subject.name }}</td>
                                <td>{{ assignment.hours_per_week|default:"-" }}</td>
                                <td class="action-icons" style="justify-content: end;">
                                    <a href="#" class="delete-assignment-btn" data-assignment-id="{{ assignment.id }}" title="–£–¥–∞–ª–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ"><i class="fa-solid fa-trash-can"></i></a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="5" style="text-align: center; padding: 24px;">–ù–∞–∑–Ω–∞—á–µ–Ω–∏—è –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω—ã.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- ========================================================== -->
            <!-- === –ù–û–í–ê–Ø –°–¢–†–ê–ù–ò–¶–ê "–ù–ê–°–¢–†–û–ô–ö–ò" === -->
            <!-- ========================================================== -->
            <div id="page-settings" class="page-content">
                <div class="page-header">
                    <div>
                        <h2><i class="fa-solid fa-calendar-days"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–Ω—ã–º–∏</h2>
                        <p>–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –∏–ª–∏ –Ω–µ—Ä–∞–±–æ—á–∏–µ –¥–Ω–∏ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å</p>
                    </div>
                    <button class="btn-primary" id="create-holiday-btn">
                        <i class="fa-solid fa-plus"></i>
                        –î–æ–±–∞–≤–∏—Ç—å –¥–µ–Ω—å
                    </button>
                </div>
                <div class="content-card">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ / –ü—Ä–∏—á–∏–Ω–∞</th>
                                <th style="text-align: end;">–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for holiday in all_holidays %}
                            <tr data-holiday-row-id="{{ holiday.id }}">
                                <td><strong>{{ holiday.date|date:"d.m.Y" }}</strong></td>
                                <td>{{ holiday.name }}</td>
                                <td class="action-icons" style="justify-content: end; gap:40px;">
                                    <a href="#" class="edit-holiday-btn" data-holiday-id="{{ holiday.id }}" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"><i class="fa-solid fa-pencil"></i></a>
                                    <a href="#" class="delete-holiday-btn" data-holiday-id="{{ holiday.id }}" title="–£–¥–∞–ª–∏—Ç—å"><i class="fa-solid fa-trash-can"></i></a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="3" style="text-align: center; padding: 24px;">–í—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- –î—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–∑–∞–≥–ª—É—à–∫–∏) -->
            <div id="page-home" class="page-content">
                 <div class="content-card"><h2>–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</h2><p>–≠—Ç–æ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.</p></div>
            </div>

        </main>
    </div>

    <!-- ===================================================================== -->
    <!-- === –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô === -->
    <!-- ===================================================================== -->
    <div class="modal-overlay" id="user-modal-overlay">
        <div class="modal-container">
            <button class="close-btn" id="close-modal-btn">&times;</button>
            <div class="modal-header">
                <h2 id="modal-title">–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
                <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</p>
            </div>
            
            <form id="user-form" novalidate>
                {% csrf_token %}
                <input type="hidden" name="user_id" id="id_user_id">
                
                <div class="form-group">
                    <label for="id_full_name">–§–ò–û</label>
                    <input type="text" name="full_name" id="id_full_name" required>
                </div>

                <div class="form-group">
                    <label for="id_username">–õ–æ–≥–∏–Ω (Username)</label>
                    <input type="text" name="username" id="id_username" required>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label for="id_email">Email</label>
                        <input type="email" name="email" id="id_email" required>
                    </div>
                    <div class="form-group">
                        <label for="id_phone_number">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" name="phone_number" id="id_phone_number">
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label for="id_role">–†–æ–ª—å</label>
                        <select name="role" id="id_role" required>
                            {% for value, display_name in role_choices %}
                                <option value="{{ value }}">{{ display_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="id_is_active">–°—Ç–∞—Ç—É—Å</label>
                        <select name="is_active" id="id_is_active" required>
                            <option value="True">–ê–∫—Ç–∏–≤–µ–Ω</option>
                            <option value="False">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</option>
                        </select>
                    </div>
                </div>

                <div class="form-group" id="class-field-wrapper" style="display: none;">
                    <label for="id_school_class">–ö–ª–∞—Å—Å</label>
                    <select name="school_class" id="id_school_class">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å</option>
                        {% for class in school_classes %}
                            <option value="{{ class.id }}">{{ class.name }} ({{ class.school.name }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group" id="subject-field-wrapper" style="display: none;">
                    <label for="id_subjects">–ü—Ä–µ–¥–º–µ—Ç—ã</label>
                    <select name="subjects" id="id_subjects" multiple>
                        {% for subject in subjects %}
                            <option value="{{ subject.id }}">{{ subject.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn-submit" id="submit-btn">–°–æ–∑–¥–∞—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- ===================================================================== -->
    <!-- === –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –ö–õ–ê–°–°–ê === -->
    <!-- ===================================================================== -->
    <div class="modal-overlay" id="class-modal-overlay">
        <div class="modal-container">
            <button class="close-btn" id="close-class-modal-btn">&times;</button>
            <div class="modal-header">
                <h2 id="class-modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å</h2>
                <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–∞—Å—Å–µ</p>
            </div>
            
            <form id="class-form" novalidate>
                {% csrf_token %}
                <input type="hidden" name="class_id" id="id_class_id">
                
                <div class="form-group">
                    <label for="id_school_for_class">–®–∫–æ–ª–∞</label>
                    <select name="school" id="id_school_for_class" required>
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —à–∫–æ–ª—É --</option>
                        {% for school in all_schools %}
                            <option value="{{ school.id }}">{{ school.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="id_class_name">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∞</label>
                    <input type="text" name="name" id="id_class_name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 10–ë" required>
                </div>

                <div class="form-group">
                    <label for="id_class_teacher">–ö–ª–∞—Å—Å–Ω—ã–π —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å</label>
                    <select name="class_teacher" id="id_class_teacher">
                        <option value="">–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</option>
                        {% for teacher in all_teachers %}
                            <option value="{{ teacher.user.id }}">{{ teacher.user.get_full_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–µ–Ω–∏–∫–æ–≤</label>
                    <p id="student-count-display" style="font-weight: bold; margin-top: 8px;">-</p>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="cancel-class-btn">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn-submit" id="submit-class-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========================================================== -->
    <!-- === –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –ü–†–ï–î–ú–ï–¢–û–í === -->
    <!-- ========================================================== -->
    <div class="modal-overlay" id="subject-modal-overlay">
        <div class="modal-container">
            <button class="close-btn" id="close-subject-modal-btn">&times;</button>
            <div class="modal-header">
                <h2 id="subject-modal-title">–°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç</h2>
                <p>–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É—á–µ–±–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞</p>
            </div>
            <form id="subject-form" novalidate>
                {% csrf_token %}
                <input type="hidden" name="subject_id" id="id_subject_id">
                <div class="form-group">
                    <label for="id_subject_name">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞</label>
                    <input type="text" name="name" id="id_subject_name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ê–ª–≥–µ–±—Ä–∞" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="cancel-subject-btn">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn-submit" id="submit-subject-btn">–°–æ–∑–¥–∞—Ç—å</button>
                </div>
            </form>
        </div>
    </div>


    <!-- ========================================================== -->
    <!-- === –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –ù–ê–ó–ù–ê–ß–ï–ù–ò–ô === -->
    <!-- ========================================================== -->
    <div class="modal-overlay" id="assignment-modal-overlay">
        <div class="modal-container">
            <button class="close-btn" id="close-assignment-modal-btn">&times;</button>
            <div class="modal-header">
                <h2 id="assignment-modal-title">–°–æ–∑–¥–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ</h2>
                <p>–ù–∞–∑–Ω–∞—á—å—Ç–µ —É—á–∏—Ç–µ–ª—è –Ω–∞ –∫–ª–∞—Å—Å –∏ –ø—Ä–µ–¥–º–µ—Ç</p>
            </div>
            <form id="assignment-form" novalidate>
                {% csrf_token %}
                <div class="form-group">
                    <label for="id_assignment_teacher">–£—á–∏—Ç–µ–ª—å</label>
                    <select name="teacher" id="id_assignment_teacher" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∏—Ç–µ–ª—è</option>
                        {% for teacher in all_teachers %}
                        <script>console.log("{{teacher.user.id}}")</script>
                        <option value="{{ teacher.user.id }}">{{ teacher.user.get_full_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="id_assignment_class">–ö–ª–∞—Å—Å</label>
                    <select name="school_class" id="id_assignment_class" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å</option>
                        {% for s_class in school_classes %}
                        <option value="{{ s_class.id }}">{{ s_class.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="id_assignment_subject">–ü—Ä–µ–¥–º–µ—Ç</label>
                    <select name="subject" id="id_assignment_subject" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç</option>
                        {% for subject in subjects %}
                        <option value="{{ subject.id }}">{{ subject.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                 <div class="form-group">
                    <label for="id_assignment_hours">–ß–∞—Å–æ–≤ –≤ –Ω–µ–¥–µ–ª—é (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <input type="number" name="hours_per_week" id="id_assignment_hours" min="1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 3">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="cancel-assignment-btn">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn-submit" id="submit-assignment-btn">–°–æ–∑–¥–∞—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========================================================== -->
    <!-- === –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –í–´–•–û–î–ù–´–• === -->
    <!-- ========================================================== -->
    <div class="modal-overlay" id="holiday-modal-overlay">
        <div class="modal-container">
            <button class="close-btn" id="close-holiday-modal-btn">&times;</button>
            <div class="modal-header">
                <h2 id="holiday-modal-title">–î–æ–±–∞–≤–∏—Ç—å –≤—ã—Ö–æ–¥–Ω–æ–π –¥–µ–Ω—å</h2>
                <p>–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É –∏ –ø—Ä–∏—á–∏–Ω—É</p>
            </div>
            <form id="holiday-form" novalidate>
                {% csrf_token %}
                <input type="hidden" name="holiday_id" id="id_holiday_id">
                <div class="form-group">
                    <label for="id_holiday_date">–î–∞—Ç–∞</label>
                    <input type="date" name="date" id="id_holiday_date" required>
                </div>
                <div class="form-group">
                    <label for="id_holiday_name">–ù–∞–∑–≤–∞–Ω–∏–µ / –ü—Ä–∏—á–∏–Ω–∞</label>
                    <input type="text" name="name" id="id_holiday_name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –î–µ–Ω—å –£—á–∏—Ç–µ–ª—è" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="cancel-holiday-btn">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn-submit" id="submit-holiday-btn">–°–æ–∑–¥–∞—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ===================================================================== -->
    <!-- === JAVASCRIPT === -->
    <!-- ===================================================================== -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        function initializeCustomSelects(container) {
        const selector = container ? container.querySelectorAll('select') : document.querySelectorAll('select');
        
        selector.forEach(selectElement => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª –ª–∏ —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
            if (selectElement.nextElementSibling && selectElement.nextElementSibling.classList.contains('custom-select-wrapper')) {
                return;
            }
            selectElement.style.display = 'none';

            const wrapper = document.createElement('div');
            wrapper.className = 'custom-select';
            
            const trigger = document.createElement('button');
            trigger.type = 'button';
            trigger.className = 'custom-select-trigger';
            
            const optionsList = document.createElement('ul');
            optionsList.className = 'custom-options';

            function syncUI() {
                const selectedOption = selectElement.options[selectElement.selectedIndex];
                trigger.textContent = selectedOption ? selectedOption.text : '...';
                
                Array.from(optionsList.children).forEach((li) => {
                    li.classList.toggle('selected', li.dataset.value === selectElement.value);
                });
            }

            Array.from(selectElement.options).forEach(option => {
                const li = document.createElement('li');
                li.className = 'custom-option';
                li.textContent = option.textContent;
                li.dataset.value = option.value;
                
                li.addEventListener('click', (e) => {
                    e.stopPropagation();
                    selectElement.value = option.value;
                    syncUI();
                    optionsList.classList.remove('open');
                    
                    const changeEvent = new Event('change', { bubbles: true });
                    selectElement.dispatchEvent(changeEvent);

                    // –ï—Å–ª–∏ —ç—Ç–æ —Ñ–æ—Ä–º–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –µ–µ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ
                    if (selectElement.closest('form')?.id === 'filter-form') {
                        selectElement.closest('form').submit();
                    }
                });
                optionsList.appendChild(li);
            });

            trigger.addEventListener('click', (e) => {
                e.stopPropagation();
                const wasOpen = optionsList.classList.contains('open');
                document.querySelectorAll('.custom-options.open').forEach(el => el.classList.remove('open'));
                if (!wasOpen) {
                    optionsList.classList.add('open');
                }
            });
            
            wrapper.appendChild(trigger);
            wrapper.appendChild(optionsList);
            selectElement.parentNode.insertBefore(wrapper, selectElement.nextSibling);

            syncUI();
        });
    }

    // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    initializeCustomSelects();

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å–ø–∏—Å–∫–æ–≤ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
    document.addEventListener('click', () => {
        document.querySelectorAll('.custom-options.open').forEach(el => el.classList.remove('open'));
    });
    })
    </script>


    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const navLinks = document.querySelectorAll('.main-nav a');
        const contentPages = document.querySelectorAll('.page-content');
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø–ú–ò (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
        const initUserManagementScripts = () => {
            const page = document.getElementById('page-users');
            if (!page) return;

            const modalOverlay = document.getElementById('user-modal-overlay');
            const form = document.getElementById('user-form');
            const modalTitle = document.getElementById('modal-title');
            const submitBtn = document.getElementById('submit-btn');
            const roleSelect = document.getElementById('id_role');
            const classField = document.getElementById('class-field-wrapper');
            const subjectField = document.getElementById('subject-field-wrapper');

            const openModal = () => modalOverlay.style.display = 'flex';
            const closeModal = () => modalOverlay.style.display = 'none';

            const toggleConditionalFields = () => {
                const role = roleSelect.value;
                classField.style.display = (role === 'student') ? 'block' : 'none';
                subjectField.style.display = (role === 'teacher') ? 'block' : 'none';
            };

            document.getElementById('create-user-btn').addEventListener('click', () => {
                form.reset();
                form.querySelector('#id_user_id').value = '';
                modalTitle.textContent = '–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è';
                submitBtn.textContent = '–°–æ–∑–¥–∞—Ç—å';
                toggleConditionalFields();
                openModal();
            });

            document.getElementById('close-modal-btn').addEventListener('click', closeModal);
            document.getElementById('cancel-btn').addEventListener('click', closeModal);
            roleSelect.addEventListener('change', toggleConditionalFields);

            page.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', async e => {
                    e.preventDefault();
                    const userId = button.dataset.userId;
                    const response = await fetch(`/api/user/${userId}/details/`);
                    if (response.ok) {
                        const data = await response.json();
                        form.querySelector('#id_user_id').value = data.id;
                        form.querySelector('#id_full_name').value = data.full_name;
                        form.querySelector('#id_username').value = data.username;
                        form.querySelector('#id_email').value = data.email;
                        form.querySelector('#id_phone_number').value = data.phone_number || '';
                        form.querySelector('#id_role').value = data.role;
                        form.querySelector('#id_is_active').value = data.is_active ? 'True' : 'False';
                        if (data.school_class_id) form.querySelector('#id_school_class').value = data.school_class_id;
                        const subjectSelect = form.querySelector('#id_subjects');
                        Array.from(subjectSelect.options).forEach(opt => opt.selected = data.subject_ids.includes(parseInt(opt.value)));
                        modalTitle.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è';
                        submitBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
                        toggleConditionalFields();
                        openModal();
                    }
                });
            });

            form.addEventListener('submit', async e => {
                e.preventDefault();
                const formData = new FormData(form);
                const subjectSelect = document.getElementById('id_subjects');
                if (subjectSelect.style.display !== 'none') {
                    formData.delete('subjects');
                    Array.from(subjectSelect.selectedOptions).forEach(opt => formData.append('subjects', opt.value));
                }
                const response = await fetch("{% url 'api_manage_user' %}", { method: 'POST', body: formData, headers: {'X-CSRFToken': csrfToken}});
                if (response.ok) location.reload();
                else alert('–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏');
            });

            page.querySelectorAll('.block-user-btn').forEach(button => {
                button.addEventListener('click', async e => {
                    e.preventDefault();
                    const userId = button.dataset.userId;
                    const response = await fetch(`/api/user/${userId}/toggle-status/`, { method: 'POST', headers: {'X-CSRFToken': csrfToken }});
                    if (response.ok) {
                        const result = await response.json();
                        const row = document.querySelector(`tr[data-user-row-id="${userId}"]`);
                        const statusBadge = row.querySelector('.status-badge');
                        const lockIcon = button.querySelector('i');
                        if (result.is_active) {
                            statusBadge.textContent = '–ê–∫—Ç–∏–≤–µ–Ω';
                            statusBadge.className = 'status-badge status-active';
                            lockIcon.className = 'fa-solid fa-lock';
                            button.title = '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å';
                        } else {
                            statusBadge.textContent = '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω';
                            statusBadge.className = 'status-badge status-blocked';
                            lockIcon.className = 'fa-solid fa-lock-open';
                            button.title = '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å';
                        }
                    }
                });
            });

            page.querySelectorAll('.delete-user-btn').forEach(button => {
                button.addEventListener('click', async e => {
                    e.preventDefault();
                    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) {
                        const userId = button.dataset.userId;
                        const response = await fetch(`/api/user/${userId}/delete/`, { method: 'POST', headers: {'X-CSRFToken': csrfToken }});
                        if (response.ok) button.closest('tr').remove();
                        else alert('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.');
                    }
                });
            });
        };
        
        // --- –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –°–¢–†–£–ö–¢–£–†–´ –®–ö–û–õ–´ ---
        const initSchoolStructureScripts = () => {
            const page = document.getElementById('page-structure');
            if (!page) return;
        
            // --- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–∞–º–∏ ---
            const classModalOverlay = document.getElementById('class-modal-overlay');
            const classForm = document.getElementById('class-form');
            const classModalTitle = document.getElementById('class-modal-title');
            const classSubmitBtn = document.getElementById('submit-class-btn');
            const studentCount = document.getElementById('student-count-display');
            const createClassBtn = document.getElementById('create-class-btn');
        
            // --- –ù–û–í–´–ï –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏ ---
            const subjectModalOverlay = document.getElementById('subject-modal-overlay');
            const subjectForm = document.getElementById('subject-form');
            const subjectModalTitle = document.getElementById('subject-modal-title');
            const subjectSubmitBtn = document.getElementById('submit-subject-btn');
            const createSubjectBtn = document.getElementById('create-subject-btn');
        
            // --- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –≤–∫–ª–∞–¥–∫–∞–º ---
            const tabsNav = document.getElementById('structure-tabs-nav');
            const actionButtons = document.getElementById('structure-action-buttons');
            const tabPanes = page.querySelectorAll('.content-tab-pane');
        
            // --- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω ---
            const openClassModal = () => classModalOverlay.style.display = 'flex';
            const closeClassModal = () => classModalOverlay.style.display = 'none';
            const openSubjectModal = () => subjectModalOverlay.style.display = 'flex';
            const closeSubjectModal = () => subjectModalOverlay.style.display = 'none';
        
            // --- –õ–û–ì–ò–ö–ê –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –í–ö–õ–ê–î–û–ö ---
            tabsNav.querySelectorAll('a').forEach(tabLink => {
                tabLink.addEventListener('click', e => {
                    e.preventDefault();
                    const targetTab = tabLink.dataset.tab;
        
                    tabsNav.querySelectorAll('a').forEach(link => link.classList.remove('active'));
                    tabLink.classList.add('active');
        
                    tabPanes.forEach(pane => pane.classList.toggle('active', pane.id === `tab-${targetTab}`));
        
                    // --- –ò–ó–ú–ï–ù–ï–ù–ò–ï ---
                    // –ö–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å" —Ç–µ–ø–µ—Ä—å –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–∞ –∏ –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç—Å—è.
                    // –£–ø—Ä–∞–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å—é —Ç–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫–∏ "–°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç".
                    const createClassBtn = document.getElementById('create-class-btn');
                    const createSubjectBtn = document.getElementById('create-subject-btn');
                    createSubjectBtn.style.display = (targetTab === 'subjects') ? 'inline-flex' : 'none';

                    if (createSubjectBtn.style.display === 'inline-flex') {
                        createClassBtn.style.display = 'none';
                    } else {
                        createClassBtn.style.display = 'inline-flex';
                    }
                });
            });
        
            // --- –õ–û–ì–ò–ö–ê –î–õ–Ø –ö–õ–ê–°–°–û–í ---
            createClassBtn.addEventListener('click', () => {
                classForm.reset();
                classForm.querySelector('#id_class_id').value = '';
                classModalTitle.textContent = '–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å';
                classSubmitBtn.textContent = '–°–æ–∑–¥–∞—Ç—å';
                studentCount.textContent = '0';
                openClassModal();
            });
        
            document.getElementById('close-class-modal-btn').addEventListener('click', closeClassModal);
            document.getElementById('cancel-class-btn').addEventListener('click', closeClassModal);
        
            page.querySelectorAll('.edit-class-btn').forEach(button => {
                button.addEventListener('click', async e => {
                    e.preventDefault();
                    const classId = button.dataset.classId;
                    const response = await fetch(`/api/class/${classId}/details/`);
                    if (response.ok) {
                        const data = await response.json();
                        classForm.querySelector('#id_class_id').value = data.id;
                        classForm.querySelector('#id_class_name').value = data.name;
                        classForm.querySelector('#id_school_for_class').value = data.school_id;
                        classForm.querySelector('#id_class_teacher').value = data.class_teacher_id || '';
                        studentCount.textContent = data.student_count;
                        classModalTitle.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å';
                        classSubmitBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
                        openClassModal();
                    } else {
                        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å–∞.");
                    }
                });
            });
        
            classForm.addEventListener('submit', async e => {
                e.preventDefault();
                const response = await fetch("{% url 'manage_class_api' %}", {
                    method: 'POST', body: new FormData(classForm), headers: {'X-CSRFToken': csrfToken}
                });
                if (response.ok) location.reload();
                else alert('–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º—ã –∫–ª–∞—Å—Å–∞.');
            });
        
            page.querySelectorAll('.delete-class-btn').forEach(button => {
                button.addEventListener('click', async e => {
                    e.preventDefault();
                    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–ª–∞—Å—Å?')) {
                        const classId = button.dataset.classId;
                        const response = await fetch(`/api/class/${classId}/delete/`, { method: 'POST', headers: {'X-CSRFToken': csrfToken}});
                        if (response.ok) {
                             button.closest('tr').remove();
                             // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞, –Ω–æ –ø—Ä–æ—â–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
                             location.reload(); 
                        } else {
                             alert('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∫–ª–∞—Å—Å.');
                        }
                    }
                });
            });
        
            // === –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê –î–õ–Ø –ü–†–ï–î–ú–ï–¢–û–í ===
            createSubjectBtn.addEventListener('click', () => {
                subjectForm.reset();
                subjectForm.querySelector('#id_subject_id').value = '';
                subjectModalTitle.textContent = '–°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç';
                subjectSubmitBtn.textContent = '–°–æ–∑–¥–∞—Ç—å';
                openSubjectModal();
            });
        
            document.getElementById('close-subject-modal-btn').addEventListener('click', closeSubjectModal);
            document.getElementById('cancel-subject-btn').addEventListener('click', closeSubjectModal);
        
            subjectForm.addEventListener('submit', async e => {
                e.preventDefault();
                const response = await fetch("{% url 'api_manage_subject' %}", {
                    method: 'POST', body: new FormData(subjectForm), headers: {'X-CSRFToken': csrfToken}
                });
                if (response.ok) {
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ.');
                }
            });
        
            page.querySelectorAll('.edit-subject-btn').forEach(button => {
                button.addEventListener('click', async e => {
                    e.preventDefault();
                    const subjectId = button.dataset.subjectId;
                    const response = await fetch(`/api/subject/${subjectId}/details/`);
                    if (response.ok) {
                        const data = await response.json();
                        subjectForm.querySelector('#id_subject_id').value = data.id;
                        subjectForm.querySelector('#id_subject_name').value = data.name;
                        subjectModalTitle.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç';
                        subjectSubmitBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
                        openSubjectModal();
                    } else {
                        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç–∞.');
                    }
                });
            });
        
            page.querySelectorAll('.delete-subject-btn').forEach(button => {
                button.addEventListener('click', async e => {
                    e.preventDefault();
                    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç?')) {
                        const subjectId = button.dataset.subjectId;
                        const response = await fetch(`/api/subject/${subjectId}/delete/`, {
                            method: 'POST', headers: {'X-CSRFToken': csrfToken}
                        });
                        if (response.ok) {
                            button.closest('tr').remove();
                            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞, –Ω–æ –ø—Ä–æ—â–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
                            location.reload();
                        } else {
                            alert('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç. –í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏ –∏–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è—Ö.');
                        }
                    }
                });
            });
        };

        // --- –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ù–ê–ó–ù–ê–ß–ï–ù–ò–Ø–ú–ò (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
        const initAssignmentsScripts = () => {
            const page = document.getElementById('page-assignments');
            if (!page) return;

            const modalOverlay = document.getElementById('assignment-modal-overlay');
            const form = document.getElementById('assignment-form');
            const createBtn = document.getElementById('create-assignment-btn');
            const closeModalBtn = document.getElementById('close-assignment-modal-btn');
            const cancelBtn = document.getElementById('cancel-assignment-btn');
            const deleteButtons = page.querySelectorAll('.delete-assignment-btn');

            const openModal = () => { modalOverlay.style.display = 'flex'; };
            const closeModal = () => { modalOverlay.style.display = 'none'; };

            createBtn.addEventListener('click', () => {
                form.reset();
                openModal();
            });
            closeModalBtn.addEventListener('click', closeModal);
            cancelBtn.addEventListener('click', closeModal);

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(form);
                const response = await fetch("{% url 'manage_assignment_api' %}", {
                    method: 'POST',
                    body: formData,
                    headers: {'X-CSRFToken': csrfToken}
                });
                if (response.ok) {
                    location.reload();
                } else {
                    const result = await response.json();
                    alert(`–û—à–∏–±–∫–∞: ${result.message || JSON.stringify(result)}`);
                }
            });

            deleteButtons.forEach(button => {
                button.addEventListener('click', async (e) => {
                    e.preventDefault();
                    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ?')) {
                        const assignmentId = button.dataset.assignmentId;
                        const response = await fetch(`/api/assignment/${assignmentId}/delete/`, {
                            method: 'POST',
                            headers: {'X-CSRFToken': csrfToken}
                        });
                        if (response.ok) {
                            button.closest('tr').remove();
                        } else {
                            alert('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ.');
                        }
                    }
                });
            });
        };

        // === –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –í–´–•–û–î–ù–´–ú–ò ===
        const initHolidayManagementScripts = () => {
            const page = document.getElementById('page-settings');
            if (!page) return;

            const modalOverlay = document.getElementById('holiday-modal-overlay');
            const form = document.getElementById('holiday-form');
            const modalTitle = document.getElementById('holiday-modal-title');
            const submitBtn = document.getElementById('submit-holiday-btn');

            const openModal = () => modalOverlay.style.display = 'flex';
            const closeModal = () => modalOverlay.style.display = 'none';

            document.getElementById('create-holiday-btn').addEventListener('click', () => {
                form.reset();
                form.querySelector('#id_holiday_id').value = '';
                modalTitle.textContent = '–î–æ–±–∞–≤–∏—Ç—å –≤—ã—Ö–æ–¥–Ω–æ–π –¥–µ–Ω—å';
                submitBtn.textContent = '–°–æ–∑–¥–∞—Ç—å';
                openModal();
            });

            document.getElementById('close-holiday-modal-btn').addEventListener('click', closeModal);
            document.getElementById('cancel-holiday-btn').addEventListener('click', closeModal);

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const response = await fetch("{% url 'api_manage_holiday' %}", {
                    method: 'POST', body: new FormData(form), headers: {'X-CSRFToken': csrfToken}
                });
                if (response.ok) {
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã.');
                }
            });

            page.querySelectorAll('.edit-holiday-btn').forEach(button => {
                button.addEventListener('click', async (e) => {
                    e.preventDefault();
                    const holidayId = button.dataset.holidayId;
                    const response = await fetch(`/api/holiday/${holidayId}/details/`);
                    if (response.ok) {
                        const data = await response.json();
                        form.querySelector('#id_holiday_id').value = data.id;
                        form.querySelector('#id_holiday_date').value = data.date;
                        form.querySelector('#id_holiday_name').value = data.name;
                        modalTitle.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—ã—Ö–æ–¥–Ω–æ–π –¥–µ–Ω—å';
                        submitBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
                        openModal();
                    }
                });
            });

            page.querySelectorAll('.delete-holiday-btn').forEach(button => {
                button.addEventListener('click', async (e) => {
                    e.preventDefault();
                    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –¥–µ–Ω—å?')) {
                        const holidayId = button.dataset.holidayId;
                        const response = await fetch(`/api/holiday/${holidayId}/delete/`, {
                            method: 'POST', headers: {'X-CSRFToken': csrfToken}
                        });
                        if (response.ok) {
                            button.closest('tr').remove();
                        } else {
                            alert('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å.');
                        }
                    }
                });
            });
        };

        // --- –û–ë–©–ê–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø –ò –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        const navigateTo = (pageId) => {
            contentPages.forEach(page => page.classList.remove('active'));
            const targetPage = document.getElementById(`page-${pageId}`);
            if (targetPage) targetPage.classList.add('active');
            navLinks.forEach(link => link.classList.toggle('active', link.dataset.target === pageId));
        };

        navLinks.forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                const pageId = e.currentTarget.dataset.target;
                navigateTo(pageId);
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É –≤ URL –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                window.history.pushState({page: pageId}, '', `?page=${pageId}`);
            });
        });

        // --- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ ---
        const urlParams = new URLSearchParams(window.location.search);
        const pageFromUrl = urlParams.get('page') || 'users'; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'users'
        navigateTo(pageFromUrl);
        
        // --- –í–´–ó–´–í–ê–ï–ú –í–°–ï –§–£–ù–ö–¶–ò–ò –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò ---
        initUserManagementScripts();
        initSchoolStructureScripts();
        initAssignmentsScripts();
        initHolidayManagementScripts(); // <-- –í–´–ó–û–í –ù–û–í–û–ô –§–£–ù–ö–¶–ò–ò
    });
    </script>
    <script>
    /* –í—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ —Ç–µ–≥ <script> –≤ –∫–æ–Ω—Ü–µ –≤–∞—à–µ–≥–æ HTML */
    /* –ó–ê–ú–ï–ù–ò–¢–ï –í–ê–® –°–£–©–ï–°–¢–í–£–Æ–©–ò–ô –°–ö–†–ò–ü–¢ –ù–ê –≠–¢–û–¢ */
    document.addEventListener('DOMContentLoaded', function() {
        // --- 2. –õ–û–ì–ò–ö–ê –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–û–ì–û –ú–ï–ù–Æ ---
        const menuButton = document.getElementById('mobile-menu-btn');
        const closeButton = document.getElementById('mobile-menu-close-btn');
        const navMenu = document.querySelector('.main-nav');
        const mobileNavTitle = document.getElementById('mobile-nav-title');
        const navLinks = navMenu.querySelectorAll('a');

        if (menuButton) {
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é
            const closeMenu = () => {
                navMenu.classList.remove('is-open');
                document.body.classList.remove('menu-open');
            };

            // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø–æ –∫–ª–∏–∫—É –Ω–∞ –±—É—Ä–≥–µ—Ä
            menuButton.addEventListener('click', function() {
                navMenu.classList.add('is-open');
                document.body.classList.add('menu-open');
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø–æ –∫–ª–∏–∫—É –Ω–∞ –∫—Ä–µ—Å—Ç–∏–∫
            closeButton.addEventListener('click', closeMenu);

            // –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å—Å—ã–ª–∫—É –≤ –º–æ–±–∏–ª—å–Ω–æ–º –º–µ–Ω—é, –º—ã –æ–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º –µ–≥–æ
            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    mobileNavTitle.textContent = this.textContent.trim();
                    // –°–∞–º–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç—Å—è –≤ –±–ª–æ–∫–µ ‚Ññ1
                    closeMenu();
                });
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ (–Ω–∞ –æ–≤–µ—Ä–ª–µ–π)
            document.addEventListener('click', function(event) {
                if (navMenu.classList.contains('is-open') && !navMenu.contains(event.target) && !menuButton.contains(event.target)) {
                    closeMenu();
                }
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∞–≤–∏—à–µ Escape
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape' && navMenu.classList.contains('is-open')) {
                    closeMenu();
                }
            });
        }
    });
    </script>
</body>
</html>