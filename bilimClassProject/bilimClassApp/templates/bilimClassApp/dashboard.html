<!-- bilimClassApp/templates/bilimClassApp/dashboard.html (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø) -->
{% load static %}
<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sabaq Saqshy</title>
    <!-- –¢“Æ–ó–ï–¢–Ü–õ–î–Ü: “ö–∞“õ—Ç—ã“ì—ã—Å —Ç—É–¥—ã—Ä–∞—Ç—ã–Ω –∞—Ä—Ç—ã“õ style.css –∞–ª—ã–Ω—ã–ø —Ç–∞—Å—Ç–∞–ª–¥—ã -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="stylesheet" href="{% static 'bilimClassApp/css/base.css' %}">
    <link rel="stylesheet" href="{% static 'bilimClassApp/css/student_dashboard.css' %}">
    <style>
        .td-user-section { display: flex; align-items: center; gap: 16px; }
        .td-user-info { text-align: right; } .td-user-info h3 { font-weight: 600; }
        .td-user-info p { font-size: 14px; color: var(--text-secondary); }
        .td-user-link { text-decoration: none; color: inherit; }
        .td-user-avatar { width: 40px; height: 40px; border-radius: 10px; background-color: #D8B4FE; color: #581C87; display: grid; place-items: center; font-weight: 600; }
    </style>

    <style>

.td-mobile-nav, .mobile-menu-header {
    display: none;
}
    /* --- –ü–ª–∞–Ω—à–µ—Ç—Ç–µ—Ä–≥–µ –∞—Ä–Ω–∞–ª“ì–∞–Ω —Å—Ç–∏–ª—å–¥–µ—Ä (992px –¥–µ–π—ñ–Ω) --- */
@media (max-width: 992px) {
    .container, .dashboard-container {
        padding: 16px; /* –£–º–µ–Ω—å—à–∞–µ–º –±–æ–∫–æ–≤—ã–µ –æ—Ç—Å—Ç—É–ø—ã */
        margin: 10px;
    }

    .stats-cards-grid-v2 {
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); /* –£–º–µ–Ω—å—à–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É –∫–∞—Ä—Ç–æ—á–µ–∫ */
    }
}


    /* --- –ù–µ–≥—ñ–∑–≥—ñ –º–æ–±–∏–ª—å–¥—ñ —Å—Ç–∏–ª—å–¥–µ—Ä (768px –¥–µ–π—ñ–Ω) --- */
@media (max-width: 768px) {

    .schedule-section {
        padding: 10px 10px 10px 10px ;
    }

    body {
        font-size: 14px;
    }

    /* --- –®–∞–ø–∫–∞ --- */
    .site-header {
        flex-wrap: wrap;
        gap: 16px;
        padding: 15px 20px;
    }
    .logo-section h1 {
        font-size: 18px;
    }
    .logo-section span, .user-info p {
        display: none;
    }
    .user-section {
        margin-left: auto;
    }

    .td-user-info {
        display: none;
    }

    

    .day-tabs ul{
        justify-content: center !important;
    }

    /* --- –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∏ —Ç–∞–±—ã --- */ 
    .welcome-section {
        margin: 0px 20px 24px 20px;
    } 

    .welcome-section h1 {
        font-size: 20px;
    }


    .schedule-section h3, p {
        background-color: #ffffff;
        padding: 20px 20px;
        padding-left: 0px;
    }

    .schedule-section h3 {
        padding-bottom: 5px;
        border-radius: 12px 12px 0px 0px;
    }    

    .schedule-section p {
        padding-top: 5px;
        border-radius: 0px 0px 12px 12px;
    }

    .stats-cards-grid-v2 span {
        margin-left: 20px;
    }

    .stats-cards-grid-v2 p {
        padding: 10px;
        padding-left: 20px;
    }


    .main-tabs ul, .day-tabs ul {
        overflow-x: auto;
        padding-bottom: 8px;
        white-space: nowrap;
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    .main-tabs ul::-webkit-scrollbar, .day-tabs ul::-webkit-scrollbar {
        display: none;
    }
    
    /* --- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ –î–Ω–µ–≤–Ω–∏–∫–µ --- */
    .stats-cards-grid-v2 {
        grid-template-columns: 1fr 1fr;
    }
    .stat-info-v2 span {
        font-size: 24px;
    }

    /* --- –¢–∞–±–ª–∏—Ü–∞ —Å –æ—Ü–µ–Ω–∫–∞–º–∏ (–ø—Ä–µ–≤—Ä–∞—â–∞–µ–º –≤ –∫–∞—Ä—Ç–æ—á–∫–∏) --- */
    .grades-table-v2 thead {
        display: none; /* –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã */
    }
    .grades-table-v2 tr {
        /* –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–∞ */
        display: block; 
        background-color: var(--bg-widget);
        border: 1px solid var(--border-color);
        border-radius: 16px;
        padding: 20px;
        margin-bottom: 16px;
    }
    .grades-table-v2 td {
        /* –ö–∞–∂–¥–∞—è —è—á–µ–π–∫–∞ - —ç—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ */
        display: block; 
        padding: 16px 0;
        border-bottom: 1px solid var(--border-color);
    }
    .grades-table-v2 tr td:last-child {
        border-bottom: none;
        padding-bottom: 0;
    }
    .grades-table-v2 tr td:first-child {
        padding-top: 0;
    }
    .grades-table-v2 td::before {
        /* –°–æ–∑–¥–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –º–µ—Ç–∫–∏ (–ü—Ä–µ–¥–º–µ—Ç, –û—Ü–µ–Ω–∫–∏ –∏ —Ç.–¥.) */
        content: attr(data-label);
        display: block;
        font-size: 14px;
        color: var(--text-secondary);
        margin-bottom: 6px;
    }
    .grades-table-v2 td:nth-of-type(1)::before { content: "–ü”ô–Ω"; }
    .grades-table-v2 td:nth-of-type(2)::before { content: "–ë–∞“ì–∞–ª–∞—Ä"; }
    .grades-table-v2 td:nth-of-type(3)::before { content: "–û—Ä—Ç–∞—à–∞ –±–∞“ì–∞"; }

    .grades-table-v2 .average-grade {
        font-size: 20px;
        font-weight: 700;
    }

    /* 
      –ö–õ–Æ–ß–ï–í–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï:
      –ü—Ä–∏–º–µ–Ω—è–µ–º flex-—Å—Ç–∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –∫ .grades-list,
      —á—Ç–æ–±—ã –æ—Ü–µ–Ω–∫–∏ –≤–Ω—É—Ç—Ä–∏ –≤—ã—Å—Ç—Ä–∞–∏–≤–∞–ª–∏—Å—å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ.
    */
    .grades-table-v2 .grades-list {
        display: flex;
        flex-direction: row;    /* –Ø–í–ù–û —É–∫–∞–∑—ã–≤–∞–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */
        flex-wrap: nowrap;      /* –ó–∞–ø—Ä–µ—â–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å */
        align-items: center;
        gap: 8px;
        overflow-x: scroll;       /* –î–æ–±–∞–≤–ª—è–µ–º —Å–∫—Ä–æ–ª–ª, –µ—Å–ª–∏ –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è */
        padding-bottom: 5px;
        
        /* –°–∫—Ä—ã–≤–∞–µ–º —Å–∞–º —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    .grades-table-v2 .grades-list::-webkit-scrollbar {
        display: none;
    }

    .day-tabs li {
        padding: 8px 12px;
        font-size: 12px;
    }

    .lesson-details {
        flex-direction: column;
    }


    /* --- –î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è --- */

    #tab-content-homework .stat-value {
        padding-left: 20px;
    }

    #tab-content-homework .stat-label {
        padding: 10px;
        padding-left: 20px;
    }

    .stats-grid {
        grid-template-columns: 1fr;
    }
    .homework-tabs {
        justify-content: center;
    }
    .hw-footer {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
    }
    .hw-footer .btn-submit {
        width: 100%;
    }

    /* --- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ --- */
    .lesson-card {
        position: relative;
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
    }
    .lesson-start-time {
        position: absolute;
        top:15px;
        align-self: flex-end;
        background-color: var(--accent-light);
        color: var(--accent-primary);
        padding: 4px 10px;
        border-radius: 8px;
    }

    /* --- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ --- */
    .modal-container, .grade-modal-container {
        width: 95%;
        padding: 24px;
        max-height: 90vh;
        overflow-y: auto;
    }
    .modal-footer {
        flex-direction: column-reverse;
    }
    .modal-footer button {
        width: 100%;
    }

    /* =================================================================
    –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –°–¢–ò–õ–ò –¢–û–õ–¨–ö–û –î–õ–Ø –¢–ê–ë–û–í –î–û–ú–ê–®–ù–ò–• –ó–ê–î–ê–ù–ò–ô
    (–ó–∞–º–µ–Ω—è—é—Ç —Å—Ç–∞—Ä—ã–π –±–ª–æ–∫ .homework-tabs –≤ student_dashboard.css)
    ================================================================= */

    .homework-tabs {
        display: flex;
        flex-direction: column; /* –í—ã—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –∫–æ–ª–æ–Ω–∫—É */
        gap: 10px; /* –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ */
        margin-bottom: 24px;
    }

    .homework-tabs .tab-btn {
        display: block;
        padding: 12px 16px;
        background-color: #F3F4F6; /* –§–æ–Ω –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ */
        border: none;
        border-radius: 12px; /* –°–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ —É–≥–ª—ã */
        font-weight: 600;
        cursor: pointer;
        color: var(--text-secondary);
        transition: background-color 0.2s, color 0.2s, box-shadow 0.2s;
        font-size: 14px;
        text-align: center;
    }

    .homework-tabs .tab-btn:hover {
        background-color: #E5E7EB; /* –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    }

    .homework-tabs .tab-btn.active {
        background-color: var(--accent-primary); /* –ê–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç */
        color: #fff; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
        box-shadow: 0 4px 14px 0 rgba(79, 70, 229, 0.3); /* –¢–∞ —Å–∞–º–∞—è —Ç–µ–Ω—å */
    }

    #tab-content-not_submitted .homework-card {
        margin-top: 10px;
    }


    .grades-list {
        
        overflow-x:scroll !important;
    }

    .main-tabs {
        display: none;
    }

    /* –ú–æ–±–∏–ª—å–¥—ñ –ø–∞–Ω–µ–ª—å–¥—ñ –∫”©—Ä—Å–µ—Ç–µ–º—ñ–∑ */
    .td-mobile-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        background-color: var(--bg-widget);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        margin-bottom: 20px;
    }
    #mobile-nav-title { font-size: 18px; font-weight: 600; }
    #mobile-menu-btn {
        background: transparent;
        border: none;
        font-size: 20px;
        cursor: pointer;
        padding: 8px;
        width: 40px;
        height: 40px;
        border-radius: 8px;
    }

    /* –ë“Ø–π—ñ—Ä–¥–µ–Ω —à—ã“ì–∞—Ç—ã–Ω –º–µ–Ω—é–¥—ñ“£ –Ω–µ–≥—ñ–∑–≥—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ */
    .main-nav {
        position: fixed;
        top: 0; right: 0;
        width: 300px;
        max-width: 90%;
        height: 100%;
        background-color: var(--bg-widget);
        box-shadow: -4px 0 25px rgba(0, 0, 0, 0.1);
        transform: translateX(100%);
        transition: transform 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        z-index: 2000;
        padding: 0;
        margin: 0;
        border-radius: 0;
        display: flex;
        flex-direction: column;
    }
    .main-nav.is-open { transform: translateX(0); }

    .mobile-menu-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 24px;
        border-bottom: 1px solid var(--border-color);
    }
    #mobile-menu-close-btn {
        background: transparent;
        border: none;
        font-size: 22px;
        cursor: pointer;
        padding: 8px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        color: var(--text-secondary);
    }
    .main-nav ul {
        flex-direction: column;
        gap: 8px;
        padding: 16px;
    }
    .main-nav a { 
        display: block;
        padding: 14px 20px; 
        font-size: 16px; 
        font-weight: 500; 
        border-radius: 10px;
    }
    .main-nav a.active { background-color: var(--accent-primary); color: #fff; }

    /* –ú–µ–Ω—é –∞—à—ã–ª“ì–∞–Ω–¥–∞ –∞—Ä—Ç“õ—ã —Ñ–æ–Ω–¥—ã “õ–∞—Ä–∞–π—Ç—É */
    body.menu-open::after {
        content: '';
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background-color: rgba(17, 24, 39, 0.6);
        z-index: 1999;
    }

    .grades-table-v2 tbody {
        display: flex;
        flex-direction: column;
    }

}


/* --- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ (–¥–æ 480px) --- */
@media (max-width: 480px) {
    .stats-cards-grid-v2 {
        grid-template-columns: 1fr; /* –¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ –≤ —Ä—è–¥ */
    }
    .grades-table-v2 td {
        flex-direction: column; /* –ú–µ—Ç–∫–∞ –∏ –∑–Ω–∞—á–µ–Ω–∏–µ –¥—Ä—É–≥ –ø–æ–¥ –¥—Ä—É–≥–æ–º */
        align-items: flex-start;
        gap: 4px;
    }
    .grades-table-v2 td::before {
        margin-bottom: 4px;
    }
    .grades-table-v2 .grades-list,
    .grades-table-v2 .subject-name,
    .grades-table-v2 .teacher-name {
        max-width: 100%;
        text-align: left;
    }
    .dnevnik-filters {
        display: grid;
        grid-template-columns: 1fr;
    }
    .dnevnik-filters a {
        text-align: center;
    }

    .welcome-section h1 {
        font-size: 18px;
    }

    
}
    </style>
</head>
<body>

    <div class="dashboard-container">
        <!-- –ò–°–ü–†–ê–í–õ–ï–ù–û: –ö–ª–∞—Å—Å—ã –≤ —à–∞–ø–∫–µ —Ç–µ–ø–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç base.css -->
        <header class="site-header">
            <div class="logo-section">
                <div class="logo-icon">üéì</div>
                <div>
                    <h1>Sabaq Saqshy</h1>
                    <!-- <span>{{ user_role }}</span> -->
                </div>
            </div>
           <div class="td-user-section">
                <div class="td-user-info">
                    <a href="{% url 'profile' %}" class="td-user-link">
                        <h3>{{ user.get_full_name }}</h3>
                    </a>
                    <p>–û“õ—É—à—ã</p>
                </div>
                <a href="{% url 'profile' %}" class="td-user-link">
                    <div class="td-user-avatar">{{ user.first_name|first }}{{ user.last_name|first }}</div>
                </a>
            </div>
        </header>

        <div class="td-mobile-nav">
            <h2 id="mobile-nav-title">–ö–µ—Å—Ç–µ</h2>
            <button id="mobile-menu-btn" aria-label="–ú”ô–∑—ñ—Ä–¥—ñ –∞—à—É">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="dashboard-main">
            <!-- <div class="welcome-section">
                <h1>“ö–æ—à –∫–µ–ª–¥—ñ“£—ñ–∑, {{ request.user.first_name }}!</h1>
            </div> -->

            <!-- –¢–∞–±—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
            <nav class="main-nav">
                <div class="mobile-menu-header">
                    <h3>–ú”ô–∑—ñ—Ä</h3>
                    <button id="mobile-menu-close-btn" aria-label="–ú”ô–∑—ñ—Ä–¥—ñ –∂–∞–±—É">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <ul>
                    <!-- –ú–∞“£—ã–∑–¥—ã: data-tab –∞—Ç—Ä–∏–±—É—Ç—Ç–∞—Ä—ã –µ–Ω–¥—ñ <a> —Ç–µ–≥—ñ–Ω–¥–µ -->
                    <li><a href="#" data-tab="schedule" class="active"><i class="far fa-calendar-alt"></i> –ö–µ—Å—Ç–µ</a></li>
                    <li><a href="#" data-tab="dnevnik"><i class="fas fa-book"></i> –ñ—É—Ä–Ω–∞–ª</a></li>
                    <li><a href="#" data-tab="homework"><i class="fas fa-pencil-alt"></i> “Æ–π —Ç–∞–ø—Å—ã—Ä–º–∞–ª–∞—Ä—ã</a></li>
                </ul>
            </nav>

            <!-- –í–ö–õ–ê–î–ö–ê: –†–ê–°–ü–ò–°–ê–ù–ò–ï -->
            <div id="tab-content-schedule" class="tab-pane {% if active_tab == 'schedule' or not active_tab %}active{% endif %}">
                 <section class="schedule-section">
                    <h3>–°–∞–±–∞“õ –∫–µ—Å—Ç–µ—Å—ñ</h3>
                    <p>–°—ñ–∑–¥—ñ“£ –∞–ø—Ç–∞–ª—ã“õ –∫–µ—Å—Ç–µ“£—ñ–∑</p>
                    <nav class="day-tabs">
                        <ul><li data-day="1" class="active">–î“Æ–ô</li><li data-day="2">–°–ï–ô</li><li data-day="3">–°”ò–†</li><li data-day="4">–ë–ï–ô</li><li data-day="5">–ñ“∞–ú</li></ul>
                    </nav>
                    <div class="schedule-content">
                        {% for day, lessons in schedule_by_day.items %}
                            <div id="day-{{ day }}" class="day-schedule {% if forloop.first %}active{% endif %}">
                                {% for lesson in lessons %}
                                    <div class="lesson-card">
                                        <div class="lesson-info">
                                            <div class="lesson-number">{{ forloop.counter }}</div>
                                            <div>
                                                <p class="lesson-title">{{ lesson.subject.name }}</p>
                                                <div class="lesson-details">
                                                    <span><i class="far fa-clock"></i> {{ lesson.start_time|time:"H:i" }} - {{ lesson.end_time|time:"H:i" }}</span>
                                                    <span><i class="fas fa-map-marker-alt"></i> –ö–∞–±–∏–Ω–µ—Ç {{ lesson.classroom }}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="lesson-start-time">{{ lesson.start_time|time:"H:i" }}</div>
                                    </div>
                                {% empty %}
                                    <p class="no-lessons">–û—Å—ã –∫“Ø–Ω—ñ —Å–∞–±–∞“õ—Ç–∞—Ä –∂–æ“õ.</p>
                                {% endfor %}
                            </div>
                        {% endfor %}
                    </div>
                </section>
            </div>

            <!-- –í–ö–õ–ê–î–ö–ê: –î–ù–ï–í–ù–ò–ö -->
            <div id="tab-content-dnevnik" class="tab-pane {% if active_tab == 'dnevnik' %}active{% endif %}">
                <div class="stats-cards-grid-v2">
                    <div class="stat-card-v2">
                        <div class="stat-icon-v2 icon-green"><i class="fas fa-chart-line"></i></div>
                        <div class="stat-info-v2"><p>–û—Ä—Ç–∞—à–∞ –±–∞“ì–∞</p><span>{{ average_grade|floatformat:2|default:0 }}</span></div> 
                        <!-- <small>–∂–∞–ª–ø—ã</small> -->
                    </div>
                    <div class="stat-card-v2">
                        <div class="stat-icon-v2 icon-blue"><i class="fas fa-book-open"></i></div>
                        <div class="stat-info-v2"><p>–ë–∞—Ä–ª—ã“ì—ã –±–∞“ì–∞–ª–∞—Ä</p><span>{{ total_grades_count|default:0 }}</span></div>
                        <!-- <small>–∫–µ–∑–µ“£ –±–æ–π—ã–Ω—à–∞</small> -->
                    </div>
                    <div class="stat-card-v2">
                        <div class="stat-icon-v2 icon-red"><i class="fas fa-user-clock"></i></div>
                        <div class="stat-info-v2"><p>“ö–∞—Ç—ã—Å—É</p><span>{{ attendance_percentage|floatformat:1 }}%</span></div>
                        <!-- <small>{{ total_absences }} “õ–∞—Ç—ã—Å–ø–∞—É–ª–∞—Ä</small> -->
                    </div>
                </div>

                <!-- <div class="grades-by-subject-widget-v2">
                    <div class="widget-header"><h2>–û—Ü–µ–Ω–∫–∏ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º</h2><p>–í–∞—à–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å –∑–∞ —Ç–µ–∫—É—â–∏–π –ø–µ—Ä–∏–æ–¥</p></div> -->
                <div class="grades-by-subject-widget-v2">
                    <div class="widget-header">
                        <h2>–ü”ô–Ω–¥–µ—Ä –±–æ–π—ã–Ω—à–∞ –±–∞“ì–∞–ª–∞—Ä</h2>
                        <p>–ê“ì—ã–º–¥–∞“ì—ã –∫–µ–∑–µ“£–¥–µ–≥—ñ –æ“õ—É –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä—ñ</p>
                    </div>

                    <!-- ===== –ù–ê–ß–ê–õ–û –ù–û–í–û–ì–û –ë–õ–û–ö–ê –° –§–ò–õ–¨–¢–†–ê–ú–ò ===== -->
                    <div class="dnevnik-filters">
                        <a href="?tab=dnevnik&period=week" class="{% if active_period == 'week' %}active{% endif %}">–ê–ø—Ç–∞ –±–æ–π—ã–Ω—à–∞</a>
                        <a href="?tab=dnevnik&period=month" class="{% if active_period == 'month' %}active{% endif %}">–ê–π –±–æ–π—ã–Ω—à–∞</a>
                        <a href="?tab=dnevnik&period=all" class="{% if active_period == 'all' %}active{% endif %}">–ë–∞—Ä–ª—ã“õ —É–∞“õ—ã—Ç –±–æ–π—ã–Ω—à–∞</a>
                    </div>
                    <!-- –∂–∂ -->
                    <table class="grades-table-v2">
                        <thead><tr><th>–ü”ô–Ω</th><th>–ë–∞“ì–∞–ª–∞—Ä</th><th style="text-align: right;">–û—Ä—Ç–∞—à–∞ –±–∞“ì–∞</th></tr></thead>
                        <tbody>
                            {% for subject_data in grades_by_subject %}
                            <tr>
                                <td class="subject-teacher">
                                    <p class="subject-name">{{ subject_data.subject_name }}</p>
                                    <span class="teacher-name">{{ subject_data.teacher_name }}</span>
                                </td>
                                <td class="grades-list">
                                    {% for grade in subject_data.grades %}
                                        <!-- –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª–µ–Ω—ã data-comment –∏ data-date, —É–±—Ä–∞–Ω title -->
                                        <div class="grade-badge-wrapper" 
                                             data-comment="{{ grade.comment|default:'' }}" 
                                             data-date="{{ grade.date|date:'d.m.Y' }}">
                                            <div class="grade-badge {% if grade.grade >= 85 %}grade-5{% elif grade.grade >= 65 %}grade-4{% else %}grade-3{% endif %}">{{ grade.grade }}</div>
                                            {% if grade.comment %}<span class="grade-comment-icon">üí¨</span>{% endif %}
                                        </div>
                                    {% empty %}
                                        <span class="no-grades">-</span>
                                    {% endfor %}
                                </td>
                                <td style="text-align: right;">
                                    <span class="average-grade">{{ subject_data.average|floatformat:2|default:"-" }}</span>
                                </td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="3" style="text-align: center; padding: 30px; color: var(--text-secondary);">–û—Å—ã –∫–µ–∑–µ“£–≥–µ –±–∞“ì–∞–ª–∞—Ä ”ô–ª—ñ –∂–æ“õ.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- –í–ö–õ–ê–î–ö–ê: –î–û–ú–ê–®–ù–ò–ï –ó–ê–î–ê–ù–ò–Ø -->
            <div id="tab-content-homework" class="tab-pane {% if active_tab == 'homework' %}active{% endif %}">
                <div class="homework-widget">
                    <div class="widget-header"><h2>“Æ–π —Ç–∞–ø—Å—ã—Ä–º–∞–ª–∞—Ä—ã</h2><p>–ü”ô–Ω–¥–µ—Ä –±–æ–π—ã–Ω—à–∞ –±–∞—Ä–ª—ã“õ —Ç–∞–ø—Å—ã—Ä–º–∞–ª–∞—Ä</p></div>
                    <div class="stats-grid">
                        <!-- 1. –¢–∞–ø—Å—ã—Ä—ã–ª–º–∞“ì–∞–Ω (–ù–µ —Å–¥–∞–Ω–æ) - –ò—Å–ø–æ–ª—å–∑—É–µ–º –ö—Ä–∞—Å–Ω—ã–π/–û—Ä–∞–Ω–∂–µ–≤—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç -->
                        <div class="stat-card stat-card-pending">
                            <div class="stat-icon red"> <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª–∞—Å—Å, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫—Ä–∞—Å–Ω–æ–º—É –≥—Ä–∞–¥–∏–µ–Ω—Ç—É -->
                                <i class="fas fa-exclamation-triangle"></i> <!-- –ò–∫–æ–Ω–∫–∞ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è -->
                            </div>
                            <div>
                                <div class="stat-value">{{ not_submitted_list.count }}</div>
                                <p class="stat-label">–¢–∞–ø—Å—ã—Ä—ã–ª–º–∞“ì–∞–Ω</p>
                            </div>
                        </div>
                        
                        <!-- 2. –¢–µ–∫—Å–µ—Ä—É–¥–µ (–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ) - –ò—Å–ø–æ–ª—å–∑—É–µ–º –ñ–µ–ª—Ç—ã–π/–ó–æ–ª–æ—Ç–æ–π –≥—Ä–∞–¥–∏–µ–Ω—Ç -->
                        <div class="stat-card stat-card-review">
                            <div class="stat-icon orange"> <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª–∞—Å—Å, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∂–µ–ª—Ç–æ–º—É –≥—Ä–∞–¥–∏–µ–Ω—Ç—É -->
                                <i class="fas fa-hourglass-half"></i> <!-- –ò–∫–æ–Ω–∫–∞ –ß–∞—Å–æ–≤/–ü–µ—Å–æ—á–Ω—ã—Ö —á–∞—Å–æ–≤ -->
                            </div>
                            <div>
                                <div class="stat-value">{{ in_review_list.count }}</div>
                                <p class="stat-label">–¢–µ–∫—Å–µ—Ä—É–¥–µ</p>
                            </div>
                        </div>
                        
                        <!-- 3. –¢–µ–∫—Å–µ—Ä—ñ–ª–¥—ñ (–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ) - –ò—Å–ø–æ–ª—å–∑—É–µ–º –ó–µ–ª–µ–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç -->
                        <div class="stat-card stat-card-checked">
                            <div class="stat-icon blue"> <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª–∞—Å—Å, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∑–µ–ª–µ–Ω–æ–º—É –≥—Ä–∞–¥–∏–µ–Ω—Ç—É (–º–æ–∂–Ω–æ –Ω–∞–∑–≤–∞—Ç—å 'green', –Ω–æ 'blue' –±—ã–ª –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞) -->
                                <i class="fas fa-check"></i> <!-- –ò–∫–æ–Ω–∫–∞ –ì–∞–ª–æ—á–∫–∏/–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ -->
                            </div>
                            <div>
                                <div class="stat-value">{{ checked_list.count }}</div>
                                <p class="stat-label">–¢–µ–∫—Å–µ—Ä—ñ–ª–¥—ñ</p>
                            </div>
                        </div>
                    </div>
                    <div class="homework-tabs">
                        <button class="tab-btn active" data-tab="not_submitted">–¢–∞–ø—Å—ã—Ä—ã–ª–º–∞“ì–∞–Ω ({{ not_submitted_list.count }})</button>
                        <button class="tab-btn" data-tab="in_review">–¢–µ–∫—Å–µ—Ä—É–¥–µ ({{ in_review_list.count }})</button>
                        <button class="tab-btn" data-tab="checked">–¢–µ–∫—Å–µ—Ä—ñ–ª–¥—ñ ({{ checked_list.count }})</button>
                    </div>
                    <div class="homework-list" id="homework-list-container">
                        <div id="tab-content-not_submitted" class="tab-pane active">
                            {% for hw in not_submitted_list %}
                            <div class="homework-card">
                                <div class="hw-card-header"><h3>{{ hw.title }}</h3><span class="hw-status-tag tag-pending">–¢–∞–ø—Å—ã—Ä—ã–ª–º–∞“ì–∞–Ω</span></div>
                                <p class="hw-meta">{{ hw.subject.name }} ‚Ä¢ {{ hw.teacher.user.get_full_name }}</p>
                                <p class="hw-description">{{ hw.description }}</p>
                                {% if hw.attached_file %}
                                    <a href="{{ hw.attached_file.url }}" class="hw-attachment" target="_blank">
                                        <i class="fas fa-paperclip"></i>
                                        <span>“ö–æ—Å—ã–ª“ì–∞–Ω —Ñ–∞–π–ª</span>
                                    </a>
                                {% endif %}
                                <div class="hw-footer">
                                    <div class="hw-deadline"><i class="far fa-clock"></i> –¢–∞–ø—Å—ã—Ä—É –º–µ—Ä–∑—ñ–º—ñ: {{ hw.due_date|date:"d.m.Y H:i" }}</div>
                                    <button class="btn-submit open-submission-modal" data-hw-pk="{{ hw.pk }}" data-hw-title="{{ hw.title }}" data-hw-subject="{{ hw.subject.name }}" data-hw-description="{{ hw.description }}">–ñ“±–º—ã—Å—Ç—ã —Ç–∞–ø—Å—ã—Ä—É</button>
                                </div>
                            </div>
                            {% empty %} <p style="text-align:center; padding: 20px; color: var(--text-secondary);">–ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —Å–¥–∞—Ç—å.</p> {% endfor %}
                        </div>
                        <div id="tab-content-in_review" class="tab-pane">
                            {% for submission in in_review_list %}
                            <div class="homework-card">
                                <div class="hw-card-header"><h3>{{ submission.homework.title }}</h3><span class="hw-status-tag tag-review">–¢–µ–∫—Å–µ—Ä—É–¥–µ</span></div>
                                <p class="hw-meta">{{ submission.homework.subject.name }} ‚Ä¢ {{ submission.homework.teacher.user.get_full_name }}</p>
                                <div class="hw-footer">
                                    <div class="hw-deadline"><i class="far fa-calendar-check"></i> –°–¥–∞–Ω–æ: {{ submission.submitted_at|date:"d.m.Y" }}</div>
                                        <button class="btn-submit btn-submitted" disabled>–ñ—ñ–±–µ—Ä—ñ–ª–¥—ñ</button>
                                </div>
                            </div>
                                {% empty %} <p style="text-align:center; padding: 20px; color: var(--text-secondary);">–¢–µ–∫—Å–µ—Ä—É–¥–µ —Ç–∞–ø—Å—ã—Ä–º–∞ –∂–æ“õ.</p> {% endfor %}
                        </div>
                        <div id="tab-content-checked" class="tab-pane">
                            {% for submission in checked_list %}
                            <div class="homework-card">
                                 <div class="hw-card-header"><h3>{{ submission.homework.title }}</h3><span class="hw-status-tag tag-checked">–ë–∞“ì–∞: {{ submission.grade }}</span></div>
                                <p class="hw-meta">{{ submission.homework.subject.name }} ‚Ä¢ {{ submission.homework.teacher.user.get_full_name }}</p>
                                <p class="hw-description"><strong>–ú“±“ì–∞–ª—ñ–º–Ω—ñ“£ –ø—ñ–∫—ñ—Ä—ñ:</strong> {{ submission.teacher_comment|default:"-" }}</p>
                                <div class="hw-footer">
                                    <div class="hw-deadline"><i class="far fa-calendar-check"></i> –¢–µ–∫—Å–µ—Ä—ñ–ª–¥—ñ: {{ submission.checked_at|date:"d.m.Y" }}</div>
                                    <button class="btn-submit btn-checked" disabled>–¢–µ–∫—Å–µ—Ä—ñ–ª–¥—ñ</button>
                                </div>
                            </div>
                            {% empty %} <p style="text-align:center; padding: 20px; color: var(--text-secondary);">–¢–µ–∫—Å–µ—Ä—ñ–ª–≥–µ–Ω —Ç–∞–ø—Å—ã—Ä–º–∞–ª–∞—Ä –∂–æ“õ.</p> {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- –í–ö–õ–ê–î–ö–ê: –ü–†–û–§–ò–õ–¨ -->
            <div id="tab-content-profile" class="tab-pane {% if active_tab == 'profile' %}active{% endif %}">
                <p>"–ü—Ä–æ—Ñ–∏–ª—å" –±”©–ª—ñ–º—ñ ”ô–∑—ñ—Ä–ª–µ–Ω—É–¥–µ.</p>
            </div>
        </main>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–¥–∞—á–∏ –î–ó -->
    <div class="modal-overlay" id="submission-modal">
        <div class="modal-container">
            <button class="close-btn" id="close-submission-modal">&times;</button>
            <div class="modal-header">
                <h2 id="modal-hw-title">“Æ–π —Ç–∞–ø—Å—ã—Ä–º–∞—Å—ã–Ω —Ç–∞–ø—Å—ã—Ä—É</h2>
                <p id="modal-hw-subject">–ü”ô–Ω ‚Ä¢ –¢–∞–ø—Å—ã—Ä–º–∞ –∞—Ç–∞—É—ã</p>
            </div>
            <form id="submission-form" method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="task-description" id="modal-hw-description"></div>
                <div class="form-group">
                    <label for="submission_file_input">–§–∞–π–ª–¥–∞—Ä–¥—ã —Ç—ñ—Ä–∫–µ—É</label>
                    <div class="file-drop-area" id="file-drop-area">
                        <i class="fas fa-upload"></i>
                        <p id="file-drop-text">–ú“±–Ω–¥–∞ —Ñ–∞–π–ª–¥—ã —à–µ—Ä—Ç—ñ“£—ñ–∑ –Ω–µ–º–µ—Å–µ —Å“Ø–π—Ä–µ“£—ñ–∑</p>
                        <span id="file-drop-hint">PDF, DOC, DOCX, —Å—É—Ä–µ—Ç—Ç–µ—Ä (–º–∞–∫—Å. 10 –ú–ë)</span>
                        <input type="file" id="submission_file_input" name="submission_file" style="display: none;" multiple>
                    </div>
                </div>
                <div class="form-group">
                    <label for="submission_text">–ü—ñ–∫—ñ—Ä (–º—ñ–Ω–¥–µ—Ç—Ç—ñ –µ–º–µ—Å)</label>
                    <textarea id="submission_text" name="submission_text" placeholder="–ñ“±–º—ã—Å“õ–∞ –ø—ñ–∫—ñ—Ä “õ–æ—Å—ã“£—ã–∑..."></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="cancel-submission-btn">–ë–æ–ª–¥—ã—Ä–º–∞—É</button>
                    <button type="submit" class="btn-submit">–ñ—ñ–±–µ—Ä—É</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –æ—Ü–µ–Ω–∫–∏ -->
    <div class="modal-overlay" id="grade-details-modal-overlay">
        <div class="grade-modal-container">
            <div class="grade-modal-header">
                <h2>–ë–∞“ì–∞ —Ç—É—Ä–∞–ª—ã –º”ô–ª—ñ–º–µ—Ç</h2>
                <button class="close-btn" id="close-grade-modal">&times;</button>
            </div>
            <div class="grade-modal-body">
                <div class="grade-modal-info-item"><span>–ö“Ø–Ω—ñ</span><p id="modal-grade-date">--.--.----</p></div>
                <div class="grade-modal-info-item"><span>–ë–∞“ì–∞</span><p id="modal-grade-value">--</p></div>
                <div class="grade-modal-comment-item"><span>–ú“±“ì–∞–ª—ñ–º–Ω—ñ“£ –ø—ñ–∫—ñ—Ä—ñ</span><p id="modal-grade-comment">–ú“±–Ω–¥–∞ –ø—ñ–∫—ñ—Ä –∫”©—Ä—Å–µ—Ç—ñ–ª–µ–¥—ñ...</p></div>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function() {

    const menuButton = document.getElementById('mobile-menu-btn');
    const closeButton = document.getElementById('mobile-menu-close-btn');
    const navMenu = document.querySelector('.main-nav');
    const mobileNavTitle = document.getElementById('mobile-nav-title');

    if (menuButton && navMenu) {
        const navLinks = navMenu.querySelectorAll('a');

        const closeMenu = () => {
            navMenu.classList.remove('is-open');
            document.body.classList.remove('menu-open');
        };

        menuButton.addEventListener('click', function() {
            navMenu.classList.add('is-open');
            document.body.classList.add('menu-open');
        });

        closeButton.addEventListener('click', closeMenu);

        navLinks.forEach(link => {
            link.addEventListener('click', function() {
                // –¢–∞“õ—ã—Ä—ã–ø—Ç—ã –∂–∞“£–∞—Ä—Ç—É
                mobileNavTitle.textContent = this.textContent.trim();
                // –ú–µ–Ω—é–¥—ñ –∂–∞–±—É
                closeMenu();
            });
        });

        document.addEventListener('click', function(event) {
            if (navMenu.classList.contains('is-open') && !navMenu.contains(event.target) && !menuButton.contains(event.target)) {
                closeMenu();
            }
        });
    }

    // --- –¢–ê–ë–¢–ê–†–î–´ –ê–£–´–°–¢–´–†–£ “Æ–®–Ü–ù –£–ù–ò–í–ï–†–°–ê–õ–î–´ –§–£–ù–ö–¶–ò–Ø ---
    function setupTabs(tabButtonsSelector, tabPanesSelector, activeClass = 'active') {
        const tabs = document.querySelectorAll(tabButtonsSelector);
        const panes = document.querySelectorAll(tabPanesSelector);
        if (tabs.length === 0 || panes.length === 0) return;
        tabs.forEach(tab => {
            tab.addEventListener('click', function(e) {
                e.preventDefault();
                const tabId = this.dataset.tab || this.dataset.day;
                tabs.forEach(t => t.classList.remove(activeClass));
                this.classList.add(activeClass);
                panes.forEach(p => {
                    const paneId = p.id.split('-').pop();
                    const dayId = p.id.replace('day-', '');
                    p.classList.toggle(activeClass, paneId === tabId || dayId === tabId);
                });
            });
        });
    }
    setupTabs('.main-nav a', '.dashboard-main > .tab-pane');
    setupTabs('.day-tabs li', '.schedule-content .day-schedule');
    setupTabs('.homework-tabs .tab-btn', '#tab-content-homework .tab-pane');

    // --- –õ–û–ì–ò–ö–ê –î–õ–Ø –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê –°–î–ê–ß–ò –î–ó ---
    const submissionModal = document.getElementById('submission-modal');
    const dashboardMain = document.querySelector('.dashboard-main');
    if (submissionModal && dashboardMain) {
        const submissionForm = document.getElementById('submission-form');
        const fileInput = document.getElementById('submission_file_input');
        const fileDropArea = document.getElementById('file-drop-area');
        const fileDropText = document.getElementById('file-drop-text');

        dashboardMain.addEventListener('click', function(e) {
            const openBtn = e.target.closest('.open-submission-modal');
            if (openBtn) {
                const { hwPk, hwTitle, hwSubject, hwDescription } = openBtn.dataset;
                submissionModal.querySelector('#modal-hw-title').textContent = hwTitle;
                submissionModal.querySelector('#modal-hw-subject').textContent = hwSubject;
                submissionModal.querySelector('#modal-hw-description').innerHTML = `<p><strong>–¢–∞–ø—Å—ã—Ä–º–∞:</strong> ${hwDescription}</p>`;
                submissionForm.action = `/api/homework/${hwPk}/submit/`;
                submissionModal.classList.add('visible');
            }
        });

        const closeSubmissionModal = () => {
            submissionModal.classList.remove('visible');
            submissionForm.reset();
            fileDropText.textContent = '–ú“±–Ω–¥–∞ —Ñ–∞–π–ª–¥—ã —à–µ—Ä—Ç—ñ“£—ñ–∑ –Ω–µ–º–µ—Å–µ —Å“Ø–π—Ä–µ“£—ñ–∑';
            fileInput.value = '';
        };
        submissionModal.querySelector('#close-submission-modal').addEventListener('click', closeSubmissionModal);
        submissionModal.querySelector('#cancel-submission-btn').addEventListener('click', closeSubmissionModal);
        submissionModal.addEventListener('click', (e) => { if (e.target === submissionModal) closeSubmissionModal(); });

        submissionForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const submitButton = this.querySelector('button[type="submit"]');
            submitButton.disabled = true;
            submitButton.textContent = '–ñ—ñ–±–µ—Ä—ñ–ª—É–¥–µ...';
            try {
                const response = await fetch(this.action, {
                    method: 'POST',
                    body: formData,
                    headers: { 'X-CSRFToken': getCookie('csrftoken') }
                });
                const result = await response.json();
                if (response.ok) {
                    alert(result.message || '–ñ“±–º—ã—Å —Å”ô—Ç—Ç—ñ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ!');
                    window.location.reload();
                } else {
                    alert(`“ö–∞—Ç–µ: ${result.message || '–ñ“±–º—ã—Å—Ç—ã –∂—ñ–±–µ—Ä—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã.'}`);
                }
            } catch(error) {
                console.error("Fetch Error:", error);
                alert('–ñ–µ–ª—ñ–¥–µ –Ω–µ–º–µ—Å–µ —Å–µ—Ä–≤–µ—Ä–¥–µ “õ–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã. –ö–µ–π—ñ–Ω—ñ—Ä–µ–∫ “õ–∞–π—Ç–∞–ª–∞–ø –∫”©—Ä—ñ“£—ñ–∑.');
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = '–ñ—ñ–±–µ—Ä—É';
            }
        });

        fileDropArea.addEventListener('click', () => fileInput.click());
        const handleFiles = (files) => {
            if (files.length > 0) {
                 fileDropText.textContent = files.length > 1 ? `–¢–∞“£–¥–∞–ª“ì–∞–Ω —Ñ–∞–π–ª–¥–∞—Ä: ${files.length}` : files[0].name;
            } else {
                fileDropText.textContent = '–ú“±–Ω–¥–∞ —Ñ–∞–π–ª–¥—ã —à–µ—Ä—Ç—ñ“£—ñ–∑ –Ω–µ–º–µ—Å–µ —Å“Ø–π—Ä–µ“£—ñ–∑';
            }
        };
        fileInput.addEventListener('change', () => handleFiles(fileInput.files));
        fileDropArea.addEventListener('dragover', (e) => { e.preventDefault(); fileDropArea.style.backgroundColor = '#EEF2FF'; });
        fileDropArea.addEventListener('dragleave', () => { fileDropArea.style.backgroundColor = 'transparent'; });
        fileDropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileDropArea.style.backgroundColor = 'transparent';
            fileInput.files = e.dataTransfer.files;
            handleFiles(fileInput.files);
        });
    }

    // --- –õ–û–ì–ò–ö–ê –î–õ–Ø –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê –° –î–ï–¢–ê–õ–Ø–ú–ò –û–¶–ï–ù–ö–ò ---
    const gradeModalOverlay = document.getElementById('grade-details-modal-overlay');
    const closeGradeModalBtn = document.getElementById('close-grade-modal');
    const modalGradeDate = document.getElementById('modal-grade-date');
    const modalGradeValue = document.getElementById('modal-grade-value');
    const modalGradeComment = document.getElementById('modal-grade-comment');

    const closeGradeModal = () => {
        gradeModalOverlay.classList.remove('visible');
    };

    if (dashboardMain && gradeModalOverlay) {
        dashboardMain.addEventListener('click', (event) => {
            const wrapper = event.target.closest('.grade-badge-wrapper');

            // –ò–ó–ú–ï–ù–ï–ù–ò–ï 1: –£—Å–ª–æ–≤–∏–µ —Ç–µ–ø–µ—Ä—å –ø—Ä–æ—â–µ - –æ—Ç–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –¥–ª—è –õ–Æ–ë–û–ô –æ—Ü–µ–Ω–∫–∏.
            if (wrapper) {
                const date = wrapper.dataset.date;
                const gradeValue = wrapper.querySelector('.grade-badge').textContent.trim();
                const comment = wrapper.dataset.comment.trim();

                // 1. –ó–∞–ø–æ–ª–Ω—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–∞–Ω–Ω—ã–º–∏
                modalGradeDate.textContent = date;
                modalGradeValue.textContent = gradeValue;
                
                // –ï–°–ö–ï–†–¢–£: –ï–≥–µ—Ä –ø—ñ–∫—ñ—Ä –∂–æ“õ –±–æ–ª—Å–∞, –æ—Ä—ã–Ω–±–∞—Å–∞—Ä –º”ô—Ç—ñ–Ω–¥—ñ –∫”©—Ä—Å–µ—Ç–µ–º—ñ–∑.
                if (comment) {
                    modalGradeComment.textContent = comment;
                } else {
                    modalGradeComment.textContent = "–ú“±“ì–∞–ª—ñ–º–Ω—ñ“£ –ø—ñ–∫—ñ—Ä—ñ –∂–æ“õ.";
                }
                
                // 2. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                gradeModalOverlay.classList.add('visible');
            }
        });

    // –¢–µ—Ä–µ–∑–µ–Ω—ñ –∂–∞–±—É “Ø—à—ñ–Ω –æ“õ–∏“ì–∞–ª–∞—Ä–¥—ã —Ç—ñ—Ä–∫–µ—É (–∫–æ–¥ ”©–∑–≥–µ—Ä—ñ—Å—Å—ñ–∑ “õ–∞–ª–¥—ã)
        closeGradeModalBtn.addEventListener('click', closeGradeModal);
        gradeModalOverlay.addEventListener('click', (event) => {
            if (event.target === gradeModalOverlay) {
                closeGradeModal();
            }
        });
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && gradeModalOverlay.classList.contains('visible')) {
                closeGradeModal();
            }
        });
    }

    // --- –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è CSRF-—Ç–æ–∫–µ–Ω–∞ ---
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    
    
    // –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–¥–∞–ª–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è –Ω–µ–Ω—É–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è setupGradeTooltips
});
</script>

<!-- ===== –ù–ê–ß–ê–õ–û –ù–û–í–û–ì–û –°–ö–†–ò–ü–¢–ê –î–õ–Ø –í–´–†–ê–í–ù–ò–í–ê–ù–ò–Ø –®–ò–†–ò–ù–´ –°–¢–†–û–ö ===== -->
<script>
function adjustRowWidths() {
    const tbody = document.querySelector('.grades-table-v2 tbody');
    if (!tbody) return; // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ –Ω–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ, –≤—ã—Ö–æ–¥–∏–º

    const trs = tbody.querySelectorAll('tr');
    if (trs.length === 0) return;

    const firstAndLastCells = document.querySelectorAll('.grades-table-v2 .subject-teacher, .grades-table-v2 tr td:last-child');

    // –ü–æ–ª—É—á–∞–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é —à–∏—Ä–∏–Ω—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ tbody –≤ –ø–∏–∫—Å–µ–ª—è—Ö
    const tbodyWidth = tbody.offsetWidth;

    if (tbodyWidth >= 768) {

        // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ç—É —à–∏—Ä–∏–Ω—É –∫ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ tr
        trs.forEach(row => {
            row.style.width = `${tbodyWidth}px`;
        });
    } else {
        trs.forEach(row => {
            row.style.display = 'block';
            row.style.width = '100%'; // –¢–∞–∫–∂–µ —É—Å—Ç–∞–Ω–æ–≤–∏–º —à–∏—Ä–∏–Ω—É 100% –¥–ª—è –±–ª–æ—á–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
        });

        // 2. –ú–µ–Ω—è–µ–º —É –ø–µ—Ä–≤–æ–π –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π —è—á–µ–π–∫–∏ —à–∏—Ä–∏–Ω—É –Ω–∞ '100%'
        firstAndLastCells.forEach(cell => {
            cell.style.width = '100%';
        });
    }
}

// –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ–≥–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–∞
document.addEventListener('DOMContentLoaded', adjustRowWidths);

// –¢–∞–∫–∂–µ –≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
window.addEventListener('resize', adjustRowWidths);
</script>

</body>
</html>