<!-- bilimClassApp/templates/bilimClassApp/dashboard.html -->
{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∞—à–±–æ—Ä–¥ - Bilim Class</title>
    <link rel="stylesheet" href="{% static 'bilimClassApp/css/style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        :root{
            --bg-main:#F9FAFB;
            --bg-widget:#FFFFFF;
            --text-primary:#111827;
            --text-secondary:#6B7280;
            --border-color:#E5E7EB;
            --accent-primary:#4F46E5;
            --accent-light:#EEF2FF;
            --status-pending-bg:#FEF3C7;
            --status-pending-text:#92400E;
            --status-review-bg:#DBEAFE;
            --status-review-text:#1E40AF;
            --status-checked-bg:#D1FAE5;
            --status-checked-text:#065F46
        }
        /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Inter',sans-serif;background-color:var(--bg-main);color:var(--text-primary)}
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π */
        .homework-widget{background-color:var(--bg-widget);border-radius:16px;padding:24px}
        .widget-header{margin-bottom:24px}
        .widget-header h2{font-size:20px;font-weight:600}
        .widget-header p{color:var(--text-secondary)}
        .stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:24px}
        .stat-card{display:flex;align-items:center;gap:16px;padding:20px;border:1px solid var(--border-color);border-radius:12px}
        .stat-icon{width:40px;height:40px;border-radius:50%;display:grid;place-items:center;font-size:16px}
        .stat-card-pending .stat-icon{background-color:var(--status-pending-bg);color:var(--status-pending-text)}
        .stat-card-review .stat-icon{background-color:var(--status-review-bg);color:var(--status-review-text)}
        .stat-card-checked .stat-icon{background-color:var(--status-checked-bg);color:var(--status-checked-text)}
        .stat-value{font-size:24px;font-weight:700}
        .stat-label{font-size:14px;color:var(--text-secondary)}
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–æ–≤ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π */
        .homework-tabs{display:flex;gap:8px;margin-bottom:24px; border-bottom: 1px solid var(--border-color);}
        .homework-tabs .tab-btn{padding:8px 16px;background-color:transparent;border:none;border-bottom: 2px solid transparent; border-radius: 0; font-weight:600;cursor:pointer;color:var(--text-secondary);transition:all .2s; margin-bottom: -1px;}
        .homework-tabs .tab-btn.active{border-bottom-color:var(--accent-primary);color:var(--accent-primary)}
        .homework-list{display:flex;flex-direction:column;gap:16px}
        .tab-pane .tab-pane {display:none} /* –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å */
        #tab-content-homework .tab-pane.active{display:flex;flex-direction:column;gap:16px}
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π */
        .homework-card{border:1px solid var(--border-color);border-radius:12px;padding:20px}
        .hw-card-header{display:flex;align-items:center;gap:12px;margin-bottom:8px}
        .hw-card-header h3{font-size:18px;font-weight:600}
        .hw-status-tag{font-size:12px;font-weight:500;padding:4px 10px;border-radius:99px}
        .tag-pending{background-color:var(--status-pending-bg);color:var(--status-pending-text)}
        .tag-review{background-color:var(--status-review-bg);color:var(--status-review-text)}
        .tag-checked{background-color:var(--status-checked-bg);color:var(--status-checked-text)}
        .hw-meta{color:var(--text-secondary);font-size:14px;margin-bottom:12px}
        .hw-description{margin-bottom:16px}
        .hw-footer{display:flex;justify-content:space-between;align-items:center;border-top:1px solid var(--border-color);padding-top:16px;margin-top:16px}
        .hw-deadline{display:flex;align-items:center;gap:8px;color:var(--text-secondary);font-size:14px}
        .btn-submit{display:flex;align-items:center;justify-content:center;gap:8px;padding:10px 16px;background-color:var(--accent-primary);color:#fff;border:none;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer}
        .btn-submitted{background-color:var(--status-review-bg);color:var(--status-review-text);cursor:default}
        .btn-checked{background-color:var(--status-checked-bg);color:var(--status-checked-text);cursor:default}
        .btn-submit.open-submission-modal {width: 150px;}

        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
        .modal-overlay{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(17, 24, 39, 0.6);justify-content:center;align-items:center; backdrop-filter: blur(4px);}
        .modal-overlay.visible {display: flex;}
        .modal-container{background-color:var(--bg-widget);border-radius:16px;padding:32px;width:90%;max-width:600px;box-shadow:0 10px 25px rgba(0,0,0,.1);position:relative}
        
        .modal-header{margin-bottom:24px;}
        .modal-header h2{font-size:22px;font-weight:700; color: var(--text-primary);}
        .modal-header p{color:var(--text-secondary); font-size: 14px; margin-top: 4px;}
        .close-btn{position:absolute;top:16px;right:16px;background:0 0;border:none;font-size:24px;color:var(--text-secondary);cursor:pointer; width: 32px; height: 32px; line-height: 32px; text-align: center;}
        
        .task-description { margin-bottom: 24px; font-size: 14px; line-height: 1.5;}
        
        .form-group{display:flex;flex-direction:column;margin-bottom:20px}
        .form-group label{font-size:14px;font-weight:600;margin-bottom:8px; color: var(--text-primary);}
        .form-group textarea{padding:10px 12px;border:1px solid var(--border-color);border-radius:8px;background-color:#F9FAFB;font-family:'Inter',sans-serif;font-size:14px;resize:vertical;min-height:90px}
        .form-group textarea::placeholder {color: var(--text-secondary);}
        
        .file-drop-area{border:2px dashed var(--border-color);border-radius:8px;padding:32px;text-align:center;color:var(--text-secondary); cursor: pointer; transition: background-color .2s;}
        .file-drop-area:hover { background-color: #F9FAFB; }
        .file-drop-area i{font-size:24px;margin-bottom:12px; color: var(--accent-primary);}
        .file-drop-area p{font-weight:600; color: var(--text-primary);}
        .file-drop-area span{font-size:12px; margin-top: 4px;}
        
        .modal-footer{display:flex;justify-content:flex-end;gap:12px;margin-top:24px; padding-top: 24px; border-top: 1px solid var(--border-color);}
        .btn-secondary{padding:10px 16px;background-color:var(--bg-widget);color:var(--text-primary);border:1px solid var(--border-color);border-radius:8px;font-size:14px;font-weight:600;cursor:pointer}

    </style>
</head>
<body class="dashboard-body">

    <div class="dashboard-container">
        <!-- –®–∞–ø–∫–∞ -->
        <header class="dashboard-header">
            <div class="header-logo">
                <div class="logo-icon-wrapper-dash">üéì</div>
                <div>
                    <h2>Bilim Class</h2>
                    <span>{{ user_role }}</span>
                </div>
            </div>
            <div class="header-user-profile">
                <i class="fas fa-bell"></i>
                <div class="user-avatar">
                    <span>{{ request.user.first_name|first }}{{ request.user.last_name|first }}</span>
                </div>
                <div class="user-info">
                    <p>{{ request.user.get_full_name }}</p>
                    <a href="{% url 'logout' %}">–í—ã–π—Ç–∏</a>
                </div>
            </div>
        </header>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="dashboard-main">
            <div class="welcome-section">
                <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ request.user.first_name }}!</h1>
                <p>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç {{ user_role|lower }}–∞</p>
            </div>
            
            <!-- –¢–∞–±—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
            <nav class="main-tabs">
                <ul>
                    <li data-tab="schedule" class="{% if active_tab == 'schedule' or not active_tab %}active{% endif %}"><a href="#">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a></li>
                    <li data-tab="dnevnik" class="{% if active_tab == 'dnevnik' %}active{% endif %}"><a href="#">–î–Ω–µ–≤–Ω–∏–∫</a></li>
                    <li data-tab="homework" class="{% if active_tab == 'homework' %}active{% endif %}"><a href="#">–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</a></li>
                    <li data-tab="profile" class="{% if active_tab == 'profile' %}active{% endif %}"><a href="#">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                </ul>
            </nav>

            <div id="tab-content-schedule" class="tab-pane {% if active_tab == 'schedule' or not active_tab %}active{% endif %}">
                 <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –†–∞—Å–ø–∏—Å–∞–Ω–∏—è -->
                 <section class="schedule-section">
                    <h3>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–æ–≤</h3>
                    <p>–í–∞—à–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –Ω–µ–¥–µ–ª—é</p>
                    <nav class="day-tabs">
                        <ul><li data-day="1" class="active">–ü–ù</li><li data-day="2">–í–¢</li><li data-day="3">–°–†</li><li data-day="4">–ß–¢</li><li data-day="5">–ü–¢</li><li data-day="6">–°–ë</li></ul>
                    </nav>
                    <div class="schedule-content">
                        {% for day, lessons in schedule_by_day.items %}
                            <div id="day-{{ day }}" class="day-schedule {% if forloop.first %}active{% endif %}">
                                {% for lesson in lessons %}
                                    <div class="lesson-card">
                                        <div class="lesson-info">
                                            <div class="lesson-number">{{ forloop.counter }}</div>
                                            <div>
                                                <p class="lesson-title">{{ lesson.subject.name }}</p>
                                                <div class="lesson-details">
                                                    <span><i class="far fa-clock"></i> {{ lesson.start_time|time:"H:i" }} - {{ lesson.end_time|time:"H:i" }}</span>
                                                    <span><i class="fas fa-map-marker-alt"></i> –ö–∞–±–∏–Ω–µ—Ç {{ lesson.classroom }}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="lesson-start-time">{{ lesson.start_time|time:"H:i" }}</div>
                                    </div>
                                {% empty %}
                                    <p class="no-lessons">–í —ç—Ç–æ—Ç –¥–µ–Ω—å —É—Ä–æ–∫–æ–≤ –Ω–µ—Ç.</p>
                                {% endfor %}
                            </div>
                        {% endfor %}
                    </div>
                </section>
            </div>

            <div id="tab-content-dnevnik" class="tab-pane {% if active_tab == 'dnevnik' %}active{% endif %}">
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –î–Ω–µ–≤–Ω–∏–∫–∞ -->
                <div class="stats-cards-grid">
                    <div class="stat-card"><div class="stat-icon green"><i class="fas fa-chart-line"></i></div><div class="stat-info"><p>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</p><span>{{ average_grade|floatformat:2 }}</span></div><small>–∏–∑ 100.0</small></div>
                    <div class="stat-card"><div class="stat-icon blue"><i class="fas fa-book-open"></i></div><div class="stat-info"><p>–í—Å–µ–≥–æ –æ—Ü–µ–Ω–æ–∫</p><span>{{ total_grades_count }}</span></div><small class="stat-meta">–∑–∞ –ø–µ—Ä–∏–æ–¥</small></div>
                    <div class="stat-card"><div class="stat-icon red"><i class="fas fa-user-clock"></i></div><div class="stat-info"><p>–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</p><span>{{ attendance_percentage|floatformat:1 }}<small class="percent-sign">%</small></span></div><small>{{ total_absences }} –ø—Ä–æ–ø—É—Å–∫–æ–≤</small></div>
                </div>
            </div>

            <!-- ===== –°–ï–ö–¶–ò–Ø –î–û–ú–ê–®–ù–ò–• –ó–ê–î–ê–ù–ò–ô ===== -->
            <div id="tab-content-homework" class="tab-pane {% if active_tab == 'homework' %}active{% endif %}">
                <div class="homework-widget">
                    <div class="widget-header"><h2>–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</h2><p>–í—Å–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º</p></div>
                    <div class="stats-grid">
                        <div class="stat-card stat-card-pending"><div class="stat-icon">üïí</div><div><div class="stat-value">{{ not_submitted_list.count }}</div><p class="stat-label">–ù–µ —Å–¥–∞–Ω–æ</p></div></div>
                        <div class="stat-card stat-card-review"><div class="stat-icon">üìÑ</div><div><div class="stat-value">{{ in_review_list.count }}</div><p class="stat-label">–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</p></div></div>
                        <div class="stat-card stat-card-checked"><div class="stat-icon">‚úì</div><div><div class="stat-value">{{ checked_list.count }}</div><p class="stat-label">–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</p></div></div>
                    </div>
                    <div class="homework-tabs">
                        <button class="tab-btn active" data-tab="not_submitted">–ù–µ —Å–¥–∞–Ω–æ ({{ not_submitted_list.count }})</button>
                        <button class="tab-btn" data-tab="in_review">–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ ({{ in_review_list.count }})</button>
                        <button class="tab-btn" data-tab="checked">–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ ({{ checked_list.count }})</button>
                    </div>
            
                    <div class="homework-list" id="homework-list-container">
                        <div id="tab-content-not_submitted" class="tab-pane active">
                            {% for hw in not_submitted_list %}
                            <div class="homework-card">
                                <div class="hw-card-header"><h3>{{ hw.title }}</h3><span class="hw-status-tag tag-pending">–ù–µ —Å–¥–∞–Ω–æ</span></div>
                                <p class="hw-meta">{{ hw.subject.name }} ‚Ä¢ {{ hw.teacher.user.get_full_name }}</p>
                                <p class="hw-description">{{ hw.description|truncatewords:20 }}</p>
                                
                                <!-- –ò–ó–ú–ï–ù–ï–ù–ò–ï 1: –°–∫—Ä—ã—Ç—ã–π div –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è -->
                                <div class="hw-full-description" style="display: none;">{{ hw.description }}</div>

                                <div class="hw-footer">
                                    <div class="hw-deadline"><i class="far fa-clock"></i> –°—Ä–æ–∫ —Å–¥–∞—á–∏: {{ hw.due_date|date:"d.m.Y H:i" }}</div>
                                    
                                    <!-- –ò–ó–ú–ï–ù–ï–ù–ò–ï 2: –£–¥–∞–ª–µ–Ω data-hw-description -->
                                    <button class="btn-submit open-submission-modal" 
                                            data-hw-pk="{{ hw.pk }}"
                                            data-hw-title="{{ hw.title }}"
                                            data-hw-subject="{{ hw.subject.name }}"
                                            data-hw-teacher="{{ hw.teacher.user.get_full_name }}">–°–¥–∞—Ç—å —Ä–∞–±–æ—Ç—É</button>
                                </div>
                            </div>
                            {% empty %} <p style="text-align:center; padding: 20px; color: var(--text-secondary);">–ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —Å–¥–∞—Ç—å.</p> {% endfor %}
                        </div>
                        <!-- ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ ... -->
                    </div>
                </div>
            </div>

            <div id="tab-content-profile" class="tab-pane {% if active_tab == 'profile' %}active{% endif %}">
                <p>–†–∞–∑–¥–µ–ª "–ü—Ä–æ—Ñ–∏–ª—å" –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.</p>
            </div>
        </main>
    </div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–¥–∞—á–∏ –î–ó -->
<div class="modal-overlay" id="submission-modal">
    <div class="modal-container">
        <button class="close-btn" id="close-submission-modal">&times;</button>
        <div class="modal-header">
            <h2 id="modal-hw-title">–°–¥–∞—Ç—å –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ</h2>
            <p id="modal-hw-subject">–ü—Ä–µ–¥–º–µ—Ç ‚Ä¢ –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</p>
        </div>
        <form id="submission-form" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="task-description" id="modal-hw-description"></div>
            <div class="form-group">
                <label for="submission_file_input">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª—ã</label>
                <div class="file-drop-area" id="file-drop-area">
                    <i class="fas fa-upload"></i>
                    <p id="file-drop-text">–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞</p>
                    <span id="file-drop-hint">PDF, DOC, DOCX, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–º–∞–∫—Å. 10 –ú–ë)</span>
                    <input type="file" id="submission_file_input" name="submission_file" style="display: none;">
                </div>
            </div>
            <div class="form-group">
                <label for="submission_text">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                <textarea id="submission_text" name="submission_text" placeholder="–î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Ä–∞–±–æ—Ç–µ..."></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancel-submission-btn">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn-submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç—É</button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // --- –õ–æ–≥–∏–∫–∞ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –°–î–ê–ß–ò –î–ó ---
    const submissionModal = document.getElementById('submission-modal');
    const homeworkList = document.getElementById('homework-list-container');
    
    if (submissionModal && homeworkList) {
        const submissionForm = document.getElementById('submission-form');
        const fileInput = document.getElementById('submission_file_input');
        const fileDropArea = document.getElementById('file-drop-area');
        const fileDropText = document.getElementById('file-drop-text');
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        homeworkList.addEventListener('click', function(e) {
            const openBtn = e.target.closest('.open-submission-modal');
            if (openBtn) {
                // –ò–ó–ú–ï–ù–ï–ù–ò–ï 3: –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –∏ —Å–∫—Ä—ã—Ç–æ–≥–æ div
                const card = openBtn.closest('.homework-card');
                const fullDescription = card.querySelector('.hw-full-description').textContent;
                const { hwPk, hwTitle, hwSubject } = openBtn.dataset;
                
                submissionModal.querySelector('#modal-hw-title').textContent = '–°–¥–∞—Ç—å –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ';
                submissionModal.querySelector('#modal-hw-subject').textContent = `${hwSubject} ‚Ä¢ ${hwTitle}`;
                submissionModal.querySelector('#modal-hw-description').innerHTML = `<p><strong>–ó–∞–¥–∞–Ω–∏–µ:</strong> ${fullDescription}</p>`;

                submissionForm.action = `/api/homework/${hwPk}/submit/`;
                submissionModal.classList.add('visible'); // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª–∞—Å—Å –¥–ª—è –ø–æ–∫–∞–∑–∞
            }
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        const closeSubmissionModal = () => {
            submissionModal.classList.remove('visible');
            submissionForm.reset(); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
            fileDropText.textContent = '–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞'; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç
        };
        submissionModal.querySelector('#close-submission-modal').addEventListener('click', closeSubmissionModal);
        submissionModal.querySelector('#cancel-submission-btn').addEventListener('click', closeSubmissionModal);
        submissionModal.addEventListener('click', (e) => { if (e.target === submissionModal) closeSubmissionModal(); });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        submissionForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            try {
                const response = await fetch(this.action, {
                    method: 'POST',
                    body: formData,
                    headers: { 'X-CSRFToken': getCookie('csrftoken') }
                });
                const result = await response.json();
                if (response.ok) {
                    alert(result.message);
                    window.location.reload();
                } else {
                    alert(`–û—à–∏–±–∫–∞: ${result.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç—É.'}`);
                }
            } catch(error) {
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ —Å–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞.');
            }
        });

        // –ò–ó–ú–ï–ù–ï–ù–ò–ï 4: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
        fileDropArea.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                fileDropText.textContent = fileInput.files[0].name; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞
            } else {
                fileDropText.textContent = '–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞';
            }
        });
    }
});
</script>

</body>
</html>