{% extends "bilimClassApp/base.html" %}

{% block title %}Редактировать профиль - BilimClass{% endblock %}

{% block content %}
<div class="form-wrapper">
    <h2>Редактирование профиля: {{ user.username }}</h2>
    <div id="message-container"></div>
    
    <form id="profile-form" method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Сохранить изменения</button>
    </form>
</div>

    <script>
        document.getElementById('profile-form').addEventListener('submit', function(e) {
            e.preventDefault(); 

            const form = e.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            const csrfToken = form.querySelector('[name=csrfmiddlewaretoken]').value;
            
            fetch("{% url 'profile' %}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken,
                    'X-Requested-With': 'XMLHttpRequest',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                const messageContainer = document.getElementById('message-container');
                if (data.status === 'success') {
                    messageContainer.textContent = data.message;
                    messageContainer.style.backgroundColor = '#d4edda';
                    messageContainer.style.color = '#155724';
                } else {
                    messageContainer.textContent = 'Произошла ошибка. Проверьте данные.';
                    messageContainer.style.backgroundColor = '#f8d7da';
                    messageContainer.style.color = '#721c24';
                    console.log(data.errors);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                const messageContainer = document.getElementById('message-container');
                messageContainer.textContent = 'Произошла ошибка при отправке запроса.';
                messageContainer.style.backgroundColor = '#f8d7da';
                messageContainer.style.color = '#721c24';
            });
        });
    </script>
{% endblock %}