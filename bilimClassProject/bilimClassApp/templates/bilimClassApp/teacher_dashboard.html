{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∞—à–±–æ—Ä–¥ –£—á–∏—Ç–µ–ª—è | –®–∫–æ–ª—å–Ω–∞—è –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="stylesheet" href="{% static 'bilimClassApp/css/teacher_homework.css' %}">
    <link rel="stylesheet" href="{% static 'bilimClassApp/css/teacher_dashboard.css' %}">
    <link rel="stylesheet" href="{% static 'bilimClassApp/css/base.css' %}">    

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        :root {
            --bg-main: #F9FAFB; --bg-widget: #FFFFFF; --text-primary: #111827;
            --text-secondary: #6B7280; --border-color: #E5E7EB; --accent-primary: #4F46E5;
            --accent-light: #EEF2FF; --accent-blue: #3B82F6; --accent-orange: #F97316;
            --accent-purple: #8B5CF6; --accent-red: #EF4444; --accent-green: #10B981;
            /* –°—Ç–∏–ª–∏ –¥–ª—è –∂—É—Ä–Ω–∞–ª–∞ */
            --grade-5:#D1FAE5; --grade-5-text:#065F46; --grade-4:#DBEAFE;
            --grade-4-text:#1E40AF; --grade-3:#FEF3C7; --grade-3-text:#92400E;
            /* –¢–µ–Ω—å –¥–ª—è –≤–∏–¥–∂–µ—Ç–æ–≤ */
            --widget-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: var(--accent-light); color: var(--text-primary); }
        .td-container { max-width: 1400px; margin: 0 auto; padding: 24px; }
        .td-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .td-logo-section { display: flex; align-items: center; gap: 12px; }
        .td-logo-icon { width: 40px; height: 40px; background-color: var(--accent-primary); border-radius: 8px; color: white; display: grid; place-items: center; font-size: 20px; }
        .td-logo-section h1 { font-size: 18px; } .td-logo-section p { font-size: 14px; color: var(--text-secondary); }
        .td-user-section { display: flex; align-items: center; gap: 16px; }
        .td-user-info { text-align: right; } .td-user-info h3 { font-weight: 600; }
        .td-user-info p { font-size: 14px; color: var(--text-secondary); }
        .td-user-link { text-decoration: none; color: inherit; }
        .td-user-avatar { width: 40px; height: 40px; border-radius: 50%; background-color: #D8B4FE; color: #581C87; display: grid; place-items: center; font-weight: 600; }
        .td-main-grid { display: grid; }
        .td-main-nav { background-color: var(--bg-widget); border: 1px solid var(--border-color); border-radius: 12px; padding: 8px; margin-bottom: 24px; box-shadow: var(--widget-shadow); }
        .td-main-nav ul { display: flex; list-style: none; gap: 8px; }
        .td-main-nav a { display: flex; align-items: center; gap: 8px; padding: 10px 16px; text-decoration: none; color: var(--text-secondary); font-weight: 600; border-radius: 8px; transition: all 0.2s; cursor: pointer; }
        .td-main-nav a:hover { background-color: #F3F4F6; color: var(--text-primary); }
        .td-main-nav a.active { background-color: var(--accent-light); color: var(--accent-primary); }
        .td-card { background-color: var(--bg-widget); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; box-shadow: var(--widget-shadow); }
        .td-card-header { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
        .td-card-header i { color: var(--text-secondary); } .td-card-header h3 { font-size: 18px; font-weight: 600; }
        .td-card-subtitle { color: var(--text-secondary); margin-bottom: 20px; }
        
        .td-stats-cards { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
        .td-stat-card {
            background-color: var(--bg-widget);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--widget-shadow);
        }
        .td-stat-card .stat-info p {
            font-size: 14px;
            color: var(--text-secondary);
            margin: 0 0 4px 0;
        }
        .td-stat-card .stat-info h2 {
            font-size: 28px;
            font-weight: 600;
            color: var(--text-primary);
        }
        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: grid;
            place-items: center;
            font-size: 20px;
            color: #FFFFFF;
        }

        .stat-icon i { margin-top: 12px;}

        .stat-icon.blue { background-color: var(--accent-blue); }
        .stat-icon.orange { background-color: var(--accent-orange); }
        .stat-icon.purple { background-color: var(--accent-purple); }
        .stat-icon.red { background-color: var(--accent-red); }

        .td-schedule-list { display: flex; flex-direction: column; gap: 12px; }
        .td-lesson-item { display: flex; align-items: center; gap: 16px; padding: 16px; border-radius: 10px; background-color: #F9FAFB; }
        .td-lesson-time p { font-weight: 600; } .td-lesson-info { flex-grow: 1; }
        .td-right-column { display: flex; flex-direction: column; gap: 24px; }
        .tab-content { display: none; } .tab-content.active { display: block; }
        
        /* –°–¢–ò–õ–ò –î–õ–Ø –†–ê–°–ü–ò–°–ê–ù–ò–Ø */
        .schedule-stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 24px; }
        .schedule-stat-item { background-color: var(--bg-main); border-radius: 12px; padding: 20px; display: flex; align-items: center; gap: 16px; }
        .schedule-stat-item .icon-bg { font-size: 18px; width: 48px; height: 48px; border-radius: 50%; display: grid; place-items: center; }
        .schedule-stat-item .icon-bg.blue { background-color: #DBEAFE; color: #1D4ED8; }
        .schedule-stat-item .icon-bg.purple { background-color: #E0E7FF; color: #4338CA; }
        .schedule-stat-item .icon-bg.green { background-color: #D1FAE5; color: #047857; }
        .schedule-week-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; }
        .schedule-day-column { background-color: var(--bg-main); border-radius: 12px; padding: 16px; }
        .schedule-day-column.today { background-color: var(--accent-light); border: 1px solid var(--accent-primary); }
        .day-header { margin-bottom: 16px; text-align: center; }
        .lessons-list { display: flex; flex-direction: column; gap: 12px; }
        .lesson-card {display:flex; flex-direction: column; gap: 10px; background-color: var(--bg-widget); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; }

        /* –°–¢–ò–õ–ò –î–õ–Ø –ñ–£–†–ù–ê–õ–ê */
        .journal-widget { background-color: var(--bg-widget); border: 1px solid var(--border-color); border-radius: 16px; padding: 24px; box-shadow: var(--widget-shadow); }
        .journal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .journal-title h2 { font-size: 20px; font-weight: 600; }
        .journal-title p { color: var(--text-secondary); }
        .class-selector { padding: 10px 16px; border: 1px solid var(--border-color); border-radius: 8px; font-weight: 500; background-color: #F9FAFB; font-family: 'Inter', sans-serif; font-size: 14px; -webkit-appearance: none; appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right .75rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; padding-right: 2.5rem; }
        .journal-tabs { display: flex; gap: 8px; margin-bottom: 24px; }
        .tab-btn { padding: 8px 16px; background: transparent; border: 1px solid var(--border-color); border-radius: 8px; font-weight: 600; cursor: pointer; font-family: 'Inter', sans-serif; font-size: 14px; transition: all .2s; }
        .tab-btn.active { background-color: var(--accent-primary); border-color: var(--accent-primary); color: #fff; }
        .journal-table { width: 100%; border-collapse: collapse; display: table; }
        .journal-table tr { display: table-row; }
        .journal-table th, .journal-table td { display: table-cell; vertical-align: middle; }
        .journal-table th { font-size: 12px; text-transform: uppercase; color: var(--text-secondary); font-weight: 600; text-align: center; padding-bottom: 16px; }
        .journal-table th:first-child { text-align: left; }
        .journal-table td { padding: 6px; text-align: center; border-bottom: 1px solid var(--border-color); }
        .journal-table tr:last-child td { border-bottom: none; }
        .journal-table td:first-child { text-align: left; font-weight: 500; }
        .grade-cell {background-color: #EFF6FF; margin-left: 50%; transform: translateX(-50%); width:73px; border: 1px solid #90a5ea; cursor:pointer;border-radius:8px;min-height:48px;display:flex;align-items:center;justify-content:center;transition:background-color .2s}
        .attendance-cell {background-color: #EFF6FF; width:73px; border: 1px solid #90a5ea; cursor:pointer;border-radius:8px;min-height:48px;display:flex;align-items:center;justify-content:center;transition:background-color .2s}
        .grade-cell:hover, .attendance-cell:hover{background-color:#EFF6FF}
        .grade-badge{display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:8px;font-weight:700;font-size:16px}
        .grade-5{background-color:var(--grade-5);color:var(--grade-5-text)}.grade-4{background-color:var(--grade-4);color:var(--grade-4-text)}.grade-3{background-color:var(--grade-3);color:var(--grade-3-text)}
        .grade-badge-container{position:relative;display:inline-flex}
        .grade-comment-icon{font-size:10px;color:var(--text-secondary);position:absolute;bottom:5px;right:5px}
        .attendance-icon{display:inline-flex;align-items:center;justify-content:center;width:32px;height:32px;border-radius:50%;font-weight:bold;font-size:16px}
        .status-P{color:#059669;background-color:#ECFDF5}.status-A{color:#DC2626;background-color:#FEF2F2}.status-L{color:#D97706;background-color:#FFFBEB}
        .modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,.5)}
        .modal-content{background-color:#F9FAFB;margin:15% auto;padding:20px;border:none;width:90%;max-width:400px;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,.1)}
        .close-btn{color:#aaa;float:right;font-size:28px;font-weight:bold;cursor:pointer}
        #grade-form input,#grade-form textarea{width:100%;padding:12px;font-size:16px;border:1px solid var(--border-color);border-radius:8px;margin:10px 0;font-family:'Inter',sans-serif}
        #grade-form button{width:100%;padding:12px;background-color:var(--accent-primary);color:#fff;border:none;border-radius:8px;font-size:16px;cursor:pointer}
        
        /* –°–¢–ò–õ–ò –î–õ–Ø –ü–û–£–†–û–ß–ù–´–• –ü–õ–ê–ù–û–í */
        .lp-widget { background-color: var(--bg-widget); border: 1px solid var(--border-color); border-radius: 16px; padding: 24px; box-shadow: var(--widget-shadow); }
        
        /* –°–¢–ò–õ–ò –î–õ–Ø –î–û–ú–ê–®–ù–ò–• –ó–ê–î–ê–ù–ò–ô */
        .homework-widget { background-color: var(--bg-widget); border: 1px solid var(--border-color); border-radius: 16px; padding: 24px; box-shadow: var(--widget-shadow); }
        .widget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .widget-title h2 { font-size: 20px; font-weight: 600; }
        .widget-title p { color: var(--text-secondary); }
        .btn-create { background-color: var(--accent-primary); color: white; border: none; padding: 10px 16px; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: background-color 0.2s; }
        .btn-create:hover { background-color: #4338CA; }
        .homework-list { display: flex; flex-direction: column; gap: 16px; }
        .homework-card { background-color: var(--bg-main); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; }
        .hw-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .hw-title-group { display: flex; align-items: center; gap: 12px; }
        .hw-title-group h3 { font-size: 16px; font-weight: 600; }
        .hw-tag { background-color: #E0E7FF; color: #3730A3; font-size: 12px; font-weight: 500; padding: 4px 10px; border-radius: 6px; }
        .hw-actions button { background: none; border: 1px solid var(--border-color); width: 32px; height: 32px; border-radius: 6px; cursor: pointer; color: var(--text-secondary); transition: all 0.2s; }
        .hw-actions button:hover { background-color: var(--accent-light); color: var(--accent-primary); }
        .hw-description { color: var(--text-secondary); margin-bottom: 16px; font-size: 14px; }
        .hw-card-footer { display: flex; justify-content: space-between; align-items: center; }
        .hw-stats { font-size: 13px; color: var(--text-secondary); }
        .btn-view-submissions { background-color: var(--bg-widget); border: 1px solid var(--border-color); color: var(--text-primary); padding: 8px 14px; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: background-color 0.2s; }
        .btn-view-submissions:hover { background-color: #F3F4F6; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
        .modal-overlay { display: none; position: fixed; inset: 0; background-color: rgba(17, 24, 39, 0.6); z-index: 1000; align-items: center; justify-content: center; }
        .modal-container { background-color: var(--bg-widget); border-radius: 12px; padding: 24px; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; position: relative; }
        .modal-header { text-align: center; margin-bottom: 16px; }
        .modal-header h2 { font-size: 20px; }
        .modal-container .close-btn { position: absolute; top: 16px; right: 16px; background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-secondary); }
        .form-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
        .form-group.full-width { grid-column: 1 / -1; }
        .modal-footer { display: flex; justify-content: flex-end; gap: 12px; margin-top: 24px; grid-column: 1 / -1; }
        .btn-secondary { background-color: var(--bg-widget); border: 1px solid var(--border-color); }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Å–¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç */
        .submissions-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .submissions-table th, .submissions-table td { padding: 12px; border-bottom: 1px solid var(--border-color); text-align: left; font-size: 14px; }
        .submissions-table th { color: var(--text-secondary); font-weight: 600; }
        .status-tag { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 99px; font-weight: 500; font-size: 12px; }
        .status-checked { background-color: #D1FAE5; color: #065F46; }
        .status-submitted { background-color: #DBEAFE; color: #1E40AF; }
        .status-awaiting { background-color: #FEF3C7; color: #92400E; }
        .grade-circle { display: inline-flex; align-items: center; justify-content: center; width: 30px; height: 30px; border-radius: 50%; background-color: var(--accent-primary); color: white; font-weight: bold; }
        .file-link { color: var(--accent-primary); text-decoration: none; font-weight: 500; }
        .file-link i { margin-right: 4px; }

        /* --- –ö–†–ê–°–ò–í–´–ô –°–¢–ò–õ–¨ –î–õ–Ø –ü–û–õ–Ø –ó–ê–ì–†–£–ó–ö–ò –§–ê–ô–õ–ê --- */

/* –°—Ç–∏–ª—å –¥–ª—è –º–µ—Ç–∫–∏ (label) –Ω–∞–¥ –ø–æ–ª–µ–º –≤–≤–æ–¥–∞ */
.form-group label[for*="attached_file"] {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    font-size: 14px;
    color: var(--text-primary);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∞–º–æ–≥–æ –ø–æ–ª—è input[type=file] */
input[name="attached_file"] {
    width: 100%;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    color: var(--text-secondary);
    
    /* –î–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –∏ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ–≥–æ –≤–∏–¥–∞ */
    background-color: var(--bg-widget);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 4px;
}

/* –°—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª" –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö */
input[name="attached_file"]::file-selector-button {
    /* –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å—Ç–∏–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ */
    -webkit-appearance: none;
    appearance: none;
    
    /* –ù–∞—à–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏ */
    background-color: var(--accent-primary);
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: 8px;
    font-weight: 600;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    cursor: pointer;
    margin-right: 16px; /* –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–æ–π –∏ —Ç–µ–∫—Å—Ç–æ–º —Å –∏–º–µ–Ω–µ–º —Ñ–∞–π–ª–∞ */
    transition: background-color 0.2s;
}

/* –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É */
input[name="attached_file"]::file-selector-button:hover {
    background-color: #4338CA; /* –ë–æ–ª–µ–µ —Ç–µ–º–Ω—ã–π –æ—Ç—Ç–µ–Ω–æ–∫ --accent-primary */
}

/* --- –°–¢–ò–õ–¨ –î–õ–Ø –ì–†–ê–î–ò–ï–ù–¢–ù–û–ô –ö–ù–û–ü–ö–ò --- */

.btn-gradient {
    /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –∫–Ω–æ–ø–∫–∏ */
    border: none;
    border-radius: 8px;
    padding: 12px 20px;
    font-family: 'Inter', sans-serif;
    font-size: 16px;
    font-weight: 600;
    color: white;
    cursor: pointer;
    
    /* –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ */
    background-image: linear-gradient(to right, var(--accent-primary) 0%, var(--accent-purple) 100%);
    
    /* –¢–µ–Ω—å –¥–ª—è –æ–±—ä–µ–º–∞ */
    box-shadow: 0 2px 5px rgba(79, 70, 229, 0.2), 0 1px 2px rgba(0,0,0,0.05);
    
    /* –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –¥–ª—è –≤—Å–µ—Ö —Å–≤–æ–π—Å—Ç–≤ */
    transition: all 0.2s ease-in-out;
}

/* –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –∫—É—Ä—Å–æ—Ä–∞ */
.btn-gradient:hover {
    /* –°–ª–µ–≥–∫–∞ –ø—Ä–∏–ø–æ–¥–Ω–∏–º–∞–µ–º –∫–Ω–æ–ø–∫—É */
    transform: translateY(-2px);
    /* –£—Å–∏–ª–∏–≤–∞–µ–º —Ç–µ–Ω—å –¥–ª—è "–ø–∞—Ä—è—â–µ–≥–æ" —ç—Ñ—Ñ–µ–∫—Ç–∞ */
    box-shadow: 0 6px 12px rgba(79, 70, 229, 0.3), 0 2px 4px rgba(0,0,0,0.1);
}

/* –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É */
.btn-gradient:active {
    /* –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ –º–µ—Å—Ç–æ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ "–Ω–∞–∂–∞—Ç–∏—è" */
    transform: translateY(0);
    /* –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Ç–µ–Ω—å */
    box-shadow: 0 2px 5px rgba(79, 70, 229, 0.2), 0 1px 2px rgba(0,0,0,0.05);
}


    </style>
</head>
<body class="td-body">

<div class="td-container">
    <header class="td-header">
        <div class="td-logo-section">
            <div class="td-logo-icon">üéì</div>
            <div>
                <h1>–®–∫–æ–ª—å–Ω–∞—è –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</h1>
                <p>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–µ–±–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º</p>
            </div>
        </div>
        <div class="td-user-section">
            <div class="td-user-info">
                <a href="{% url 'profile' %}" class="td-user-link">
                    <h3>{{ teacher.user.get_full_name }}</h3>
                </a>
                <p>–£—á–∏—Ç–µ–ª—å</p>
            </div>
            <a href="{% url 'profile' %}" class="td-user-link">
                <div class="td-user-avatar">{{ teacher.user.first_name|first }}{{ teacher.user.last_name|first }}</div>
            </a>
        </div>
    </header>

    <main>
        <!-- –û–°–ù–û–í–ù–ê–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø (–í–ö–õ–ê–î–ö–ò) -->
        <nav class="td-main-nav">
            <ul>
                <li><a class="active" data-tab="dashboard"><i class="fas fa-home"></i> –ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a data-tab="lesson-plans"><i class="fas fa-file-alt"></i> –ü–æ—É—Ä–æ—á–Ω—ã–µ –ø–ª–∞–Ω—ã</a></li>
                <li><a data-tab="schedule"><i class="far fa-calendar-alt"></i> –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a></li>
                <li><a data-tab="journal"><i class="fas fa-book"></i> –ñ—É—Ä–Ω–∞–ª</a></li>
                <li><a data-tab="homework"><i class="fas fa-pencil-alt"></i> –î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</a></li>
            </ul>
        </nav>

        <!-- –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –í–°–ï–• –í–ö–õ–ê–î–û–ö -->
        <div class="tabs-container">
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ "–ì–ª–∞–≤–Ω–∞—è" -->
            <div id="dashboard-content" class="tab-content active">
                
                <!-- === –ù–ê–ß–ê–õ–û: –ò–ó–ú–ï–ù–ï–ù–ù–´–ô –ë–õ–û–ö –°–¢–ê–¢–ò–°–¢–ò–ö–ò === -->
                <section class="td-stats-cards">
                    <div class="td-stat-card">
                        <div class="stat-info">
                            <p>–£—Ä–æ–∫–æ–≤ —Å–µ–≥–æ–¥–Ω—è</p>
                            <h2>{{ lessons_today_count|default:0 }}</h2>
                        </div>
                        <div class="stat-icon blue">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                    </div>
                    <div class="td-stat-card">
                        <div class="stat-info">
                            <p>–ü–ª–∞–Ω–æ–≤ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</p>
                            <h2>{{ plans_to_check_count|default:0 }}</h2>
                        </div>
                        <div class="stat-icon orange">
                            <i class="fas fa-file-alt"></i>
                        </div>
                    </div>
                    <div class="td-stat-card">
                        <div class="stat-info">
                            <p>–î–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π</p>
                            <h2>{{ homeworks_count|default:0 }}</h2>
                        </div>
                        <div class="stat-icon purple">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                    </div>
                    <div class="td-stat-card">
                        <div class="stat-info">
                            <p>–ù–µ–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç</p>
                            <h2>{{ unchecked_works_count|default:0 }}</h2>
                        </div>
                        <div class="stat-icon red">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                    </div>
                </section>
                <!-- === –ö–û–ù–ï–¶: –ò–ó–ú–ï–ù–ï–ù–ù–´–ô –ë–õ–û–ö –°–¢–ê–¢–ò–°–¢–ò–ö–ò === -->

                <section class="td-card">
                    <div class="td-card-header"><i class="far fa-clock"></i><h3>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h3></div>
                    <p class="td-card-subtitle">{{ today|date:"l, j F Y" }}</p>
                    <div class="td-schedule-list">
                        {% for lesson in schedule_today %}
                        <div class="td-lesson-item">
                            <div class="td-lesson-time"><p>{{ lesson.start_time|time:"H:i" }}</p><span>{{ lesson.end_time|time:"H:i" }}</span></div>
                            <div class="td-lesson-info"><h4>{{ lesson.subject.name }}</h4><p>–ö–ª–∞—Å—Å {{ lesson.school_class.name }} ‚Ä¢ –ö–∞–±–∏–Ω–µ—Ç {{ lesson.classroom }}</p></div>
                            <span class="td-lesson-status">–ü—Ä–µ–¥—Å—Ç–æ–∏—Ç</span>
                        </div>
                        {% empty %}
                        <p style="text-align: center; padding: 20px; color: var(--text-secondary);">–ù–∞ —Å–µ–≥–æ–¥–Ω—è —É—Ä–æ–∫–æ–≤ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –Ω–µ—Ç.</p>
                        {% endfor %}
                    </div>
                </section>
            </div>

            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ" -->
            <div id="schedule-content" class="tab-content">
                <section class="td-card">
                    <div class="td-card-header"><h3>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–æ–≤</h3></div>
                    <p class="td-card-subtitle">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é –¥–ª—è —É—á–∏—Ç–µ–ª—è: {{ teacher.user.get_full_name }}</p>

                    <div class="schedule-stats-grid">
                        <div class="schedule-stat-item">
                            <div class="icon-bg blue"><i class="fas fa-calendar-alt"></i></div>
                            <div><h3>{{ lessons_in_week_count }}</h3><p>–£—Ä–æ–∫–æ–≤ –≤ –Ω–µ–¥–µ–ª—é</p></div>
                        </div>
                        <div class="schedule-stat-item">
                            <div class="icon-bg purple"><i class="fas fa-users"></i></div>
                            <div><h3>{{ unique_classes_count }}</h3><p>–ö–ª–∞—Å—Å–æ–≤ –≤ –Ω–µ–¥–µ–ª—é</p></div>
                        </div>
                        <div class="schedule-stat-item">
                            <div class="icon-bg green"><i class="fas fa-clock"></i></div>
                            <div><h3>{{ hours_in_week }}</h3><p>–ß–∞—Å–æ–≤ –≤ –Ω–µ–¥–µ–ª—é</p></div>
                        </div>
                    </div>

                    <div class="schedule-week-grid">
                        {% for day_data in schedule_for_template %}
                            <div class="schedule-day-column {% if today_weekday == day_data.day_number %}today{% endif %}">
                                <div class="day-header">
                                    <h4>{{ day_data.day_name }}</h4>
                                    <span>{{ day_data.date|date:"d.m.Y" }}</span>
                                </div>
                                <div class="lessons-list">
                                    {% for lesson in day_data.lessons %}
                                        <div class="lesson-card">
                                            <p class="time"><i class="far fa-clock"></i> {{ lesson.start_time|time:"H:i" }}</p>
                                            <p class="subject">{{ lesson.subject.name }}</p>
                                            <p class="details"><i class="fas fa-chalkboard-teacher"></i> –ö–ª–∞—Å—Å: {{ lesson.school_class.name }}</p>
                                            <p class="details"><i class="fas fa-map-marker-alt"></i> –ö–∞–±: {{ lesson.classroom }}</p>
                                        </div>
                                    {% empty %}
                                        <p style="font-size: 13px; text-align: center; color: var(--text-secondary); padding-top: 20px;">–ù–µ—Ç —É—Ä–æ–∫–æ–≤</p>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </section>
            </div>

            <!-- === –ù–ê–ß–ê–õ–û: –ù–û–í–´–ô –ö–û–ù–¢–ï–ù–¢ –î–õ–Ø –í–ö–õ–ê–î–ö–ò "–ü–û–£–†–û–ß–ù–´–ï –ü–õ–ê–ù–´" === -->
            <div id="lesson-plans-content" class="tab-content">
                <main class="lp-widget">
                    <div class="widget-header">
                        <div class="widget-title">
                            <h2>–ü–æ—É—Ä–æ—á–Ω—ã–µ –ø–ª–∞–Ω—ã</h2>
                            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∞–º–∏ —É—Ä–æ–∫–æ–≤</p>
                        </div>
                        <button class="btn-create" id="create-plan-btn"><i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω</button>
                    </div>

                    <table class="lp-table">
                        <thead>
                            <tr>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th>–ö–ª–∞—Å—Å</th>
                                <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                                <th>–î–∞—Ç–∞</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="lesson-plans-tbody">
                            {% for plan in lesson_plans %}
                            <tr id="plan-row-{{ plan.pk }}">
                                <td>{{ plan.name }}</td>
                                <td>{{ plan.school_class.name }}</td>
                                <td>{{ plan.subject.name }}</td>
                                <td>{{ plan.date|date:"d.m.Y" }}</td>
                                <td>
                                    <span class="lp-status {% if plan.status == 'approved' %}approved{% elif plan.status == 'rejected' %}rejected{% else %}pending{% endif %}">
                                        {{ plan.get_status_display }}
                                    </span>
                                </td>
                                <td class="lp-actions">
                                    <button class="view-plan-btn" data-plan-id="{{ plan.pk }}" title="–ü—Ä–æ—Å–º–æ—Ç—Ä"><i class="far fa-eye"></i></button>
                                    <button class="edit-plan-btn" data-plan-id="{{ plan.pk }}" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"><i class="fas fa-pencil-alt"></i></button>
                                    <button class="delete-plan-btn" data-plan-id="{{ plan.pk }}" title="–£–¥–∞–ª–∏—Ç—å"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                            {% empty %}
                            <tr id="no-plans-row">
                                <td colspan="6" style="text-align: center; color: var(--text-secondary); padding: 20px;">
                                    –í—ã –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ –ø–æ—É—Ä–æ—á–Ω–æ–≥–æ –ø–ª–∞–Ω–∞.
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </main>
            </div>
            <!-- === –ö–û–ù–ï–¶: –ù–û–í–´–ô –ö–û–ù–¢–ï–ù–¢ === -->
            
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ "–ñ—É—Ä–Ω–∞–ª" -->
            <div id="journal-content" class="tab-content">
                <div class="journal-widget">
                    <div class="journal-header">
                        <div class="journal-title">
                            <h2>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –∂—É—Ä–Ω–∞–ª</h2>
                            <p>–û—Ü–µ–Ω–∫–∏ –∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å —É—á–∞—â–∏—Ö—Å—è</p>
                        </div>
                        <form method="get" id="filter-form" style="display: flex; gap: 16px;">
                            <select name="school_id" onchange="this.form.submit()" class="class-selector">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —à–∫–æ–ª—É</option>
                                {% for school in all_schools %}
                                    <option value="{{ school.pk }}" {% if school.pk == selected_school_id %}selected{% endif %}>{{ school.name }}</option>
                                {% endfor %}
                            </select>
                            <select name="class_id" onchange="this.form.submit()" class="class-selector">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å</option>
                                {% for class in teacher_classes %}
                                    <option value="{{ class.pk }}" {% if class.pk == selected_class_id %}selected{% endif %}>{{ class.name }}</option>
                                {% endfor %}
                            </select>
                            <select name="subject_id" onchange="this.form.submit()" class="class-selector">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç</option>
                                {% for subject in teacher_subjects %}
                                    <option value="{{ subject.pk }}" {% if subject.pk == selected_subject_id %}selected{% endif %}>{{ subject.name }}</option>
                                {% endfor %}
                            </select>
                        </form>
                    </div>

                    <div class="journal-tabs">
                        <button class="tab-btn active" data-content-type="grades">–û—Ü–µ–Ω–∫–∏</button>
                        <button class="tab-btn" data-content-type="attendance">–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</button>
                    </div>

                    <div id="journal-content-container">
                        {% if selected_school_id and selected_class_id and selected_subject_id %}
                            {% include "partials/_attendance_table.html" %}
                        {% else %}
                            <p style="text-align: center; color: var(--text-secondary); padding: 20px;">
                                –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —à–∫–æ–ª—É, –∫–ª–∞—Å—Å –∏ –ø—Ä–µ–¥–º–µ—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞.
                            </p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- === –ù–ê–ß–ê–õ–û: –ö–û–ù–¢–ï–ù–¢ –î–õ–Ø –í–ö–õ–ê–î–ö–ò "–î–û–ú–ê–®–ù–ò–ï –ó–ê–î–ê–ù–ò–Ø" === -->
            <div id="homework-content" class="tab-content">
                 <main class="homework-widget">
                    <div class="widget-header">
                        <div class="widget-title">
                            <h2>–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</h2>
                            <p>–°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π</p>
                        </div>
                        <button class="btn-create"><i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ</button>
                    </div>

                    <div class="homework-list" id="homework-list-container">
                        {% for hw in homeworks %}
                        <div class="homework-card" id="hw-card-{{ hw.pk }}">
                            <div class="hw-card-header">
                                <div class="hw-title-group">
                                    <h3>{{ hw.title }}</h3>
                                    <span class="hw-tag">{{ hw.school_class.name }}</span>
                                    <span class="hw-tag">{{ hw.subject.name }}</span>
                                </div>
                                <div class="hw-actions">
                                    <button class="edit-btn" data-hw-pk="{{ hw.pk }}"><i class="fas fa-pencil-alt"></i></button>
                                    <button class="delete-btn" data-hw-pk="{{ hw.pk }}"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                            <p class="hw-description">{{ hw.description|truncatewords:20 }}</p>
                            <div class="hw-card-footer">
                                <div class="hw-stats">
                                    <span>–°–¥–∞–Ω–æ: {{ hw.submission_count }}</span> &nbsp;&nbsp;
                                    <span>–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: {{ hw.checked_count }} –∏–∑ {{ hw.submission_count }}</span>
                                </div>
                                <button class="btn-view-submissions" data-hw-pk="{{ hw.pk }}" data-hw-title="{{ hw.title }}" data-hw-info="{{ hw.school_class.name }} ‚Ä¢ {{ hw.subject.name }}">
                                    <i class="far fa-eye"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–±–æ—Ç—ã
                                </button>
                            </div>
                        </div>
                        {% empty %}
                        <p id="no-homeworks-message" style="text-align:center; color: var(--text-secondary); padding: 20px;">–í—ã –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è.</p>
                        {% endfor %}
                    </div>
                </main>
            </div>
            <!-- === –ö–û–ù–ï–¶: –ö–û–ù–¢–ï–ù–¢ –î–õ–Ø –í–ö–õ–ê–î–ö–ò "–î–û–ú–ê–®–ù–ò–ï –ó–ê–î–ê–ù–ò–Ø" === -->

        </div>
    </main>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ñ—É—Ä–Ω–∞–ª–∞ -->
<div id="grade-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h3 id="modal-student-name"></h3>
        <p id="modal-date"></p>
        <form id="grade-form">
            <input type="number" id="grade-input" min="0" max="100" placeholder="–û—Ü–µ–Ω–∫–∞ (0-100)">
            <textarea id="comment-input" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –æ—Ü–µ–Ω–∫–µ..."></textarea>
            <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </form>
    </div>
</div>

<!-- === –ù–ê–ß–ê–õ–û: –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê –î–õ–Ø –î–û–ú–ê–®–ù–ò–• –ó–ê–î–ê–ù–ò–ô (–í–ù–ï –û–°–ù–û–í–ù–û–ì–û –ö–û–ù–¢–ï–ô–ù–ï–†–ê) === -->
<div class="modal-overlay" id="homework-modal">
    <div class="modal-container">
        <button class="close-btn" id="close-homework-modal">&times;</button>
        <div class="modal-header">
            <h2>–°–æ–∑–¥–∞—Ç—å –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ</h2>
            <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–æ–º–∞—à–Ω–µ–º –∑–∞–¥–∞–Ω–∏–∏</p>
        </div>
        <form id="homework-form" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group full-width" style="margin-top: 24px;">
                <label for="{{ homework_form.title.id_for_label }}">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</label>
                {{ homework_form.title }}
            </div>
            <div class="form-grid">
                <div class="form-group"><label for="{{ homework_form.school_class.id_for_label }}">–ö–ª–∞—Å—Å</label>{{ homework_form.school_class }}</div>
                <div class="form-group"><label for="{{ homework_form.subject.id_for_label }}">–ü—Ä–µ–¥–º–µ—Ç</label>{{ homework_form.subject }}</div>
                <div class="form-group"><label for="{{ homework_form.due_date.id_for_label }}">–°—Ä–æ–∫ —Å–¥–∞—á–∏</label>{{ homework_form.due_date }}</div>
            </div>
            <div class="form-group full-width"><label for="{{ homework_form.description.id_for_label }}">–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</label>{{ homework_form.description }}</div>
            <div class="form-group full-width"><label for="{{ homework_form.attached_file.id_for_label }}">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>{{ homework_form.attached_file }}</div>
            <div class="modal-footer full-width">
                <button type="button" class="btn-secondary" id="cancel-homework-btn">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn-submit">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </form>
    </div>
</div>
<div class="modal-overlay" id="submissions-modal">
    <div class="modal-container">
        <button class="close-btn" id="close-submissions-modal">&times;</button>
        <div class="modal-header"><h2 id="submissions-modal-title"></h2><p id="submissions-modal-info"></p></div>
        <div class="submissions-table-container">
            <table class="submissions-table">
                <thead>
                    <!-- –ò–ó–ú–ï–ù–ï–ù–ê –≠–¢–ê –°–¢–†–û–ö–ê -->
                    <tr><th>–£—á–µ–Ω–∏–∫</th><th>–§–∞–π–ª</th><th>–°—Ç–∞—Ç—É—Å</th><th>–î–∞—Ç–∞ —Å–¥–∞—á–∏</th><th>–û—Ü–µ–Ω–∫–∞</th><th>–î–µ–π—Å—Ç–≤–∏–µ</th></tr>
                </thead>
                <tbody id="submissions-tbody"></tbody>
            </table>
        </div>
        <div class="modal-footer"><button type="button" class="btn-secondary" id="cancel-submissions-btn">–ó–∞–∫—Ä—ã—Ç—å</button></div>
    </div>
</div>
<div class="modal-overlay" id="grading-modal">
    <div class="modal-container">
        <button class="close-btn" id="close-grading-modal">&times;</button>
        <div class="modal-header">
            <h2>–†–µ—Ü–µ–Ω–∑–∏—è –Ω–∞ —Ä–∞–±–æ—Ç—É</h2>
            <p id="grading-student-name"></p>
        </div>
        <form id="grading-form">
            {% csrf_token %}
            <div class="form-group">
                <label for="grade-input">–û—Ü–µ–Ω–∫–∞ (0-100)</label>
                <input type="number" id="grade-input" name="grade" min="0" max="100" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 85">
            </div>
            <div class="form-group">
                <label for="comment-textarea">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                <textarea id="comment-textarea" name="comment" placeholder="–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancel-grading-btn">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn-gradient">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é</button>
            </div>
        </form>
    </div>
</div>
<!-- === –ö–û–ù–ï–¶: –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê === -->

<!-- === –ù–ê–ß–ê–õ–û: –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê –î–õ–Ø –ü–û–£–†–û–ß–ù–´–• –ü–õ–ê–ù–û–í === -->
<div class="modal-overlay" id="plan-form-modal">
    <div class="modal-container">
        <button class="close-btn">&times;</button>
        <div class="modal-header">
            <h2 id="plan-modal-title">–°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω —É—Ä–æ–∫–∞</h2>
            <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—É—Ä–æ—á–Ω–æ–º –ø–ª–∞–Ω–µ</p>
        </div>
        <!-- === –ò–ó–ú–ï–ù–ï–ù–ò–ï 1: –î–æ–±–∞–≤–ª–µ–Ω enctype –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ === -->
        <form id="lesson-plan-form" novalidate enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="plan_id" id="plan_id">
            <div class="form-grid">
                <div class="form-group">{{ lesson_plan_form.name.label_tag }} {{ lesson_plan_form.name }}</div>
                <div class="form-group">{{ lesson_plan_form.date.label_tag }} {{ lesson_plan_form.date }}</div>
                <div class="form-group">{{ lesson_plan_form.school_class.label_tag }} {{ lesson_plan_form.school_class }}</div>
                <div class="form-group">{{ lesson_plan_form.subject.label_tag }} {{ lesson_plan_form.subject }}</div>
            </div>
            <div class="form-group full-width">{{ lesson_plan_form.topic.label_tag }} {{ lesson_plan_form.topic }}</div>
            <div class="form-group full-width">{{ lesson_plan_form.goals_and_objectives.label_tag }} {{ lesson_plan_form.goals_and_objectives }}</div>
            
            <!-- === –ò–ó–ú–ï–ù–ï–ù–ò–ï 2: –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –±–ª–æ–∫ –¥–ª—è –ø–æ–ª—è —Ñ–∞–π–ª–∞ === -->
            <div class="form-group full-width">
                {{ lesson_plan_form.learning_materials.label_tag }}
                <div id="current-materials-file" style="margin-bottom: 8px; font-size: 14px;"></div>
                {{ lesson_plan_form.learning_materials }}
            </div>
            <!-- === –ö–û–ù–ï–¶ –ò–ó–ú–ï–ù–ï–ù–ò–Ø 2 === -->

            <div class="modal-footer full-width">
                <button type="button" class="btn-secondary close-btn">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn-submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>
    </div>
</div>

<div class="modal-overlay" id="plan-view-modal">
    <div class="modal-container">
        <button class="close-btn">&times;</button>
        <div class="modal-header">
            <h2 id="view-plan-title"></h2>
            <p><span id="view-plan-class"></span> ‚Ä¢ <span id="view-plan-subject"></span> ‚Ä¢ <span id="view-plan-date"></span></p>
        </div>
        <dl class="lp-view-details">
            <dt>–¢–µ–º–∞ —É—Ä–æ–∫–∞</dt><dd id="view-plan-topic"></dd>
            <dt>–¶–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏</dt><dd id="view-plan-goals"></dd>
            
            <!-- === –ò–ó–ú–ï–ù–ï–ù–ò–ï 3: –ë–ª–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª === -->
            <dt>–£—á–µ–±–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</dt>
            <dd id="view-plan-materials">
                <a href="#" id="view-plan-materials-link" target="_blank" class="file-link" style="display: none;">
                    <i class="fas fa-paperclip"></i> <span></span>
                </a>
                <span id="no-materials-file" style="color: var(--text-secondary);">–ù–µ—Ç —Ñ–∞–π–ª–∞</span>
            </dd>
            <!-- === –ö–û–ù–ï–¶ –ò–ó–ú–ï–ù–ï–ù–ò–Ø 3 === -->

        </dl>
        <div class="modal-footer"><button type="button" class="btn-secondary close-btn">–ó–∞–∫—Ä—ã—Ç—å</button></div>
    </div>
</div>
<!-- === –ö–û–ù–ï–¶: –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê === -->


<script>
document.addEventListener('DOMContentLoaded', function() {
    // --- 1. –õ–û–ì–ò–ö–ê –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –û–°–ù–û–í–ù–´–• –í–ö–õ–ê–î–û–ö (–ì–ª–∞–≤–Ω–∞—è, –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ, –ñ—É—Ä–Ω–∞–ª, –î–ó) ---
    const mainNavLinks = document.querySelectorAll('.td-main-nav a[data-tab]');
    const mainContentPanes = document.querySelectorAll('.tab-content');

    mainNavLinks.forEach(link => {
        link.addEventListener('click', function(event) {
            event.preventDefault();

            const tabId = this.getAttribute('data-tab');
            mainNavLinks.forEach(navLink => navLink.classList.remove('active'));
            this.classList.add('active');

            mainContentPanes.forEach(pane => {
                pane.classList.toggle('active', pane.id === tabId + '-content');
            });
        });
    });

    // --- 2. –õ–û–ì–ò–ö–ê –î–õ–Ø –í–ö–õ–ê–î–ö–ò "–ñ–£–†–ù–ê–õ" (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ç–∞–±—ã, –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –∏ AJAX) ---
    const journalContainer = document.getElementById('journal-content');
    if (journalContainer) {
        const journalContentContainer = journalContainer.querySelector('#journal-content-container');
        const journalTabsContainer = journalContainer.querySelector('.journal-tabs');
        const modal = document.getElementById('grade-modal');

        journalTabsContainer.addEventListener('click', async function(e) {
            if (!e.target.classList.contains('tab-btn')) return;
            
            journalTabsContainer.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            e.target.classList.add('active');

            const contentType = e.target.dataset.contentType;
            const params = new URLSearchParams(new FormData(document.getElementById('filter-form'))).toString();
            if (!params.includes('class_id')) return;

            const url = (contentType === 'attendance') ? `{% url 'journal_attendance_content' %}?${params}` : `{% url 'teacher_journal_grades_content' %}?${params}`;
            
            try {
                journalContentContainer.innerHTML = '<p style="text-align: center; padding: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>';
                const response = await fetch(url);
                journalContentContainer.innerHTML = await response.text();
            } catch (error) {
                journalContentContainer.innerHTML = '<p style="color: red; text-align: center;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>';
            }
        });

        journalContentContainer.addEventListener('click', function(e) {
            const gradeCell = e.target.closest('.grade-cell');
            if (gradeCell) handleGradeCellClick(gradeCell);

            const attendanceCell = e.target.closest('.attendance-cell');
            if (attendanceCell) handleAttendanceCellClick(attendanceCell);
        });

        const gradeForm = document.getElementById('grade-form');
        let activeGradeCell = null;

        function handleGradeCellClick(cell) {
            activeGradeCell = cell;
            modal.querySelector('#modal-student-name').textContent = `–û—Ü–µ–Ω–∫–∞ –¥–ª—è: ${cell.closest('tr').cells[0].textContent.trim()}`;
            modal.querySelector('#modal-date').textContent = `–î–∞—Ç–∞: ${cell.dataset.date}`;
            modal.querySelector('#grade-input').value = cell.textContent.trim().replace(/[^0-9]/g, '');
            modal.querySelector('#comment-input').value = cell.dataset.comment || '';
            modal.style.display = 'block';
            modal.querySelector('#grade-input').focus();
        }

        async function handleAttendanceCellClick(cell) {
            const statuses = ['P', 'L', 'A'];
            const currentStatus = cell.dataset.status;
            const nextStatus = statuses[(statuses.indexOf(currentStatus) + 1) % statuses.length];
            
            const row = cell.closest('tr');
            const absentCountCell = row.querySelector('.absent-count');
            let currentAbsences = parseInt(absentCountCell.textContent);
            if (currentStatus === 'A' && nextStatus !== 'A') {
                absentCountCell.textContent = currentAbsences - 1;
            } else if (currentStatus !== 'A' && nextStatus === 'A') {
                absentCountCell.textContent = currentAbsences + 1;
            }

            updateAttendanceIcon(cell, nextStatus);

            const payload = {
                student_id: cell.dataset.studentId, date: cell.dataset.date,
                subject_id: cell.closest('tbody').dataset.subjectId, class_id: cell.closest('tbody').dataset.classId,
                status: nextStatus
            };
            
            try {
                const response = await fetch("{% url 'api_set_attendance' %}", {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json', 'X-CSRFToken': getCookie('csrftoken')},
                    body: JSON.stringify(payload)
                });
                if (!response.ok) updateAttendanceIcon(cell, currentStatus);
            } catch (error) {
                updateAttendanceIcon(cell, currentStatus);
            }
        }
        
        gradeForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const payload = {
                student_id: activeGradeCell.dataset.studentId, date: activeGradeCell.dataset.date,
                subject_id: activeGradeCell.closest('tbody').dataset.subjectId, class_id: activeGradeCell.closest('tbody').dataset.classId,
                grade: document.getElementById('grade-input').value,
                comment: document.getElementById('comment-input').value
            };
            const response = await fetch("{% url 'api_set_grade' %}", {
                method: 'POST',
                headers: {'Content-Type': 'application/json', 'X-CSRFToken': getCookie('csrftoken')},
                body: JSON.stringify(payload)
            });
            if (response.ok) {
                const result = await response.json();
                updateGradeCell(activeGradeCell, result.grade, result.has_comment);
                activeGradeCell.dataset.comment = payload.comment;
                modal.style.display = 'none';
            } else { alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏!'); }
        });

        modal.querySelector('.close-btn').addEventListener('click', () => modal.style.display = 'none');
        window.addEventListener('click', (e) => { if (e.target == modal) modal.style.display = 'none'; });
    }
    
    // === –õ–û–ì–ò–ö–ê –ó–ê–ì–†–£–ó–ö–ò –ñ–£–†–ù–ê–õ–ê –ü–†–ò –ü–ï–†–ï–•–û–î–ï –ü–û URL –° –ü–ê–†–ê–ú–ï–¢–†–ê–ú–ò ===
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has('school_id') && urlParams.has('class_id') && urlParams.has('subject_id')) {
        const journalTabLink = document.querySelector('a[data-tab="journal"]');
        const gradesSubTab = document.querySelector('#journal-content .tab-btn[data-content-type="grades"]');

        if (journalTabLink && gradesSubTab) {
            if (!journalTabLink.classList.contains('active')) {
                journalTabLink.click();
            }
            gradesSubTab.click();
        }
    } 
    else if (urlParams.has('school_id') || urlParams.has('class_id')) {
        const journalTabLink = document.querySelector('a[data-tab="journal"]');
        if (journalTabLink && !journalTabLink.classList.contains('active')) {
            journalTabLink.click();
        }
    }

    // === JAVASCRIPT –î–õ–Ø –õ–û–ì–ò–ö–ò –î–û–ú–ê–®–ù–ò–• –ó–ê–î–ê–ù–ò–ô ===
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    const homeworkTab = document.getElementById('homework-content');
    if (homeworkTab) {
        const homeworkListContainer = document.getElementById('homework-list-container');
        const homeworkModal = document.getElementById('homework-modal');
        const submissionsModal = document.getElementById('submissions-modal');
        const gradingModal = document.getElementById('grading-modal');
        
        if (homeworkModal && homeworkListContainer) {
            const openCreateBtn = homeworkTab.querySelector('.btn-create');
            const homeworkForm = document.getElementById('homework-form');
            const modalTitle = homeworkModal.querySelector('.modal-header h2');
            const submitButton = homeworkForm.querySelector('button[type="submit"]');
            const closeModalBtn = document.getElementById('close-homework-modal');
            const cancelModalBtn = document.getElementById('cancel-homework-btn');

            const openModalForCreate = () => {
                modalTitle.textContent = '–°–æ–∑–¥–∞—Ç—å –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ';
                submitButton.textContent = '–°–æ–∑–¥–∞—Ç—å';
                homeworkForm.reset();
                homeworkForm.setAttribute('action', "{% url 'api_create_homework' %}");
                homeworkModal.style.display = 'flex';
            };

            const openModalForEdit = async (homeworkId) => {
                modalTitle.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ';
                submitButton.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
                homeworkForm.reset();
                homeworkForm.setAttribute('action', `/api/homework/${homeworkId}/update/`);
                try {
                    const response = await fetch(`/api/homework/${homeworkId}/details/`);
                    const result = await response.json();
                    if (!response.ok) throw new Error(result.message);
                    
                    const data = result.data;
                    homeworkForm.querySelector('#id_title').value = data.title;
                    homeworkForm.querySelector('#id_description').value = data.description;
                    homeworkForm.querySelector('#id_school_class').value = data.school_class;
                    homeworkForm.querySelector('#id_subject').value = data.subject;
                    homeworkForm.querySelector('#id_due_date').value = data.due_date;
                    homeworkModal.style.display = 'flex';
                } catch (error) {
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è: ' + error.message);
                }
            };

            const closeModal = () => { homeworkModal.style.display = 'none'; };

            openCreateBtn.addEventListener('click', openModalForCreate);
            closeModalBtn.addEventListener('click', closeModal);
            cancelModalBtn.addEventListener('click', closeModal);
            homeworkModal.addEventListener('click', (e) => { if (e.target === homeworkModal) closeModal(); });

            homeworkForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                const actionUrl = this.getAttribute('action');
                try {
                    const response = await fetch(actionUrl, {
                        method: 'POST', body: formData, headers: { 'X-CSRFToken': getCookie('csrftoken') },
                    });
                    const result = await response.json();
                    if (response.ok) {
                        alert(result.message || '–£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
                        window.location.reload(); 
                    } else {
                        const errorMessages = Object.values(result.errors).map(err => err[0]).join('\n');
                        alert("–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:\n" + errorMessages);
                    }
                } catch (error) {
                    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ —Å–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞.');
                }
            });
            
            homeworkListContainer.addEventListener('click', function(e) {
                const editButton = e.target.closest('.edit-btn');
                if (editButton) {
                    openModalForEdit(editButton.dataset.hwPk);
                }
            });
        }

        if (submissionsModal && homeworkListContainer) {
            const submissionsTbody = document.getElementById('submissions-tbody');

            const openSubmissionsModal = async (hwId, hwTitle, hwInfo) => {
                submissionsModal.querySelector('#submissions-modal-title').textContent = hwTitle;
                submissionsModal.querySelector('#submissions-modal-info').textContent = hwInfo;
                submissionsTbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>';
                submissionsModal.style.display = 'flex';

                try {
                    const response = await fetch(`/api/homework/${hwId}/submissions/`);
                    const data = await response.json();
                    if (!response.ok || data.status !== 'success') throw new Error(data.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.');

                    submissionsTbody.innerHTML = '';
                    if (data.submissions.length === 0) {
                        submissionsTbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">–†–∞–±–æ—Ç—ã –µ—â–µ –Ω–µ —Å–¥–∞–Ω—ã.</td></tr>';
                        return;
                    }

                    data.submissions.forEach(sub => {
                        let fileHtml = '<td>-</td>';
                        if (sub.file_url) {
                            fileHtml = `<td><a href="${sub.file_url}" class="file-link" target="_blank" title="–û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª"><i class="fas fa-paperclip"></i> –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å</a></td>`;
                        }
                        
                        let statusHtml;
                        if (sub.status === '–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ') statusHtml = `<span class="status-tag status-checked"><i class="fas fa-check-circle"></i> –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</span>`;
                        else if (sub.status === '–°–¥–∞–Ω–æ') statusHtml = `<span class="status-tag status-submitted"><i class="fas fa-check"></i> –°–¥–∞–Ω–æ</span>`;
                        else statusHtml = `<span class="status-tag status-awaiting"><i class="far fa-clock"></i> –û–∂–∏–¥–∞–µ—Ç—Å—è</span>`;
                        
                        const gradeHtml = sub.grade !== null ? `<td><span class="grade-circle">${sub.grade}</span></td>` : '<td>-</td>';
                        const actionButton = sub.status !== '–û–∂–∏–¥–∞–µ—Ç—Å—è' ? `<button class="btn-view-submissions" style="padding: 6px 10px; font-size: 12px;">${sub.status === '–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ' ? '–ò–∑–º–µ–Ω–∏—Ç—å' : '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å'}</button>` : '-';
                        const actionHtml = `<td data-submission-pk="${sub.submission_id}" data-student-name="${sub.full_name}" data-grade="${sub.grade || ''}" data-comment="${sub.teacher_comment || ''}">${actionButton}</td>`;

                        const row = `<tr id="sub-row-${sub.submission_id}"><td>${sub.full_name}</td>${fileHtml}<td>${statusHtml}</td><td>${sub.submitted_at || '-'}</td>${gradeHtml}${actionHtml}</tr>`;
                        submissionsTbody.insertAdjacentHTML('beforeend', row);
                    });
                } catch (error) {
                    submissionsTbody.innerHTML = `<tr><td colspan="6" style="text-align:center; color: red;">${error.message}</td></tr>`;
                }
            };

            const closeSubmissionsModal = () => { submissionsModal.style.display = 'none'; };
            submissionsModal.querySelector('#close-submissions-modal').addEventListener('click', closeSubmissionsModal);
            submissionsModal.addEventListener('click', (e) => { if (e.target === submissionsModal) closeSubmissionsModal(); });
            
            homeworkListContainer.addEventListener('click', (e) => {
                const viewBtn = e.target.closest('.btn-view-submissions');
                if (viewBtn) {
                    openSubmissionsModal(viewBtn.dataset.hwPk, viewBtn.dataset.hwTitle, viewBtn.dataset.hwInfo);
                }
            });
        }

        if (gradingModal) {
            const submissionsTbody = document.getElementById('submissions-tbody');
            const gradingForm = document.getElementById('grading-form');
            const studentNameEl = document.getElementById('grading-student-name');
            const gradeInput = gradingModal.querySelector('#grade-input');
            const commentTextarea = gradingModal.querySelector('#comment-textarea');
            let currentSubmissionRow = null;

            const openGradingModal = (cell) => {
                const { submissionPk, studentName, grade, comment } = cell.dataset;
                currentSubmissionRow = document.getElementById(`sub-row-${submissionPk}`);
                studentNameEl.textContent = studentName;
                gradeInput.value = grade || "";
                commentTextarea.value = comment || "";
                gradingForm.dataset.submissionPk = submissionPk;
                gradingModal.style.display = 'flex';
            };

            const closeGradingModal = () => { gradingModal.style.display = 'none'; };
            gradingModal.querySelector('#close-grading-modal').addEventListener('click', closeGradingModal);
            gradingModal.querySelector('#cancel-grading-btn').addEventListener('click', closeGradingModal);
            gradingModal.addEventListener('click', (e) => { if (e.target === gradingModal) closeGradingModal(); });

            gradingForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const submissionPk = this.dataset.submissionPk;
                const grade = gradeInput.value;
                const comment = commentTextarea.value;

                try {
                    const response = await fetch(`/api/submission/${submissionPk}/grade/`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCookie('csrftoken') },
                        body: JSON.stringify({ grade: grade, comment: comment }),
                    });
                    const result = await response.json();
                    if (!response.ok) throw new Error(result.message);

                    if (currentSubmissionRow) {
                        const statusCell = currentSubmissionRow.cells[2];
                        const gradeCell = currentSubmissionRow.cells[4];
                        const actionCell = currentSubmissionRow.cells[5];
                        
                        statusCell.innerHTML = `<span class="status-tag status-checked"><i class="fas fa-check-circle"></i> –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</span>`;
                        gradeCell.innerHTML = result.new_grade ? `<span class="grade-circle">${result.new_grade}</span>` : '-';
                        actionCell.dataset.grade = result.new_grade || "";
                        actionCell.dataset.comment = comment;
                        actionCell.querySelector('button').textContent = '–ò–∑–º–µ–Ω–∏—Ç—å';
                    }
                    closeGradingModal();
                } catch (error) {
                    alert(`–û—à–∏–±–∫–∞: ${error.message}`);
                }
            });

            submissionsTbody.addEventListener('click', (e) => {
                const checkBtn = e.target.closest('td > button');
                if (checkBtn) {
                    openGradingModal(checkBtn.parentElement);
                }
            });
        }
    }
    
    // === JAVASCRIPT –î–õ–Ø –õ–û–ì–ò–ö–ò –ü–û–£–†–û–ß–ù–´–• –ü–õ–ê–ù–û–í ===
    const lessonPlansTab = document.getElementById('lesson-plans-content');
    if (lessonPlansTab) {
        const createPlanBtn = document.getElementById('create-plan-btn');
        const plansTbody = document.getElementById('lesson-plans-tbody');
        
        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        const formModal = document.getElementById('plan-form-modal');
        const viewModal = document.getElementById('plan-view-modal');
        
        // –§–æ—Ä–º–∞ –∏ –µ–µ —ç–ª–µ–º–µ–Ω—Ç—ã
        const planForm = document.getElementById('lesson-plan-form');
        const planModalTitle = document.getElementById('plan-modal-title');
        const planIdInput = document.getElementById('plan_id');
        const currentFileDiv = document.getElementById('current-materials-file');

        // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        const openModal = (modal) => modal.style.display = 'flex';
        const closeModal = (modal) => modal.style.display = 'none';

        formModal.querySelectorAll('.close-btn').forEach(btn => btn.addEventListener('click', () => closeModal(formModal)));
        viewModal.querySelectorAll('.close-btn').forEach(btn => btn.addEventListener('click', () => closeModal(viewModal)));

        // 1. –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è –°–û–ó–î–ê–ù–ò–Ø –ø–ª–∞–Ω–∞
        createPlanBtn.addEventListener('click', () => {
            planForm.reset();
            planIdInput.value = '';
            currentFileDiv.innerHTML = ''; // –û—á–∏—â–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º —Ñ–∞–π–ª–µ
            planModalTitle.textContent = '–°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω —É—Ä–æ–∫–∞';
            planForm.querySelector('button[type="submit"]').textContent = '–°–æ–∑–¥–∞—Ç—å';
            openModal(formModal);
        });

        // 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–Ω–æ–ø–∫–∞–º –≤ —Ç–∞–±–ª–∏—Ü–µ (–ø—Ä–æ—Å–º–æ—Ç—Ä, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ)
        plansTbody.addEventListener('click', async (e) => {
            const viewBtn = e.target.closest('.view-plan-btn');
            const editBtn = e.target.closest('.edit-plan-btn');
            const deleteBtn = e.target.closest('.delete-plan-btn');
            
            if (viewBtn) {
                const planId = viewBtn.dataset.planId;
                // –ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö...
                const response = await fetch(`/api/lesson-plans/${planId}/details/`);
                if (response.ok) {
                    const { data } = await response.json();
                    document.getElementById('view-plan-title').textContent = data.name;
                    // API –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∏–º–µ–Ω–∞, –∞ –Ω–µ ID, –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.
                    // –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ –æ—Å—Ç–∞–≤–∏–º —Ç–∞–∫, –Ω–æ –ª—É—á—à–µ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å API.
                    document.getElementById('view-plan-class').textContent = `–ö–ª–∞—Å—Å ID: ${data.school_class}`;
                    document.getElementById('view-plan-subject').textContent = `–ü—Ä–µ–¥–º–µ—Ç ID: ${data.subject}`;
                    document.getElementById('view-plan-date').textContent = data.date;
                    document.getElementById('view-plan-topic').textContent = data.topic || '-';
                    document.getElementById('view-plan-goals').textContent = data.goals_and_objectives || '-';
                    
                    const link = document.getElementById('view-plan-materials-link');
                    const noFile = document.getElementById('no-materials-file');
                    if(data.learning_materials_url) {
                        link.href = data.learning_materials_url;
                        link.querySelector('span').textContent = data.learning_materials_name;
                        link.style.display = 'inline-flex';
                        noFile.style.display = 'none';
                    } else {
                        link.style.display = 'none';
                        noFile.style.display = 'inline';
                    }
                    openModal(viewModal);
                } else {
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–ª–∞–Ω–∞.');
                }
            }

            if (editBtn) {
                const planId = editBtn.dataset.planId;
                const response = await fetch(`/api/lesson-plans/${planId}/details/`);
                if (response.ok) {
                    const { data } = await response.json();
                    planForm.reset();
                    planIdInput.value = data.id;
                    planModalTitle.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω —É—Ä–æ–∫–∞';
                    planForm.querySelector('button[type="submit"]').textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';

                    // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã
                    planForm.querySelector('[name="name"]').value = data.name;
                    planForm.querySelector('[name="date"]').value = data.date;
                    planForm.querySelector('[name="school_class"]').value = data.school_class;
                    planForm.querySelector('[name="subject"]').value = data.subject;
                    planForm.querySelector('[name="topic"]').value = data.topic;
                    planForm.querySelector('[name="goals_and_objectives"]').value = data.goals_and_objectives;
                    
                    if (data.learning_materials_url) {
                        currentFileDiv.innerHTML = `–¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª: <a href="${data.learning_materials_url}" target="_blank">${data.learning_materials_name}</a>`;
                    } else {
                        currentFileDiv.innerHTML = '';
                    }

                    openModal(formModal);
                } else {
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–ª–∞–Ω–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.');
                }
            }

            if (deleteBtn) {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–ª–∞–Ω?')) {
                    const planId = deleteBtn.dataset.planId;
                    // === –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 2: –ü–æ–ª—É—á–∞–µ–º CSRF-—Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π ===
                    const csrfToken = planForm.querySelector('input[name="csrfmiddlewaretoken"]').value;

                    const response = await fetch(`/api/lesson-plans/${planId}/delete/`, {
                        method: 'POST',
                        headers: { 'X-CSRFToken': csrfToken }
                    });
                    if (response.ok) {
                        document.getElementById(`plan-row-${planId}`).remove();
                    } else {
                        alert('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø–ª–∞–Ω.');
                    }
                }
            }
        });

        // 3. –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã (—Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
        planForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // === –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 1: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π "planForm" ===
            const csrfToken = planForm.querySelector('input[name="csrfmiddlewaretoken"]').value;
            
            const formData = new FormData(this);
            const response = await fetch("{% url 'api_manage_lesson_plan' %}", {
                method: 'POST',
                body: formData,
                headers: { 'X-CSRFToken': csrfToken }
            });
            
            if (response.ok) {
                window.location.reload(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
            } else {
                const result = await response.json();
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + JSON.stringify(result.errors || result.message));
            }
        });
    }
    
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–π listener –¥–ª—è Escape, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            document.querySelectorAll('.modal-overlay, .modal').forEach(modal => modal.style.display = 'none');
        }
    });

    // --- –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò (–æ–±—â–∏–µ –¥–ª—è –∂—É—Ä–Ω–∞–ª–∞ –∏ –î–ó) ---
    function updateGradeCell(cell, gradeValue, hasComment) {
        if (gradeValue === null || gradeValue === '') {
            cell.innerHTML = '<span style="color: var(--text-secondary); font-size: 20px;">+</span>';
            return;
        }
        const gradeInt = parseInt(gradeValue);
        let badgeClass = (gradeInt >= 85) ? 'grade-5' : (gradeInt >= 65) ? 'grade-4' : 'grade-3';
        const commentIcon = hasComment ? '<span class="grade-comment-icon">üí¨</span>' : '';
        cell.innerHTML = `<div class="grade-badge-container"><div class="grade-badge ${badgeClass}">${gradeInt}</div>${commentIcon}</div>`;
    }
    function updateAttendanceIcon(cell, statusCode) { 
        let iconHtml = '';
        if (statusCode === 'P') iconHtml = '<span class="attendance-icon status-P">‚úì</span>';
        else if (statusCode === 'A') iconHtml = '<span class="attendance-icon status-A">‚úï</span>';
        else if (statusCode === 'L') iconHtml = '<span class="attendance-icon status-L">!</span>';
        cell.innerHTML = iconHtml;
        cell.dataset.status = statusCode;
    }
});
</script>

</body>
</html>