<style>
    /* Новые стили для иконок посещаемости */
    .attendance-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        font-weight: bold;
        font-size: 16px;
    }
    .status-P { /* Присутствовал - галочка */
        color: #059669; 
        background-color: #ECFDF5;
    }
    .status-A { /* Отсутствовал - крестик */
        color: #DC2626;
        background-color: #FEF2F2;
    }
    .status-L { /* Опоздал - часы */
        color: #D97706;
        background-color: #FFFBEB;
    }
</style>

<table class="journal-table" id="attendance-table">
    <thead>
        <tr>
            <th>Ученик</th>
            {% for date in date_range %}
                <th>{{ date|date:"d.m" }}</th>
            {% endfor %}
            <th>Пропуски</th>
        </tr>
    </thead>
    <tbody data-subject-id="{{ selected_subject_id }}" data-class-id="{{ selected_class_id }}">
        {% for row in attendance_data %}
        <tr>
            <!-- Отображаем полное ФИО ученика -->
            <td>{{ row.student.get_full_name|default:row.student.username }}</td>
            
            {% for cell in row.cells %}
            <td class="attendance-cell" 
                data-student-id="{{ row.student.pk }}" 
                data-date="{{ cell.date|date:'Y-m-d' }}"
                data-status="{{ cell.record.status|default:'P' }}">
                
                {# --- ГЛАВНЫЕ ИЗМЕНЕНИЯ ЗДЕСЬ --- #}
                {% with record=cell.record %}
                    {% if record %}
                        {% if record.status == 'P' %}
                            <span class="attendance-icon status-P">✓</span>
                        {% elif record.status == 'A' %}
                            <span class="attendance-icon status-A">✕</span>
                        {% elif record.status == 'L' %}
                            <span class="attendance-icon status-L">!</span> {# Восклицательный знак для опоздания #}
                        {% endif %}
                    {% else %}
                        {# По умолчанию ставим галочку (присутствовал) #}
                        <span class="attendance-icon status-P">✓</span>
                    {% endif %}
                {% endwith %}
            </td>
            {% endfor %}
            
            <!-- Отображаем количество пропусков -->
            <td>{{ row.absent_count|default:"0" }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>